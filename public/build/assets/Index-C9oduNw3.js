import{c as I,r as m,j as e,e as M,a as $,T as W,u as L,H as X}from"./app-CCgVoYEQ.js";import{A as Y}from"./AuthenticatedLayout-B8D5q7OF.js";import{M as S}from"./Modal-rsFWo1Ry.js";import{I as T}from"./InputLabel-Cd-NfE0-.js";import{T as E}from"./TextInput-BczBMDWj.js";import{P as b}from"./PrimaryButton-B8tWqAj6.js";import{S as C}from"./SecondaryButton-DcxQ5Lgq.js";import{k as J,l as K,D as Q,P as U,d as Z}from"./core.esm-CME_1ZTs.js";import{S as R}from"./save-BusKz1Lp.js";import{D as ee}from"./DangerButton-Du_qSvP2.js";import{I as z}from"./InputError-CWU755YW.js";import{C as se}from"./clock-DmiTNz5U.js";import{D as re}from"./dollar-sign-BPyAFHgG.js";import{L as te}from"./layout-grid-B7ZCs-i2.js";import{M as ae}from"./map-iSBQu9x3.js";import{P as ie}from"./plus-BdAvLtDu.js";import"./monitor-ChCRoNgC.js";import"./shopping-bag-BXjODdx7.js";import"./package-Cx7bHxCB.js";import"./layout-dashboard-Dx7GOLuC.js";import"./credit-card-DNYgLdhn.js";import"./trophy-CmPrCShO.js";import"./ticket-BYoNT3ck.js";import"./store-VUrIlmxQ.js";import"./key-CKjKb_wG.js";import"./shield-check-DHRbiJGg.js";import"./log-out-XdxYT9wm.js";import"./transition-vUlZZAvv.js";import"./use-sync-refs-D0Pc_C8j.js";import"./truck-R_sjZi5o.js";import"./switch-3Xb6eePU.js";import"./use-resolve-button-type-DEV79sNA.js";import"./keyboard-BRIR3wlq.js";import"./hidden-dfAfSfNn.js";import"./menu-CZUNzemD.js";import"./portal-DEyrsJCl.js";import"./with-selector-CQ3QENBX.js";import"./chevron-down-DJ_s2hYu.js";import"./menu-DIZiUFx4.js";import"./search-DLr_Xhyt.js";import"./useAudio-BZ5jkVJA.js";import"./bell-1IVW0JAl.js";import"./eye-DagpWMwH.js";import"./arrow-left-COMqi0zl.js";const oe=[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]],ne=I("grip-horizontal",oe);const de=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],le=I("rotate-cw",de);function ce(r,a,t){const o={...r};return a.top+r.y<=t.top?o.y=t.top-a.top:a.bottom+r.y>=t.top+t.height&&(o.y=t.top+t.height-a.bottom),a.left+r.x<=t.left?o.x=t.left-a.left:a.right+r.x>=t.left+t.width&&(o.x=t.left+t.width-a.right),o}const me=r=>{let{containerNodeRect:a,draggingNodeRect:t,transform:o}=r;return!t||!a?o:ce(o,t,a)};function xe({table:r,isSelected:a}){const{attributes:t,listeners:o,setNodeRef:l,transform:c,isDragging:x}=Z({id:r.id,data:{table:r}}),u=()=>a?"ring-2 ring-blue-500 border-blue-500":r.status==="occupied"?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":r.status==="reserved"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",p={left:`${r.position_x}px`,top:`${r.position_y}px`,width:`${r.width}px`,height:`${r.height}px`,position:"absolute",transform:c?`translate3d(${c.x}px, ${c.y}px, 0)`:void 0,zIndex:x?100:1};return e.jsxs("div",{ref:l,style:p,...o,...t,className:M("border-2 shadow-sm flex flex-col items-center justify-center cursor-move transition-colors select-none",u(),x&&"shadow-xl opacity-80 z-50",r.shape==="round"?"rounded-full":"rounded-lg"),children:[e.jsx(ne,{className:"w-4 h-4 text-gray-300 absolute top-2 opacity-0 hover:opacity-100 transition-opacity"}),e.jsx("span",{className:M("font-bold dark:text-white",r.width<60?"text-sm":"text-xl"),children:r.number}),r.width>=60&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:[r.capacity,"L"]}),r.status==="occupied"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white dark:border-gray-900"})]})}function ue({tables:r}){const[a,t]=m.useState(r),[o,l]=m.useState(!1);m.useEffect(()=>{t(r)},[r]);const c=J(K(U,{activationConstraint:{distance:5}})),x=i=>{const{active:d,delta:f}=i,n=d.id;t(h=>h.map(g=>{if(g.id===n){const v=Math.max(0,g.position_x+f.x),w=Math.max(0,g.position_y+f.y),j=N=>Math.round(N/20)*20;return{...g,position_x:j(v),position_y:j(w)}}return g})),l(!0)},u=()=>{const i=a.map(d=>({id:d.id,x:d.position_x,y:d.position_y,width:d.width,height:d.height,shape:d.shape,rotation:d.rotation}));$.post(route("tables.update-positions"),{positions:i},{preserveScroll:!0,onSuccess:()=>l(!1)})},p=(i,d,f)=>{t(n=>n.map(h=>h.id===i?{...h,[d]:f}:h)),l(!0)};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:e.jsx("p",{children:"Arraste as mesas para posicionÃ¡-las. Clique em uma mesa para editar formato."})}),e.jsxs("div",{className:"flex gap-2",children:[o&&e.jsx("span",{className:"text-amber-500 text-sm flex items-center px-2",children:"AlteraÃ§Ãµes nÃ£o salvas"}),e.jsxs(b,{onClick:u,disabled:!o,className:M("gap-2",!o&&"opacity-50 cursor-not-allowed"),children:[e.jsx(R,{className:"w-4 h-4"}),"Salvar Layout"]})]})]}),e.jsxs("div",{className:"relative w-full h-[600px] bg-gray-100 dark:bg-gray-900 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 overflow-hidden shadow-inner font-sans",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.1] pointer-events-none",style:{backgroundImage:"linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsx(Q,{sensors:c,modifiers:[me],onDragEnd:x,children:a.map(i=>e.jsxs("div",{children:[e.jsx(xe,{table:i,isSelected:!1}),e.jsxs("div",{style:{left:i.position_x,top:i.position_y-25,position:"absolute",zIndex:50},className:"flex gap-1 opacity-0 hover:opacity-100 transition-opacity bg-white/80 rounded p-1 shadow-sm",children:[e.jsx("button",{onClick:()=>p(i.id,"shape",i.shape==="round"?"square":"round"),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:i.shape==="round"?"â¬›":"ðŸ”µ"}),e.jsx("button",{onClick:()=>p(i.id,"width",i.width+10),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"+"}),e.jsx("button",{onClick:()=>p(i.id,"width",Math.max(40,i.width-10)),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"-"})]})]},i.id))})]})]})}function pe({show:r,onClose:a,onConfirm:t,title:o,message:l,confirmLabel:c="Confirmar",cancelLabel:x="Cancelar",processing:u=!1}){return e.jsx(S,{show:r,onClose:a,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full dark:bg-red-900/20 mb-4",children:e.jsx(W,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-lg font-medium text-center text-gray-900 dark:text-gray-100 mb-2",children:o}),e.jsx("p",{className:"text-sm text-center text-gray-500 dark:text-gray-400 mb-6",children:l}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(C,{onClick:a,disabled:u,children:x}),e.jsx(ee,{onClick:t,disabled:u,children:c})]})]})})}function he({show:r,onClose:a,sourceTable:t,tables:o}){const{data:l,setData:c,post:x,processing:u,reset:p,errors:i}=L({target_table_id:""});m.useEffect(()=>{r||p()},[r]);const d=n=>{n.preventDefault(),t&&x(route("tables.transfer",t.id),{onSuccess:()=>a()})},f=o.filter(n=>n.status==="free"&&n.id!==t?.id).sort((n,h)=>n.number-h.number);return e.jsx(S,{show:r,onClose:a,maxWidth:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["Transferir Mesa ",t?.number]}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Para Mesa:"}),e.jsxs("select",{value:l.target_table_id,onChange:n=>c("target_table_id",n.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma mesa livre..."}),f.map(n=>e.jsxs("option",{value:n.id,children:["Mesa ",n.number]},n.id))]}),i.target_table_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.target_table_id})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(C,{onClick:a,children:"Cancelar"}),e.jsx(b,{disabled:u||!l.target_table_id,children:"Transferir"})]})]})]})})}function os({tables:r}){const[a,t]=m.useState(!1),[o,l]=m.useState(null),[c,x]=m.useState({show:!1,id:null}),[u,p]=m.useState({show:!1,table:null}),[i,d]=m.useState("grid"),[f,n]=m.useState(new Date);m.useEffect(()=>{const s=setInterval(()=>n(new Date),6e4);return()=>clearInterval(s)},[]),m.useEffect(()=>{const s=setInterval(()=>{i==="grid"&&$.visit(window.location.pathname,{only:["tables"],preserveScroll:!0,preserveState:!0,replace:!0})},3e4);return()=>clearInterval(s)},[i]);const{data:h,setData:g,post:v,put:w,delete:j,processing:N,reset:P,errors:_,clearErrors:q}=L({number:"",capacity:"4"});m.useEffect(()=>{a||(P(),q(),l(null))},[a]);const B=s=>{s.preventDefault(),o?w(route("tables.update",o.id),{onSuccess:()=>t(!1)}):v(route("tables.store"),{onSuccess:()=>t(!1)})},A=s=>{l(s),g({number:s.number.toString(),capacity:s.capacity.toString()}),t(!0)},F=s=>{x({show:!0,id:s.id})},G=()=>{c.id&&j(route("tables.destroy",c.id),{onFinish:()=>x({show:!1,id:null})})},H=s=>{s.status==="occupied"&&p({show:!0,table:{id:s.id,number:s.number}})},D=s=>{if(!s)return 0;const y=new Date(s).getTime(),k=f.getTime();return Math.floor((k-y)/(1e3*60))},O=s=>{if(s.status==="free")return"bg-green-100 text-green-800 border-green-200";if(s.status==="reserved")return"bg-blue-100 text-blue-800 border-blue-200";const y=D(s.occupied_since||s.occupied_at);return y>120?"bg-red-100 text-red-800 border-red-200 animate-pulse-slow":y>60?"bg-orange-100 text-orange-800 border-orange-200":"bg-yellow-100 text-yellow-800 border-yellow-200"},V=s=>{const y=Math.floor(s/60),k=s%60;return`${y}h ${k}m`};return e.jsxs(Y,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"GestÃ£o de Mesas"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-1 flex border border-gray-200 dark:border-gray-700 mr-2",children:[e.jsx("button",{onClick:()=>d("grid"),className:`p-2 rounded-md transition-colors ${i==="grid"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o em Grid",children:e.jsx(te,{size:20})}),e.jsx("button",{onClick:()=>d("map"),className:`p-2 rounded-md transition-colors ${i==="map"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o de Mapa",children:e.jsx(ae,{size:20})})]}),e.jsxs(b,{onClick:()=>t(!0),className:"flex items-center gap-2",children:[e.jsx(ie,{size:16})," Nova Mesa"]})]})]}),children:[e.jsx(X,{title:"Mesas"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})," Livre"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"})," Ocupada"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})," ",">"," 1h"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})," ",">"," 2h"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:i==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:r.map(s=>{const y=D(s.occupied_since||s.occupied_at);return e.jsxs("div",{className:`relative rounded-xl border-2 p-4 transition-all hover:shadow-md ${O(s)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Mesa ",s.number]}),e.jsx("button",{onClick:()=>A(s),className:"text-xs opacity-50 hover:opacity-100",children:"Editar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("span",{children:[s.capacity," Lugares"]})}),s.status==="occupied"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono mb-1",children:[e.jsx(se,{size:12}),V(y)]}),e.jsxs("div",{className:"flex items-center gap-1 font-bold text-lg",children:[e.jsx(re,{size:16}),new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.current_order?.total||0)]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsxs("button",{onClick:()=>H(s),className:"flex-1 bg-white/50 hover:bg-white/80 py-1 rounded text-xs font-semibold transition-colors flex items-center justify-center gap-1",children:[e.jsx(le,{size:12})," Transferir"]})})]}),s.status==="free"&&e.jsx("div",{className:"mt-8 text-center opacity-50 text-xs",children:"DisponÃ­vel"})]})]},s.id)})}):e.jsx(ue,{tables:r})})]})}),e.jsx(S,{show:a,onClose:()=>t(!1),children:e.jsxs("form",{onSubmit:B,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:o?"Editar Mesa":"Nova Mesa"}),e.jsxs("div",{className:"mt-6",children:[e.jsx(T,{htmlFor:"number",value:"NÃºmero da Mesa"}),e.jsx(E,{id:"number",type:"number",className:"mt-1 block w-full",value:h.number,onChange:s=>g("number",s.target.value),required:!0}),e.jsx(z,{message:_.number,className:"mt-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(T,{htmlFor:"capacity",value:"Capacidade"}),e.jsx(E,{id:"capacity",type:"number",className:"mt-1 block w-full",value:h.capacity,onChange:s=>g("capacity",s.target.value),required:!0}),e.jsx(z,{message:_.capacity,className:"mt-2"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[o&&e.jsx("button",{type:"button",onClick:()=>F(o),className:"text-red-600 hover:text-red-800",children:"Excluir"}),e.jsx(C,{onClick:()=>t(!1),children:"Cancelar"}),e.jsx(b,{disabled:N,children:"Salvar"})]})]})}),e.jsx(pe,{show:c.show,onClose:()=>x({show:!1,id:null}),onConfirm:G,title:"Excluir Mesa",message:"Tem certeza que deseja excluir esta mesa? Esta aÃ§Ã£o nÃ£o pode ser desfeita."}),e.jsx(he,{show:u.show,onClose:()=>p({show:!1,table:null}),sourceTable:u.table,tables:r})]})}export{os as default};
