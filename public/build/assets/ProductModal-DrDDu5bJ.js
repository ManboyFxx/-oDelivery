import{r as b,j as e,X as z,e as C}from"./app-BtsAJ1qH.js";import{t as w}from"./index-B5CeW4H0.js";import{S as I}from"./shopping-bag-BXUU6_cU.js";import{M as E}from"./minus-BY5E8KsV.js";import{P as v}from"./plus-Bctrjawf.js";function G({product:s,isOpen:u,onClose:g,onAddToCart:M,initialValues:d}){const[m,x]=b.useState(1),[N,f]=b.useState(""),[h,p]=b.useState({});if(b.useEffect(()=>{if(!(!s||!u))if(d){x(d.quantity),f(d.notes);const t={};d.selectedComplements.forEach(r=>{t[r.groupId]||(t[r.groupId]={}),t[r.groupId][r.optionId]=r.quantity||1}),p(t)}else x(1),f(""),p({})},[s,d,u]),!s||!u)return null;const y=(t,r,l,a,o)=>{p(i=>{const n=i[t]||{},c=n[r]||0,k=Math.max(0,Math.min(c+l,a));if(Object.values(n).reduce((q,O)=>q+O,0)-c+k>o)return w.error(`Máximo de ${o} opções permitidas.`),i;const j={...n};return k===0?delete j[r]:j[r]=k,{...i,[t]:j}})},_=t=>{const r=h[t]||{};return Object.values(r).reduce((l,a)=>l+a,0)},S=()=>{let t=Number(s.promotional_price&&Number(s.promotional_price)>0?s.promotional_price:s.price);return s.complement_groups?.forEach(r=>{const l=h[r.id]||{};Object.entries(l).forEach(([a,o])=>{const i=r.options.find(n=>n.id===a);i&&(t+=i.price*o)})}),t*m},$=()=>{if(s.complement_groups)for(const r of s.complement_groups){const l=_(r.id);if(r.is_required&&l===0){w.error(`"${r.name}" é obrigatório.`);return}if(l>0&&l<r.min_selections){w.error(`Selecione pelo menos ${r.min_selections} em "${r.name}".`);return}}const t=[];s.complement_groups?.forEach(r=>{const l=h[r.id]||{};Object.entries(l).forEach(([a,o])=>{const i=r.options.find(n=>n.id===a);if(i&&o>0)for(let n=0;n<o;n++)t.push({groupId:r.id,optionId:i.id,name:i.name,price:i.price,quantity:1})})}),M({product:s,quantity:m,notes:N,selectedComplements:t,subtotal:S()}),g()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:g}),e.jsxs("div",{className:"bg-white dark:bg-premium-dark w-full md:max-w-2xl h-full md:h-auto md:max-h-[90vh] md:rounded-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto animate-in slide-in-from-bottom md:slide-in-from-bottom-10 duration-300 transition-colors duration-300",children:[e.jsxs("div",{className:"h-48 md:h-64 relative shrink-0",children:[s.image_url?e.jsx("img",{src:s.image_url,className:"w-full h-full object-cover",alt:s.name}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-300",children:e.jsx(I,{className:"h-16 w-16"})}),e.jsx("button",{onClick:g,className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 p-2 rounded-full backdrop-blur-md transition-all group",children:e.jsx(z,{className:"h-5 w-5 text-white group-hover:scale-110 transition-transform"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/10 to-transparent"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 relative bg-white dark:bg-premium-dark transition-colors duration-300",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-black text-gray-900 dark:text-white leading-tight mb-2 transition-colors duration-300",children:s.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 leading-relaxed transition-colors duration-300",children:s.description}),e.jsxs("span",{className:"text-2xl font-black text-primary",children:["R$ ",Number(s.promotional_price||s.price).toFixed(2).replace(".",",")]}),s.promotional_price&&e.jsxs("span",{className:"ml-3 text-sm text-gray-400 line-through",children:["R$ ",Number(s.price).toFixed(2).replace(".",",")]})]}),s.complement_groups?.map(t=>{const r=_(t.id),l=(!t.is_required||r>=t.min_selections)&&r<=t.max_selections;return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-white dark:bg-premium-dark py-2 z-10 border-b border-gray-100 dark:border-white/5 transition-colors duration-300",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white text-lg flex items-center gap-2 transition-colors duration-300",children:[t.name,t.is_required&&e.jsx("span",{className:"text-primary text-xs font-black uppercase bg-primary/10 px-2 py-0.5 rounded-full",children:"Obrigatório"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 transition-colors duration-300",children:[t.min_selections>0?`Mín: ${t.min_selections}`:"",t.max_selections<100?` • Máx: ${t.max_selections}`:""]})]}),e.jsxs("div",{className:C("text-xs font-bold px-2 py-1 rounded-full transition-colors duration-300",l?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-gray-100 dark:bg-white/5 text-gray-500 dark:text-gray-400"),children:[r,"/",t.max_selections]})]}),e.jsx("div",{className:"space-y-3",children:t.options.map(a=>{const o=h[t.id]?.[a.id]||0,i=a.max_quantity||1,n=a.stock!==null&&a.stock!==void 0&&a.stock<=0,c=!n&&o<i&&r<t.max_selections;return e.jsxs("div",{className:C("flex items-center justify-between p-3 rounded-xl border transition-all duration-300",o>0?"border-primary bg-primary/5":"border-gray-100 dark:border-white/5",!n&&"cursor-pointer hover:border-gray-200 dark:hover:border-white/10",n&&"opacity-60 bg-gray-50 dark:bg-white/5 grayscale pointer-events-none"),children:[e.jsxs("div",{className:"flex-1",onClick:()=>c&&y(t.id,a.id,1,i,t.max_selections),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white transition-colors duration-300",children:a.name}),n&&e.jsx("span",{className:"text-[10px] font-black uppercase bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-400 px-2 py-0.5 rounded-full",children:"Esgotado"})]}),a.price>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:["+ R$ ",a.price.toFixed(2).replace(".",",")]})]}),o>0||c?e.jsxs("div",{className:"flex items-center gap-3 bg-white dark:bg-premium-card rounded-lg p-1 shadow-sm border border-gray-100 dark:border-white/5 transition-colors duration-300",children:[o>0&&e.jsx("button",{onClick:()=>y(t.id,a.id,-1,i,t.max_selections),className:"p-1 hover:bg-gray-100 dark:hover:bg-white/10 rounded text-gray-600 dark:text-gray-400 transition-colors",children:e.jsx(E,{className:"h-4 w-4"})}),o>0&&e.jsx("span",{className:"font-bold text-sm min-w-[1rem] text-center text-gray-900 dark:text-white transition-colors duration-300",children:o}),e.jsx("button",{onClick:()=>y(t.id,a.id,1,i,t.max_selections),disabled:!c,className:"p-1 hover:bg-gray-100 dark:hover:bg-white/10 rounded text-primary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(v,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"h-8 w-8 rounded-full border border-gray-200 dark:border-white/10 flex items-center justify-center text-gray-400 dark:text-gray-500 transition-colors duration-300",children:e.jsx(v,{className:"h-4 w-4"})})]},a.id)})})]},t.id)}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-bold text-gray-900 dark:text-white mb-2 transition-colors duration-300",children:"Observações"}),e.jsx("textarea",{value:N,onChange:t=>f(t.target.value),placeholder:"Ex: Sem cebola, capricha no molho...",className:"w-full p-4 bg-gray-50 dark:bg-white/5 border-none rounded-xl focus:ring-2 focus:ring-primary resize-none text-sm text-gray-900 dark:text-white placeholder:text-gray-400 transition-colors duration-300",rows:3})]})]}),e.jsx("div",{className:"p-4 md:p-6 border-t border-gray-100 dark:border-white/5 bg-white dark:bg-premium-dark md:rounded-b-3xl shrink-0 relative z-20 pb-safe transition-colors duration-300",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-100 dark:bg-white/5 rounded-xl px-2 transition-colors duration-300",children:[e.jsx("button",{onClick:()=>x(Math.max(1,m-1)),className:"h-10 w-10 flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-black text-xl w-8 text-center text-gray-900 dark:text-white transition-colors duration-300",children:m}),e.jsx("button",{onClick:()=>x(m+1),className:"h-10 w-10 flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors",children:e.jsx(v,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:$,style:{backgroundColor:"var(--primary-color)"},className:"flex-1 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/30 hover:brightness-90 transition-all active:scale-[0.98] flex items-center justify-between px-6",children:[e.jsx("span",{children:d?"Atualizar Pedido":"Adicionar"}),e.jsxs("span",{children:["R$ ",S().toFixed(2).replace(".",",")]})]})]})})]})]})}export{G as default};
