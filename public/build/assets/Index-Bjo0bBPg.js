import{r as o,f as V,j as r,H as X,X as q,a as E}from"./app-BXyMlLUz.js";import{A as J}from"./AuthenticatedLayout-E6_s-pLX.js";import W from"./OrderCard-DA9VFhQu.js";import Y from"./DraggableOrderCard-EjR1ixVR.js";import Z from"./OrderDrawer-rBAul0-h.js";import{u as ee}from"./useAudio-D1NmWy1e.js";import{CancelOrderModal as re,ChangePaymentModal as te,EditOrderModal as oe,ChangeModeModal as se}from"./ActionModals-CtWUE7F-.js";import{k as ae,l as ne,D as ie,f as le,m as de,P as ce}from"./core.esm-B-X7xcFo.js";import{S as me,v as ge}from"./sortable.esm-CTVrNzb_.js";import{C as ue}from"./circle-cGJGWeiR.js";import{C as pe}from"./clock-BMpG2T-n.js";import{C as be}from"./circle-check-big-DQ3-Kdof.js";import{T as xe}from"./truck-i2OXAo2H.js";import{P as he}from"./package-Dw6RWJWl.js";import{F as fe}from"./funnel-UBYXcRUp.js";import{M as ye}from"./map-pin-KFFclwG7.js";import{B as we}from"./bike-SjB7s5ea.js";import{C as ve}from"./credit-card-Bx_nyEOS.js";import"./monitor-C2g-NhzK.js";import"./shopping-bag-Ct5KnQUo.js";import"./image-BaL71x0I.js";import"./layout-dashboard-BrP5LJFB.js";import"./trophy-DxsfpHAT.js";import"./ticket-Dl2HfbCu.js";import"./store-BUaeC5xa.js";import"./dollar-sign-CgfgIfeN.js";import"./key-YVOJ2uE1.js";import"./shield-check-BatzzNC_.js";import"./log-out-CQyjOs1U.js";import"./transition-DGpf8mTk.js";import"./use-sync-refs-Dsm-tQoz.js";import"./Modal-Dl1SMN4X.js";import"./keyboard-Bpwv6H72.js";import"./portal-BMBVt7cf.js";import"./with-selector-CBuNQbeF.js";import"./hidden-CVBC7bsE.js";import"./switch-uunuhnAt.js";import"./use-resolve-button-type-BgK0qQN5.js";import"./menu-BgZ-UXnd.js";import"./chevron-down-8mviTGTy.js";import"./menu-g_LygtQZ.js";import"./search-CE6-t1DY.js";import"./sun-CqTEL7-k.js";import"./bell-8KNAYcsF.js";import"./eye-CjbhbC5x.js";import"./arrow-left-Dc4qfp1h.js";import"./circle-alert-BmuA3DUf.js";import"./user-BHsZ68Kf.js";import"./message-circle-DoXHebxa.js";import"./square-pen-D7qsKkZ_.js";import"./printer-LcPW67qJ.js";import"./check-ctV00WX5.js";import"./timer-C6ov1Zp5.js";import"./phone-Btf3Akpg.js";import"./InputLabel-Cth7rGlY.js";import"./TextInput-DzFHwf2U.js";function Nr({orders:n,motoboys:y=[],products:D=[]}){const M=o.useMemo(()=>[{id:"new",title:"Novos",statuses:["new"],icon:ue,iconColor:"text-blue-500",headerBg:"bg-white",borderColor:"border-blue-100",containerBg:"bg-gray-50/50",badgeColor:"bg-blue-50 text-blue-700 ring-1 ring-blue-700/10"},{id:"preparing",title:"Preparando",statuses:["preparing"],icon:pe,iconColor:"text-orange-500",headerBg:"bg-white",borderColor:"border-orange-100",containerBg:"bg-orange-50/30",badgeColor:"bg-orange-50 text-orange-700 ring-1 ring-orange-700/10"},{id:"ready",title:"Pronto / Aguardando",statuses:["ready","waiting_motoboy"],icon:be,iconColor:"text-green-500",headerBg:"bg-white",borderColor:"border-green-100",containerBg:"bg-green-50/30",badgeColor:"bg-green-50 text-green-700 ring-1 ring-green-700/10"},{id:"out_for_delivery",title:"Em Entrega",statuses:["motoboy_accepted","out_for_delivery"],icon:xe,iconColor:"text-cyan-500",headerBg:"bg-white",borderColor:"border-cyan-100",containerBg:"bg-cyan-50/30",badgeColor:"bg-cyan-50 text-cyan-700 ring-1 ring-cyan-700/10"}],[]),[s,c]=o.useState({neighborhood:"",motoboy:"",paymentStatus:""}),[p,A]=o.useState(!1),[B,w]=o.useState(null),[$,v]=o.useState(!1),T=o.useCallback(e=>{w(e),v(!0)},[]),F=o.useCallback(()=>{v(!1),setTimeout(()=>w(null),300)},[]),I=o.useMemo(()=>Array.from(new Set(n.filter(e=>e.address?.neighborhood).map(e=>e.address.neighborhood))),[n]),R=o.useMemo(()=>Array.from(new Set(n.filter(e=>e.motoboy).map(e=>e.motoboy.id))).map(e=>n.find(a=>a.motoboy?.id===e)?.motoboy).filter(Boolean),[n]),b=o.useMemo(()=>n.filter(e=>!(s.neighborhood&&e.address?.neighborhood!==s.neighborhood||s.motoboy&&e.motoboy?.id!==s.motoboy||s.paymentStatus&&e.payment_status!==s.paymentStatus)),[n,s]),L=o.useCallback((e,t)=>{const a=t||[e];return b.filter(i=>a.includes(i.status))},[b]),{play:z,initializeAudio:j}=ee(),{success:k,info:G}=V(),[C,H]=o.useState(!1),x=o.useRef({});o.useEffect(()=>{x.current=n.reduce((e,t)=>({...e,[t.id]:t.status}),{})},[]),o.useEffect(()=>{const e=()=>{H(!0),j()};return window.addEventListener("click",e,{once:!0}),()=>window.removeEventListener("click",e)},[j]),o.useEffect(()=>{const e=window.page?.props?.auth?.user?.tenant_id||window.page?.props?.tenant?.id;let t=0;const i=setInterval(async()=>{if(e)try{const l=await fetch(`/api/poll/${e}`);if(!l.ok)return;const{timestamp:d}=await l.json();if(t===0){t=d;return}d>t&&(console.log("[OrdersPolling] Change detected via Poll File. Reloading..."),t=d,E.reload({only:["orders"],preserveScroll:!0}))}catch{}},15e3);return()=>clearInterval(i)},[]),o.useEffect(()=>{const e=x.current,t=n.reduce((l,d)=>({...l,[d.id]:d.status}),{});console.log("[OrdersPolling] Update received",{count:n.length,audioEnabled:C});const a=n.some(l=>!e[l.id]&&l.status==="new"),i=n.some(l=>{const d=e[l.id];return d&&d!=="ready"&&l.status==="ready"});a&&console.log("[OrdersPolling] New order detected!"),i&&console.log("[OrdersPolling] Ready order detected!"),x.current=t},[n,C,z,k,G]);const[m,N]=o.useState(null),[g,S]=o.useState(null),O=o.useCallback((e,t)=>{if(N(t),e==="print")window.open(`/orders/${t.id}/print`,"_blank","width=400,height=600");else if(e==="whatsapp")if(t.customer_phone){const a=`Olá ${t.customer_name}, sobre seu pedido ${t.order_number}...`;window.open(`https://wa.me/55${t.customer_phone.replace(/\D/g,"")}?text=${encodeURIComponent(a)}`,"_blank")}else alert("Cliente sem telefone cadastrado.");else S(e)},[]),u=()=>{S(null),N(null)},[P,_]=o.useState(null),U=ae(ne(ce,{activationConstraint:{distance:8}})),K=e=>{const{active:t}=e,a=n.find(i=>i.id===t.id);_(a||null)},Q=e=>{const{active:t,over:a}=e;if(_(null),!a)return;const i=t.id,l=a.id,d=n.find(f=>f.id===i);if(!d||d.status===l)return;const h={new:"new",preparing:"preparing",ready:"ready",out_for_delivery:"out_for_delivery"}[l];h&&E.post(route("orders.status",d.id),{status:h},{preserveScroll:!0,onSuccess:()=>{const f={new:"Novo",preparing:"Em Preparo",ready:"Pronto",out_for_delivery:"Em Entrega"};k("Status Atualizado",`Pedido #${d.order_number} → ${f[h]}`)}})};return r.jsxs(J,{children:[r.jsx(X,{title:"Gerenciador de Pedidos"}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-500/20 rounded-xl",children:r.jsx(he,{className:"w-6 h-6 text-orange-600 dark:text-orange-500"})}),r.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight leading-none",children:"Kanban de Pedidos"})]}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 font-medium ml-1",children:"Gerencie o fluxo da sua cozinha e entregas em tempo real"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("button",{onClick:()=>A(!p),className:`flex items-center gap-2 px-4 py-2.5 rounded-2xl text-sm font-bold transition-colors shadow-sm ${p||Object.values(s).some(e=>e)?"bg-[#ff3d03] text-white":"bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 text-gray-700 dark:text-gray-300 hover:border-[#ff3d03]"}`,children:[r.jsx(fe,{className:"w-4 h-4"}),"Filtros",Object.values(s).filter(e=>e).length>0&&r.jsx("span",{className:"bg-white text-[#ff3d03] px-1.5 py-0.5 rounded-full text-xs font-black",children:Object.values(s).filter(e=>e).length})]}),r.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 px-4 py-2.5 rounded-2xl text-sm font-bold text-gray-700 dark:text-gray-300 shadow-sm",children:[r.jsxs("span",{className:"relative flex h-2.5 w-2.5 mr-1",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]}),b.length," pedidos ",Object.values(s).some(e=>e)?"filtrados":"ativos"]})]})]}),p&&r.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/10 rounded-2xl p-4 mb-4 shadow-sm",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(ye,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),r.jsxs("select",{value:s.neighborhood,onChange:e=>c({...s,neighborhood:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os bairros"}),I.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(we,{className:"w-4 h-4 inline mr-1"}),"Entregador"]}),r.jsxs("select",{value:s.motoboy,onChange:e=>c({...s,motoboy:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os entregadores"}),R.map(e=>e&&r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(ve,{className:"w-4 h-4 inline mr-1"}),"Pagamento"]}),r.jsxs("select",{value:s.paymentStatus,onChange:e=>c({...s,paymentStatus:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os status"}),r.jsx("option",{value:"paid",children:"Pago"}),r.jsx("option",{value:"pending",children:"Pendente"})]})]})]}),Object.values(s).some(e=>e)&&r.jsxs("button",{onClick:()=>c({neighborhood:"",motoboy:"",paymentStatus:""}),className:"mt-3 flex items-center gap-2 text-sm font-bold text-gray-600 dark:text-gray-400 hover:text-[#ff3d03] transition-colors",children:[r.jsx(q,{className:"w-4 h-4"}),"Limpar filtros"]})]}),r.jsxs(ie,{sensors:U,collisionDetection:le,onDragStart:K,onDragEnd:Q,children:[r.jsx("div",{className:"flex lg:grid lg:grid-cols-4 gap-4 flex-1 h-[calc(100vh-14rem)] overflow-x-auto lg:overflow-x-visible px-1 pb-2",children:M.map(e=>{const t=L(e.id,e.statuses),a=e.icon;return r.jsx(me,{id:e.id,items:t.map(i=>i.id),strategy:ge,children:r.jsxs("div",{className:"flex h-full flex-col rounded-[24px] bg-gray-50 dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/5 shadow-xl shadow-gray-200/50 dark:shadow-none min-w-[280px] lg:min-w-0",children:[r.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#1a1b1e] z-10 rounded-t-[24px]",children:r.jsxs("div",{className:"flex items-center justify-between rounded-xl p-3 bg-white dark:bg-black/20 border border-gray-100 dark:border-white/5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r.jsx("div",{className:`p-2 rounded-lg bg-gray-50 dark:bg-white/5 flex-shrink-0 ${e.iconColor}`,children:r.jsx(a,{className:"h-4 w-4"})}),r.jsx("span",{className:"font-extrabold text-gray-900 dark:text-white text-sm tracking-tight truncate",children:e.title})]}),r.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black flex-shrink-0 ${e.badgeColor}`,children:t.length})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-3 pb-3 space-y-3",children:[t.map(i=>r.jsx(Y,{order:i,motoboys:y,onAction:O,onQuickView:T},i.id)),t.length===0&&r.jsxs("div",{className:"flex flex-col items-center justify-center h-full max-h-48 rounded-[20px] border-2 border-dashed border-gray-200 dark:border-gray-800 text-gray-400 dark:text-gray-600 gap-2 mt-2 bg-gray-50/50 dark:bg-white/5 opacity-60",children:[r.jsx("div",{className:"p-3 bg-white dark:bg-black/20 rounded-full",children:r.jsx(a,{className:"h-6 w-6 opacity-40"})}),r.jsxs("span",{className:"text-[10px] font-bold opacity-60 uppercase tracking-widest text-center leading-tight",children:["Sem",r.jsx("br",{}),"pedidos"]})]})]})]})},e.id)})}),r.jsx(de,{children:P?r.jsx("div",{className:"rotate-3 scale-105 opacity-90",children:r.jsx(W,{order:P,motoboys:y,onAction:()=>{}})}):null})]}),r.jsx(re,{show:g==="cancel",onClose:u,order:m}),r.jsx(te,{show:g==="payment",onClose:u,order:m}),r.jsx(oe,{show:g==="edit",onClose:u,order:m,products:D}),r.jsx(se,{show:g==="mode",onClose:u,order:m}),r.jsx(Z,{order:B,isOpen:$,onClose:F,onAction:O})]})}export{Nr as default};
