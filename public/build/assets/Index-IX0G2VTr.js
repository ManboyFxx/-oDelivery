import{r as o,g as te,f as oe,j as e,H as se,X as ae,a as v}from"./app-Cx3cgXM2.js";import{A as ne}from"./AuthenticatedLayout-Bbl25tax.js";import ie from"./OrderCard-Br2u4IQb.js";import le from"./DraggableOrderCard-DHfmN_51.js";import de from"./OrderDrawer-BLAd5e8_.js";import{CancelOrderModal as ce,ChangePaymentModal as me,EditOrderModal as ge,ChangeModeModal as pe}from"./ActionModals-BlqUEUxt.js";import{k as ue,l as be,D as xe,f as he,m as fe,P as ye}from"./core.esm-7F8UceU9.js";import{S as we,v as ve}from"./sortable.esm-CuSzYDwL.js";import{C as je}from"./circle-DxBsv439.js";import{C as T}from"./clock-DJdcJ2FD.js";import{C as $}from"./circle-check-big-BO7OXLHZ.js";import{T as ke}from"./truck-BajuGxOI.js";import{P as Ce}from"./package-BCt3JMy6.js";import{F as Ne}from"./funnel-DNO-0Vbt.js";import{M as Se}from"./map-pin-DDU3nAUZ.js";import{B as Oe}from"./bike-u0cMTUjo.js";import{C as Pe}from"./credit-card-Das6RB7z.js";import"./monitor-BjsFBSpo.js";import"./shopping-bag-Dt5fI6jT.js";import"./image-2SCNV96Z.js";import"./layout-dashboard-cJurO7nx.js";import"./users-CbkkMleq.js";import"./trophy-CLJqSqC6.js";import"./ticket-Cb8-YVvF.js";import"./store-43U2ID1w.js";import"./dollar-sign-BuRckq9q.js";import"./key-DKoSdwPq.js";import"./shield-check-D2U-vU_Y.js";import"./log-out-Bphuj6ye.js";import"./transition-88o-B9Zp.js";import"./use-sync-refs-CaLEq2-0.js";import"./Modal-D03tHT1i.js";import"./keyboard-B_38l2P1.js";import"./portal-DjjVrdLK.js";import"./with-selector-D518Hfsn.js";import"./hidden-B55xahXY.js";import"./switch-B8QqeLIm.js";import"./use-resolve-button-type-C7MX_GDj.js";import"./menu-BI-bRDCP.js";import"./chevron-down-eOQwNN6m.js";import"./circle-play-CvC3ismw.js";import"./menu-MAV0q-td.js";import"./search-CtRZDzlZ.js";import"./sun-jQ8rwZ8g.js";import"./bell-CXIQ6ogS.js";import"./eye-BYUZ1bRk.js";import"./arrow-left-BUO6efmf.js";import"./usePushNotifications-B0NsDNjZ.js";import"./zap-9eCrRhF_.js";import"./star-pVcfQ78Z.js";import"./chevron-right-OVTExo7F.js";import"./lock-B2OVZCRR.js";import"./circle-alert-DTDBhQsW.js";import"./user-Ce1Gk3gn.js";import"./message-circle-mfk-WMVw.js";import"./square-pen-BGmacyg7.js";import"./printer-BM8HjI24.js";import"./check-Zh6OA7WT.js";import"./timer-BFHQW7we.js";import"./phone-BQ93Dnvb.js";import"./InputLabel-hnSbWUOk.js";import"./TextInput-29xmlE6e.js";function Fr({orders:n,motoboys:j=[],products:I=[],estimatedTime:c=40}){const[b,k]=o.useState(c),[F,C]=o.useState(!1);o.useEffect(()=>{k(c)},[c]);const R=r=>{k(parseInt(r.target.value)||0)},L=()=>{C(!0),v.post(route("orders.update-time"),{estimated_delivery_time:b},{preserveScroll:!0,onFinish:()=>C(!1)})},z=o.useMemo(()=>[{id:"new",title:"Novos",statuses:["new"],icon:je,iconColor:"text-blue-500",headerBg:"bg-white",borderColor:"border-blue-100",containerBg:"bg-gray-50/50",badgeColor:"bg-blue-50 text-blue-700 ring-1 ring-blue-700/10"},{id:"preparing",title:"Preparando",statuses:["preparing"],icon:T,iconColor:"text-orange-500",headerBg:"bg-white",borderColor:"border-orange-100",containerBg:"bg-orange-50/30",badgeColor:"bg-orange-50 text-orange-700 ring-1 ring-orange-700/10"},{id:"ready",title:"Pronto / Aguardando",statuses:["ready","waiting_motoboy"],icon:$,iconColor:"text-green-500",headerBg:"bg-white",borderColor:"border-green-100",containerBg:"bg-green-50/30",badgeColor:"bg-green-50 text-green-700 ring-1 ring-green-700/10"},{id:"out_for_delivery",title:"Em Entrega",statuses:["out_for_delivery"],icon:ke,iconColor:"text-cyan-500",headerBg:"bg-white",borderColor:"border-cyan-100",containerBg:"bg-cyan-50/30",badgeColor:"bg-cyan-50 text-cyan-700 ring-1 ring-cyan-700/10"}],[]),[s,m]=o.useState({neighborhood:"",motoboy:"",paymentStatus:""}),[x,U]=o.useState(!1),[G,N]=o.useState(null),[H,S]=o.useState(!1),K=o.useCallback(r=>{N(r),S(!0)},[]),Q=o.useCallback(()=>{S(!1),setTimeout(()=>N(null),300)},[]),V=o.useMemo(()=>Array.from(new Set(n.filter(r=>r.address?.neighborhood).map(r=>r.address.neighborhood))),[n]),X=o.useMemo(()=>Array.from(new Set(n.filter(r=>r.motoboy).map(r=>r.motoboy.id))).map(r=>n.find(a=>a.motoboy?.id===r)?.motoboy).filter(Boolean),[n]),h=o.useMemo(()=>n.filter(r=>!(s.neighborhood&&r.address?.neighborhood!==s.neighborhood||s.motoboy&&r.motoboy?.id!==s.motoboy||s.paymentStatus&&r.payment_status!==s.paymentStatus)),[n,s]),q=o.useCallback((r,t)=>{const a=t||[r];return h.filter(i=>a.includes(i.status))},[h]),{play:J,initializeAudio:O}=te(),{success:P,info:W}=oe(),[_,Y]=o.useState(!1),f=o.useRef({});o.useEffect(()=>{f.current=n.reduce((r,t)=>({...r,[t.id]:t.status}),{})},[]),o.useEffect(()=>{const r=()=>{Y(!0),O()};return window.addEventListener("click",r,{once:!0}),()=>window.removeEventListener("click",r)},[O]),o.useEffect(()=>{const r=window.page?.props?.auth?.user?.tenant_id||window.page?.props?.tenant?.id;let t=0;const i=setInterval(async()=>{if(r)try{const l=await fetch(`/api/poll/${r}`);if(!l.ok)return;const{timestamp:d}=await l.json();if(t===0){t=d;return}d>t&&(console.log("[OrdersPolling] Change detected via Poll File. Reloading..."),t=d,v.reload({only:["orders"],preserveScroll:!0}))}catch{}},15e3);return()=>clearInterval(i)},[]),o.useEffect(()=>{const r=f.current,t=n.reduce((l,d)=>({...l,[d.id]:d.status}),{});console.log("[OrdersPolling] Update received",{count:n.length,audioEnabled:_});const a=n.some(l=>!r[l.id]&&l.status==="new"),i=n.some(l=>{const d=r[l.id];return d&&d!=="ready"&&l.status==="ready"});a&&console.log("[OrdersPolling] New order detected!"),i&&console.log("[OrdersPolling] Ready order detected!"),f.current=t},[n,_,J,P,W]);const[g,E]=o.useState(null),[p,D]=o.useState(null),M=o.useCallback((r,t)=>{if(E(t),r==="print")window.open(`/orders/${t.id}/print`,"_blank","width=400,height=600");else if(r==="whatsapp")if(t.customer_phone){const a=`Olá ${t.customer_name}, sobre seu pedido ${t.order_number}...`;window.open(`https://wa.me/55${t.customer_phone.replace(/\D/g,"")}?text=${encodeURIComponent(a)}`,"_blank")}else alert("Cliente sem telefone cadastrado.");else D(r)},[]),u=()=>{D(null),E(null)},[A,B]=o.useState(null),Z=ue(be(ye,{activationConstraint:{distance:8}})),ee=r=>{const{active:t}=r,a=n.find(i=>i.id===t.id);B(a||null)},re=r=>{const{active:t,over:a}=r;if(B(null),!a)return;const i=t.id,l=a.id,d=n.find(w=>w.id===i);if(!d||d.status===l)return;const y={new:"new",preparing:"preparing",ready:"ready",out_for_delivery:"out_for_delivery"}[l];y&&v.post(route("orders.status",d.id),{status:y},{preserveScroll:!0,onSuccess:()=>{const w={new:"Novo",preparing:"Em Preparo",ready:"Pronto",out_for_delivery:"Em Entrega"};P("Status Atualizado",`Pedido #${d.order_number} → ${w[y]}`)}})};return e.jsxs(ne,{children:[e.jsx(se,{title:"Gerenciador de Pedidos"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-500/20 rounded-xl",children:e.jsx(Ce,{className:"w-6 h-6 text-orange-600 dark:text-orange-500"})}),e.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight leading-none",children:"Kanban de Pedidos"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 font-medium ml-1",children:"Gerencie o fluxo da sua cozinha e entregas em tempo real"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 pl-3 pr-1 py-1 rounded-2xl shadow-sm",children:[e.jsxs("label",{className:"text-xs font-bold text-gray-500 flex items-center gap-1",children:[e.jsx(T,{className:"w-3.5 h-3.5"})," Previsão:"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:"5",max:"180",step:"5",value:b,onChange:R,className:"w-16 h-8 text-sm font-bold text-gray-900 dark:text-white border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-black/20 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 text-center px-1"}),e.jsx("span",{className:"text-xs font-bold text-gray-400 mr-1",children:"min"}),b!==c&&e.jsx("button",{onClick:L,disabled:F,className:"bg-green-500 hover:bg-green-600 text-white p-1.5 rounded-lg transition-colors flex items-center justify-center disabled:opacity-50",title:"Salvar Tempo Base",children:e.jsx($,{className:"w-4 h-4"})})]})]}),e.jsxs("button",{onClick:()=>U(!x),className:`flex items-center gap-2 px-4 py-2.5 rounded-2xl text-sm font-bold transition-colors shadow-sm ${x||Object.values(s).some(r=>r)?"bg-[#ff3d03] text-white":"bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 text-gray-700 dark:text-gray-300 hover:border-[#ff3d03]"}`,children:[e.jsx(Ne,{className:"w-4 h-4"}),"Filtros",Object.values(s).filter(r=>r).length>0&&e.jsx("span",{className:"bg-white text-[#ff3d03] px-1.5 py-0.5 rounded-full text-xs font-black",children:Object.values(s).filter(r=>r).length})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 px-4 py-2.5 rounded-2xl text-sm font-bold text-gray-700 dark:text-gray-300 shadow-sm",children:[e.jsxs("span",{className:"relative flex h-2.5 w-2.5 mr-1",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]}),h.length," pedidos ",Object.values(s).some(r=>r)?"filtrados":"ativos"]})]})]}),x&&e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/10 rounded-2xl p-4 mb-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Se,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),e.jsxs("select",{value:s.neighborhood,onChange:r=>m({...s,neighborhood:r.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[e.jsx("option",{value:"",children:"Todos os bairros"}),V.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 inline mr-1"}),"Entregador"]}),e.jsxs("select",{value:s.motoboy,onChange:r=>m({...s,motoboy:r.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[e.jsx("option",{value:"",children:"Todos os entregadores"}),X.map(r=>r&&e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 inline mr-1"}),"Pagamento"]}),e.jsxs("select",{value:s.paymentStatus,onChange:r=>m({...s,paymentStatus:r.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"pending",children:"Pendente"})]})]})]}),Object.values(s).some(r=>r)&&e.jsxs("button",{onClick:()=>m({neighborhood:"",motoboy:"",paymentStatus:""}),className:"mt-3 flex items-center gap-2 text-sm font-bold text-gray-600 dark:text-gray-400 hover:text-[#ff3d03] transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),"Limpar filtros"]})]}),e.jsxs(xe,{sensors:Z,collisionDetection:he,onDragStart:ee,onDragEnd:re,children:[e.jsx("div",{className:"flex lg:grid lg:grid-cols-4 gap-4 flex-1 h-[calc(100vh-14rem)] overflow-x-auto lg:overflow-x-visible px-1 pb-2",children:z.map(r=>{const t=q(r.id,r.statuses),a=r.icon;return e.jsx(we,{id:r.id,items:t.map(i=>i.id),strategy:ve,children:e.jsxs("div",{className:"flex h-full flex-col rounded-[24px] bg-gray-50 dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/5 shadow-xl shadow-gray-200/50 dark:shadow-none min-w-[280px] lg:min-w-0",children:[e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#1a1b1e] z-10 rounded-t-[24px]",children:e.jsxs("div",{className:"flex items-center justify-between rounded-xl p-3 bg-white dark:bg-black/20 border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gray-50 dark:bg-white/5 flex-shrink-0 ${r.iconColor}`,children:e.jsx(a,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-extrabold text-gray-900 dark:text-white text-sm tracking-tight truncate",children:r.title})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black flex-shrink-0 ${r.badgeColor}`,children:t.length})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-3 pb-3 space-y-3",children:[t.map(i=>e.jsx(le,{order:i,motoboys:j,onAction:M,onQuickView:K},i.id)),t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full max-h-48 rounded-[20px] border-2 border-dashed border-gray-200 dark:border-gray-800 text-gray-400 dark:text-gray-600 gap-2 mt-2 bg-gray-50/50 dark:bg-white/5 opacity-60",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-black/20 rounded-full",children:e.jsx(a,{className:"h-6 w-6 opacity-40"})}),e.jsxs("span",{className:"text-[10px] font-bold opacity-60 uppercase tracking-widest text-center leading-tight",children:["Sem",e.jsx("br",{}),"pedidos"]})]})]})]})},r.id)})}),e.jsx(fe,{children:A?e.jsx("div",{className:"rotate-3 scale-105 opacity-90",children:e.jsx(ie,{order:A,motoboys:j,onAction:()=>{}})}):null})]}),e.jsx(ce,{show:p==="cancel",onClose:u,order:g}),e.jsx(me,{show:p==="payment",onClose:u,order:g}),e.jsx(ge,{show:p==="edit",onClose:u,order:g,products:I}),e.jsx(pe,{show:p==="mode",onClose:u,order:g}),e.jsx(de,{order:G,isOpen:H,onClose:Q,onAction:M})]})}export{Fr as default};
