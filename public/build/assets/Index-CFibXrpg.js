import{r as s,b as P,j as e,H as T,a as n}from"./app-BeiTK8O7.js";import{A as q,M as D}from"./AuthenticatedLayout-BtNzUuQ3.js";import{W as F,a as M}from"./wifi-BF15L6c6.js";import{R as C}from"./refresh-cw-BH4wleWB.js";import{S as O}from"./smartphone-Cd7ShSlT.js";import{Q as K}from"./qr-code-CJD1dz57.js";import{T as U}from"./trash-2--0rQBpLT.js";import"./monitor-BDRP01qu.js";import"./shopping-bag-hl0p71xX.js";import"./package-CEUpl4-U.js";import"./image-BG7Ub9h9.js";import"./layout-dashboard-CSg-5LrW.js";import"./credit-card-CIOk5m4Q.js";import"./users-CZWQ_-4D.js";import"./trophy-woHj7yoO.js";import"./ticket-DneXDJ_e.js";import"./store-C7665HT-.js";import"./dollar-sign-mA4ymkos.js";import"./key-CQvEDJ22.js";import"./shield-check-B9isBl6q.js";import"./log-out-jkVU1Rox.js";import"./transition-CBp3oMBM.js";import"./use-sync-refs-Bh1C4zpM.js";import"./Modal-2QFZ16oO.js";import"./keyboard-B_lk7WoT.js";import"./portal-Iwu6bisq.js";import"./with-selector-oSkNhEYU.js";import"./hidden-CMxKSJQJ.js";import"./truck-DGriCJtF.js";import"./switch-D1W3lKyY.js";import"./use-resolve-button-type-DRTzruyL.js";import"./menu-CgDjUqwt.js";import"./chevron-down-HJU_jkfX.js";import"./clock-BXCeX13J.js";import"./circle-play-B344MPTV.js";import"./menu-CjUl8ut6.js";import"./search-a38Vqx5c.js";import"./sun-Ka4C_pFu.js";import"./bell-BgpWhUXC.js";import"./eye-CbhF-INM.js";import"./arrow-left-BwlAY5OQ.js";import"./usePushNotifications-DUwXs6sv.js";import"./zap-DLpij74m.js";import"./star-CvHf3rTp.js";import"./chevron-right-Byj7wEsR.js";import"./lock-Cduow9Aa.js";function Te({instance:o,logs:g,currentConfig:f,enableOtpVerification:S}){const[d,c]=s.useState(null),[x,l]=s.useState(!1),[r,b]=s.useState(o?.status||"disconnected"),[p,_]=s.useState(o?.instance_name||"odelivery_master"),[m,A]=s.useState(f.url),[h,E]=s.useState(f.apikey),[y,u]=s.useState(!1),[j,w]=s.useState(S),{props:I}=P(),{flash:i,errors:N}=I,Q=()=>{l(!0),n.post(route("admin.whatsapp.connect"),{instance_name:p,evolution_url:m,evolution_apikey:h},{onFinish:()=>l(!1)})},v=()=>{confirm("Tem certeza? Isso irá desconectar o WhatsApp de todos os clientes do plano Basic/Pro.")&&n.post(route("admin.whatsapp.disconnect"))},R=()=>{const t=!j;w(t),n.post(route("admin.whatsapp.update-settings"),{enable_otp_verification:t},{preserveScroll:!0,onError:()=>w(!t)})},k=async()=>{l(!0);try{const t=await fetch(route("admin.whatsapp.qrcode"));if(!t.ok){if(t.status===404){console.log("QR Code still not available, will retry...");return}const L=await t.json();console.error("Error fetching QR code:",L);return}const a=await t.json();if(a.already_connected){b("connected"),c(null),u(!1),o?.status!=="connected"&&n.reload();return}a.qr_code&&c(a.qr_code)}catch(t){console.error("Failed to load QR code:",t)}finally{l(!1)}},W=async()=>{try{const a=await(await fetch(route("admin.whatsapp.status"))).json();b(a.status),a.status==="connected"&&(c(null),o?.status!=="connected"&&n.reload())}catch(t){console.error(t)}};return s.useEffect(()=>{let t,a;return(r==="connecting"||d)&&(t=setInterval(W,3e3)),r==="connecting"&&!d&&(u(!0),a=setInterval(async()=>{await k()},4e3)),()=>{clearInterval(t),clearInterval(a),r==="connecting"&&!d&&u(!1)}},[r,d]),e.jsxs(q,{children:[e.jsx(T,{title:"WhatsApp Master"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-[#ff3d03]/10 text-[#ff3d03] text-[10px] font-bold uppercase tracking-wider",children:"Infraestrutura"})}),e.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight",children:"WhatsApp Master"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Gerencie a conexão principal compartilhada (Planos Basic/Pro)."})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm p-8",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Configurações de Segurança"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-bold text-gray-900 dark:text-white",children:"Verificação de Cliente (OTP)"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-2xl",children:"Quando ativado, novos clientes ou dispositivos desconhecidos precisarão confirmar um código enviado via WhatsApp para fazer login. Desative se estiver com problemas no envio de mensagens."})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:j,onChange:R}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[#ff3d03]"})]})]})]}),i?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm font-medium",children:i.error}),N?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm font-medium",children:N.error}),i?.success&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-xl text-sm font-medium",children:i.success}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm p-8",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Status da Conexão"}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:`h-24 w-24 rounded-full flex items-center justify-center mb-4 ${r==="connected"?"bg-green-100 text-green-600 dark:bg-green-900/20":r==="connecting"?"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/20 animate-pulse":"bg-gray-100 text-gray-400 dark:bg-gray-800"}`,children:r==="connected"?e.jsx(F,{className:"h-10 w-10"}):r==="connecting"?e.jsx(C,{className:"h-10 w-10 animate-spin"}):e.jsx(M,{className:"h-10 w-10"})}),e.jsx("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1",children:r==="connected"?"Conectado":r==="connecting"?"Conectando...":"Desconectado"}),o?.phone_number&&e.jsx("p",{className:"text-sm text-gray-500",children:o.phone_number})]}),e.jsx("div",{className:"space-y-3",children:o?r!=="connected"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:k,disabled:x||y,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-600/30 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(K,{className:"h-4 w-4"}),"Ler QR Code"]}),y&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Preparando QR Code..."}),e.jsx("button",{onClick:v,className:"w-full py-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl font-bold hover:bg-gray-200 dark:hover:bg-gray-700 transition-all",children:"Resetar"})]}):e.jsxs("button",{onClick:v,className:"w-full py-3 bg-red-100 text-red-600 hover:bg-red-200 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Desconectar"]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evolution API URL"}),e.jsx("input",{type:"url",value:m,onChange:t=>A(t.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"https://sua-evolution.com"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Global API Key"}),e.jsx("input",{type:"password",value:h,onChange:t=>E(t.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"Sua chave global da Evolution"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Nome da Instância"}),e.jsx("input",{type:"text",value:p,onChange:t=>_(t.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"Ex: odelivery_master"})]}),e.jsxs("button",{onClick:Q,disabled:x||!p||!m||!h,className:"w-full py-3 bg-[#ff3d03] hover:bg-[#e03603] text-white rounded-xl font-bold shadow-lg shadow-[#ff3d03]/30 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[x?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),"Salvar e Iniciar"]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:d?e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm p-8 flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Escanear QR Code"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Abra o WhatsApp e escaneie para conectar."}),e.jsx("div",{className:"p-4 bg-white rounded-xl shadow-inner border border-gray-100",children:e.jsx("img",{src:d,alt:"QR Code",className:"w-64 h-64"})})]}):e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm overflow-hidden min-h-[400px]",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 dark:border-white/5",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-gray-400"}),"Logs Recentes"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-white/5 text-gray-500 font-medium border-b border-gray-100 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Tenant"}),e.jsx("th",{className:"px-6 py-3",children:"Telefone"}),e.jsx("th",{className:"px-6 py-3",children:"Template"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-white/5",children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:"Nenhum log registrado ainda."})}):g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-white",children:t.tenant?.name||"Sistema"}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:t.phone_number}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:t.template_key}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.status==="sent"?"bg-green-100 text-green-700":t.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:t.status==="sent"?"Enviado":"Falha"})}),e.jsx("td",{className:"px-6 py-4 text-gray-500 text-xs",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})})]})})]})]})]})}export{Te as default};
