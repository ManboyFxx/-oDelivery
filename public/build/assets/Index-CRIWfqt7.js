import{c as _,k as O,i as E,r as a,a as P,j as e,H as S}from"./app-DwErbC-G.js";import{A}from"./AuthenticatedLayout-DmWtI5CW.js";import B from"./OrderCard-BFfySyHo.js";import{CancelOrderModal as M,ChangePaymentModal as $,EditOrderModal as I,ChangeModeModal as R}from"./ActionModals-Dn6re4lC.js";import{P as T}from"./menu-CE40_6Rd.js";import{C as z}from"./clock-ClJcnN2X.js";import{C as L}from"./circle-check-big-DZ8P_YLZ.js";import{T as G}from"./truck-DGfZNCaZ.js";import"./shopping-bag-DbkTPhjR.js";import"./credit-card-D3T0beRy.js";import"./trophy-UZ6Unuqn.js";import"./chart-column-_T_UFLQR.js";import"./ticket-BWzHrJE5.js";import"./shield-check-BJRvzGtu.js";import"./log-out-Cu8ck9e9.js";import"./transition-DyVhLiFv.js";import"./Modal-DQ0Epy3j.js";import"./portal-V1Z2qU1y.js";import"./switch-DhIHnDyj.js";import"./use-resolve-button-type-B8uHpfvB.js";import"./chevron-down-Dw31GkiG.js";import"./search-BJW68Hou.js";import"./sparkles-BqKDAV7i.js";import"./arrow-right-Beh7ukUr.js";import"./circle-alert-Ce8txrrL.js";import"./user-D2aTdj2E.js";import"./message-circle-kh13b4gV.js";import"./map-pin-t7TGAbDg.js";import"./bike-CnRTdwCT.js";import"./square-pen-Bn0UA2nm.js";import"./printer-CG7UwXdg.js";import"./check-YI33u5AH.js";import"./timer-BCmaRvDX.js";import"./InputLabel-DvNe82DZ.js";import"./TextInput-CCwg8HwO.js";const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],U=_("circle",H);function Ce({orders:o,motoboys:h=[],products:f=[]}){const w=[{id:"new",title:"Novos",statuses:["new"],icon:U,iconColor:"text-blue-500",headerBg:"bg-white",borderColor:"border-blue-100",containerBg:"bg-gray-50/50",badgeColor:"bg-blue-50 text-blue-700 ring-1 ring-blue-700/10"},{id:"preparing",title:"Preparando",statuses:["preparing"],icon:z,iconColor:"text-orange-500",headerBg:"bg-white",borderColor:"border-orange-100",containerBg:"bg-orange-50/30",badgeColor:"bg-orange-50 text-orange-700 ring-1 ring-orange-700/10"},{id:"ready",title:"Pronto / Aguardando",statuses:["ready","waiting_motoboy"],icon:L,iconColor:"text-green-500",headerBg:"bg-white",borderColor:"border-green-100",containerBg:"bg-green-50/30",badgeColor:"bg-green-50 text-green-700 ring-1 ring-green-700/10"},{id:"out_for_delivery",title:"Em Entrega",statuses:["motoboy_accepted","out_for_delivery"],icon:G,iconColor:"text-indigo-500",headerBg:"bg-white",borderColor:"border-indigo-100",containerBg:"bg-indigo-50/30",badgeColor:"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-700/10"}],y=(r,t)=>{const s=t||[r];return o.filter(n=>s.includes(n.status))},{play:j,initializeAudio:p}=O(),{success:k,info:v}=E(),[x,C]=a.useState(!1),m=a.useRef({});a.useEffect(()=>{m.current=o.reduce((r,t)=>({...r,[t.id]:t.status}),{})},[]),a.useEffect(()=>{const r=()=>{C(!0),p()};return window.addEventListener("click",r,{once:!0}),()=>window.removeEventListener("click",r)},[p]),a.useEffect(()=>{const r=setInterval(()=>{P.reload({only:["orders"],preserveScroll:!0})},15e3);return()=>clearInterval(r)},[]),a.useEffect(()=>{const r=m.current,t=o.reduce((i,d)=>({...i,[d.id]:d.status}),{});console.log("[OrdersPolling] Update received",{count:o.length,audioEnabled:x});const s=o.some(i=>!r[i.id]&&i.status==="new"),n=o.some(i=>{const d=r[i.id];return d&&d!=="ready"&&i.status==="ready"});s&&console.log("[OrdersPolling] New order detected!"),n&&console.log("[OrdersPolling] Ready order detected!"),m.current=t},[o,x,j,k,v]);const[l,u]=a.useState(null),[c,b]=a.useState(null),N=(r,t)=>{if(u(t),r==="print")window.open(`/orders/${t.id}/print`,"_blank","width=400,height=600");else if(r==="whatsapp")if(t.customer_phone){const s=`OlÃ¡ ${t.customer_name}, sobre seu pedido ${t.order_number}...`;window.open(`https://wa.me/55${t.customer_phone.replace(/\D/g,"")}?text=${encodeURIComponent(s)}`,"_blank")}else alert("Cliente sem telefone cadastrado.");else b(r)},g=()=>{b(null),u(null)};return e.jsxs(A,{children:[e.jsx(S,{title:"Gerenciador de Pedidos"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-500/20 rounded-xl",children:e.jsx(T,{className:"w-6 h-6 text-orange-600 dark:text-orange-500"})}),e.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight leading-none",children:"Kanban de Pedidos"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 font-medium ml-1",children:"Gerencie o fluxo da sua cozinha e entregas em tempo real"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 px-4 py-2.5 rounded-2xl text-sm font-bold text-gray-700 dark:text-gray-300 shadow-sm",children:[e.jsxs("span",{className:"relative flex h-2.5 w-2.5 mr-1",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]}),o.length," pedidos ativos"]})})]}),e.jsx("div",{className:"flex lg:grid lg:grid-cols-4 gap-4 flex-1 h-[calc(100vh-14rem)] overflow-x-auto lg:overflow-x-visible px-1 pb-2",children:w.map(r=>{const t=y(r.id,r.statuses),s=r.icon;return e.jsxs("div",{className:"flex h-full flex-col rounded-[24px] bg-gray-50 dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/5 shadow-xl shadow-gray-200/50 dark:shadow-none min-w-[280px] lg:min-w-0",children:[e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#1a1b1e] z-10 rounded-t-[24px]",children:e.jsxs("div",{className:"flex items-center justify-between rounded-xl p-3 bg-white dark:bg-black/20 border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gray-50 dark:bg-white/5 flex-shrink-0 ${r.iconColor}`,children:e.jsx(s,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-extrabold text-gray-900 dark:text-white text-sm tracking-tight truncate",children:r.title})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black flex-shrink-0 ${r.badgeColor}`,children:t.length})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-3 pb-3 space-y-3",children:[t.map(n=>e.jsx(B,{order:n,motoboys:h,onAction:N},n.id)),t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full max-h-48 rounded-[20px] border-2 border-dashed border-gray-200 dark:border-gray-800 text-gray-400 dark:text-gray-600 gap-2 mt-2 bg-gray-50/50 dark:bg-white/5 opacity-60",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-black/20 rounded-full",children:e.jsx(s,{className:"h-6 w-6 opacity-40"})}),e.jsxs("span",{className:"text-[10px] font-bold opacity-60 uppercase tracking-widest text-center leading-tight",children:["Sem",e.jsx("br",{}),"pedidos"]})]})]})]},r.id)})}),e.jsx(M,{show:c==="cancel",onClose:g,order:l}),e.jsx($,{show:c==="payment",onClose:g,order:l}),e.jsx(I,{show:c==="edit",onClose:g,order:l,products:f}),e.jsx(R,{show:c==="mode",onClose:g,order:l})]})}export{Ce as default};
