import{r as l,f as T,j as e,e as R,d as f}from"./app-Cx3cgXM2.js";import{T as x}from"./TextInput-29xmlE6e.js";import{I as h}from"./InputLabel-hnSbWUOk.js";import{P as $}from"./PrimaryButton-H6nUQJyf.js";import{S as q}from"./SecondaryButton-DBxr0aft.js";import{L as S}from"./loader-circle-CUOizvEd.js";import{S as Z}from"./search-CtRZDzlZ.js";function W({onCancel:b,onSuccess:C,tenantId:i,customerId:k,preloadedZones:n=[],initialData:o,store:c}){const[p,y]=l.useState(!1),E=c?.address?.city||c?.settings?.address?.city||"",F=c?.address?.state||c?.settings?.address?.state||"",[s,m]=l.useState({zip_code:o?.zip_code||"00000-000",street:o?.street||"",number:o?.number||"",complement:o?.complement||"",neighborhood:o?.neighborhood||"",city:o?.city||E,state:o?.state||F}),{success:v,error:j}=T(),[u,g]=l.useState(n.length>0?n:null),[_,N]=l.useState(!0),[A,w]=l.useState(o?!0:null),B=n?.length||0;l.useEffect(()=>{let r=!0;const t=()=>{r&&N(!1)};if(n&&n.length>0){console.log("AddressForm: Using preloaded zones",n.length),g(n),t();return}if(!i){console.warn("AddressForm: Waiting for tenantId...");const a=setTimeout(t,3e3);return()=>{r=!1,clearTimeout(a)}}return(async()=>{if(r){N(!0);try{console.log("AddressForm: Fetching zones for tenant",i);const a=await f.get(`/api/delivery-zones?tenant_id=${i}`);console.log("AddressForm: Zones fetched",a.data?.length),r&&g(a.data||[])}catch(a){console.error("Error fetching delivery zones:",a),r&&g([])}finally{t()}}})(),()=>{r=!1}},[i,B]);const L=r=>{const t=r.target.value,d=u?.find(a=>a.neighborhood===t);m(a=>({...a,neighborhood:t})),w(d?!0:t?!1:null)},z=async r=>{if(r.preventDefault(),!s.neighborhood){j("Bairro obrigatório","Selecione o bairro de entrega.");return}y(!0);try{const t={...s,city:s.city||"Cidade",state:s.state||"UF",zip_code:s.zip_code||"00000-000",tenant_id:i,customer_id:k};let d;o?.id?(d=await f.put(`/customer/addresses/${o.id}`,t),v("Endereço atualizado!","Suas alterações foram salvas.")):(d=await f.post("/customer/addresses",t),v("Endereço adicionado!","Seu novo endereço foi salvo.")),C(d.data.address||d.data)}catch(t){j("Erro ao salvar",t.response?.data?.message||"Tente novamente.")}finally{y(!1)}};return e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white transition-colors",children:"Cadastrar Endereço"}),e.jsx("button",{type:"button",onClick:b,className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:"Cancelar"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx(h,{htmlFor:"neighborhood",value:"Bairro de Entrega"})}),e.jsx("div",{className:"relative",children:_?e.jsxs("div",{className:"w-full border-2 border-gray-100 dark:border-gray-800 rounded-xl p-3 flex items-center justify-center text-gray-400 gap-2",children:[e.jsx(S,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Buscando bairros..."})]}):u&&u.length>0?e.jsxs("select",{id:"neighborhood",value:s.neighborhood,onChange:L,className:R("w-full border-2 rounded-xl shadow-sm outline-none transition-all duration-300 p-3","focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent",A===!0?"border-green-500 bg-green-50/30 text-green-900 dark:bg-green-900/10 dark:text-green-400":"border-gray-200 dark:border-gray-700 dark:bg-gray-950 dark:text-gray-100 placeholder-gray-400"),required:!0,children:[e.jsx("option",{value:"",children:"Selecione o Bairro..."}),u.map(r=>e.jsxs("option",{value:r.neighborhood,children:[r.neighborhood," ",r.delivery_fee>0?`(+ R$ ${Number(r.delivery_fee).toFixed(2)})`:"(Entrega Grátis)"]},r.id||r.neighborhood))]}):e.jsxs("div",{className:"w-full border-2 border-amber-100 bg-amber-50 dark:bg-amber-900/10 dark:border-amber-900/30 rounded-xl p-3 text-amber-600 dark:text-amber-400 text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Nenhum bairro de entrega configurado pela loja."})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx(h,{htmlFor:"street",value:"Nome da Rua / Avenida"}),e.jsx(x,{id:"street",value:s.street,onChange:r=>m({...s,street:r.target.value}),className:"w-full",placeholder:"Ex: Rua das Flores",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(h,{htmlFor:"number",value:"Nº"}),e.jsx(x,{id:"number",value:s.number,onChange:r=>m({...s,number:r.target.value}),className:"w-full",placeholder:"123",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"complement",value:"Complemento (Opcional)"}),e.jsx(x,{id:"complement",value:s.complement,onChange:r=>m({...s,complement:r.target.value}),className:"w-full",placeholder:"Ex: Apt 42, Bloco B, Casa no fundo..."})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx(q,{type:"button",onClick:b,className:"flex-1 justify-center py-3",children:"Cancelar"}),e.jsx($,{type:"submit",disabled:p,className:"flex-1 justify-center bg-[#ff3d03] hover:bg-[#e63700] py-3 shadow-lg shadow-orange-500/20",children:p?e.jsx(S,{className:"w-5 h-5 animate-spin mx-auto text-white"}):"Confirmar Endereço"})]})]})}export{W as default};
