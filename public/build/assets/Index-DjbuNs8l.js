import{d as r,j as e,H as A,a6 as n,a7 as R,D as w,a8 as E,a9 as Q,aa as q,q as L,ab as P,t as p}from"./vendor-react-BRbeZxQj.js";import{A as W}from"./AuthenticatedLayout-DmT546vf.js";import"./vendor-others-CI9KCNiO.js";import"./vendor-utils-Dp_nMyUE.js";import"./Modal-j3wD4Y2Q.js";import"./app-w_IWnRYJ.js";import"./vendor-animation-BvO_7aKj.js";function G({instance:d,logs:m,currentConfig:u}){const[l,g]=r.useState(null),[c,o]=r.useState(!1),[t,N]=r.useState(d?.status||"disconnected"),[i,v]=r.useState(d?.instance_name||"odelivery_master"),[x,k]=r.useState(u.url),[h,C]=r.useState(u.apikey),[b,f]=r.useState(!1),S=()=>{o(!0),p.post(route("admin.whatsapp.connect"),{instance_name:i,evolution_url:x,evolution_apikey:h},{onFinish:()=>o(!1)})},y=()=>{confirm("Tem certeza? Isso irá desconectar o WhatsApp de todos os clientes do plano Basic/Pro.")&&p.post(route("admin.whatsapp.disconnect"))},j=async()=>{o(!0);try{const a=await fetch(route("admin.whatsapp.qrcode"));if(!a.ok){if(a.status===404){console.log("QR Code still not available, will retry...");return}const _=await a.json();console.error("Error fetching QR code:",_);return}const s=await a.json();s.qr_code&&g(s.qr_code)}catch(a){console.error("Failed to load QR code:",a)}finally{o(!1)}},I=async()=>{try{const s=await(await fetch(route("admin.whatsapp.status"))).json();N(s.status),s.status==="connected"&&(g(null),d?.status!=="connected"&&p.reload())}catch(a){console.error(a)}};return r.useEffect(()=>{let a,s;return(t==="connecting"||l)&&(a=setInterval(I,3e3)),t==="connecting"&&!l&&(f(!0),s=setInterval(async()=>{await j()},4e3)),()=>{clearInterval(a),clearInterval(s),t==="connecting"&&!l&&f(!1)}},[t,l]),e.jsxs(W,{children:[e.jsx(A,{title:"WhatsApp Master"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-[#ff3d03]/10 text-[#ff3d03] text-[10px] font-bold uppercase tracking-wider",children:"Infraestrutura"})}),e.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight",children:"WhatsApp Master"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Gerencie a conexão principal compartilhada (Planos Basic/Pro)."})]}),n().props.flash?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm font-medium",children:n().props.flash.error}),n().props.errors?.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm font-medium",children:n().props.errors.error}),n().props.flash?.success&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-xl text-sm font-medium",children:n().props.flash.success}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm p-8",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Status da Conexão"}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:`h-24 w-24 rounded-full flex items-center justify-center mb-4 ${t==="connected"?"bg-green-100 text-green-600 dark:bg-green-900/20":t==="connecting"?"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/20 animate-pulse":"bg-gray-100 text-gray-400 dark:bg-gray-800"}`,children:t==="connected"?e.jsx(R,{className:"h-10 w-10"}):t==="connecting"?e.jsx(w,{className:"h-10 w-10 animate-spin"}):e.jsx(E,{className:"h-10 w-10"})}),e.jsx("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1",children:t==="connected"?"Conectado":t==="connecting"?"Conectando...":"Desconectado"}),d?.phone_number&&e.jsx("p",{className:"text-sm text-gray-500",children:d.phone_number})]}),e.jsx("div",{className:"space-y-3",children:d?t!=="connected"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,disabled:c||b,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-600/30 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(q,{className:"h-4 w-4"}),"Ler QR Code"]}),b&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Preparando QR Code..."}),e.jsx("button",{onClick:y,className:"w-full py-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl font-bold hover:bg-gray-200 dark:hover:bg-gray-700 transition-all",children:"Resetar"})]}):e.jsxs("button",{onClick:y,className:"w-full py-3 bg-red-100 text-red-600 hover:bg-red-200 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Desconectar"]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Evolution API URL"}),e.jsx("input",{type:"url",value:x,onChange:a=>k(a.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"https://sua-evolution.com"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Global API Key"}),e.jsx("input",{type:"password",value:h,onChange:a=>C(a.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"Sua chave global da Evolution"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Nome da Instância"}),e.jsx("input",{type:"text",value:i,onChange:a=>v(a.target.value),className:"w-full px-4 py-2 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm font-medium focus:ring-[#ff3d03]/20 focus:border-[#ff3d03]/50",placeholder:"Ex: odelivery_master"})]}),e.jsxs("button",{onClick:S,disabled:c||!i||!x||!h,className:"w-full py-3 bg-[#ff3d03] hover:bg-[#e03603] text-white rounded-xl font-bold shadow-lg shadow-[#ff3d03]/30 transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[c?e.jsx(w,{className:"h-4 w-4 animate-spin"}):e.jsx(Q,{className:"h-4 w-4"}),"Salvar e Iniciar"]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm p-8 flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Escanear QR Code"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Abra o WhatsApp e escaneie para conectar."}),e.jsx("div",{className:"p-4 bg-white rounded-xl shadow-inner border border-gray-100",children:e.jsx("img",{src:l,alt:"QR Code",className:"w-64 h-64"})})]}):e.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-sm overflow-hidden min-h-[400px]",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 dark:border-white/5",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-gray-400"}),"Logs Recentes"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-white/5 text-gray-500 font-medium border-b border-gray-100 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Tenant"}),e.jsx("th",{className:"px-6 py-3",children:"Telefone"}),e.jsx("th",{className:"px-6 py-3",children:"Template"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-white/5",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:"Nenhum log registrado ainda."})}):m.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 dark:text-white",children:a.tenant?.name||"Sistema"}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:a.phone_number}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:a.template_key}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${a.status==="sent"?"bg-green-100 text-green-700":a.status==="failed"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:a.status==="sent"?"Enviado":"Falha"})}),e.jsx("td",{className:"px-6 py-4 text-gray-500 text-xs",children:new Date(a.created_at).toLocaleString()})]},a.id))})]})})]})})]})]})]})}export{G as default};
