import{r as d,j as t,X as R,d as g}from"./app-BlcCfZ8V.js";import{t as a}from"./index-EO0NhHQy.js";function F({isOpen:U,onClose:O,onLogin:h,slug:f}){const[s,i]=d.useState("phone"),[c,N]=d.useState(""),[C,D]=d.useState(""),[x,y]=d.useState(""),[v,E]=d.useState(""),[m,q]=d.useState(""),[n,o]=d.useState(!1),[w,k]=d.useState(""),[I,_]=d.useState(!0),[l,S]=d.useState(4);d.useEffect(()=>{if(!localStorage.getItem("device_fingerprint")){const r=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"device-"+Math.random().toString(36).substring(2)+Date.now().toString(36);localStorage.setItem("device_fingerprint",r)}},[]);const P=()=>{N(""),D(""),y(""),E(""),q(""),i("phone"),k(""),_(!0),S(4)},u=()=>{P(),O()},V=async r=>{r.preventDefault(),o(!0);try{const e=await g.post("/customer/check-phone",{phone:c,tenant_slug:f,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});if(e.data.exists)if(e.data.trusted_device)h(e.data.customer),u(),a.success(`Bem-vindo de volta, ${e.data.customer.name}!`);else if(e.data.requires_password)i("password"),a.info(e.data.message||"Digite sua senha.");else if(e.data.requires_setup){const p=e.data.otp_enabled!==!1,b=e.data.phone_digits_required??4;_(p),S(b),k(e.data.message||""),p?(i("setup_otp"),await j()):(i("phone_digits"),a.info(e.data.message||`Confirme os últimos ${b} dígitos do seu telefone.`))}else e.data.requires_otp&&(i("login_otp"),a.info("Código enviado para seu WhatsApp."));else i("name")}catch(e){console.error("Error checking phone:",e),a.error("Erro ao verificar telefone. Tente novamente.")}finally{o(!1)}},j=async()=>{try{await g.post("/customer/send-setup-otp",{phone:c,tenant_slug:f}),a.success("Código de verificação enviado!")}catch(r){console.error("Error sending setup OTP:",r),a.error("Erro ao enviar código.")}},z=async r=>{r.preventDefault(),o(!0);try{const e=await g.post("/customer/login-password",{phone:c,password:x,tenant_slug:f,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(h(e.data.customer),u(),a.success("Login realizado com sucesso!"))}catch(e){console.error("Error logging in with password:",e),a.error(e.response?.data?.message||"Senha incorreta.")}finally{o(!1)}},$=async r=>{r.preventDefault(),i("setup_password")},M=async r=>{if(r.preventDefault(),m.length!==l){a.error(`Digite os ${l} últimos dígitos do seu telefone.`);return}o(!0);try{const e=await g.post("/customer/quick-login",{phone:c,tenant_slug:f,phone_last_digits:m,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(h(e.data.customer),u(),a.success(`Bem-vindo, ${e.data.customer.name}!`))}catch(e){a.error(e.response?.data?.message||"Dígitos incorretos. Tente novamente.")}finally{o(!1)}},T=async r=>{r.preventDefault(),o(!0);try{if(!I){if(m.length!==l){a.error(`Digite os ${l} últimos dígitos do seu telefone.`),o(!1);return}const p=await g.post("/customer/quick-login",{phone_last_digits:m,customer_id:"",device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"})}const e=await g.post("/customer/setup-password",{phone:c,code:v,password:x,tenant_slug:f,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device",phone_last_digits:I?void 0:m});e.data.success&&(h(e.data.customer),u(),a.success("Senha definida e Login realizado!"))}catch(e){console.error("Error setting password:",e),a.error(e.response?.data?.message||"Erro ao definir senha."),e.response?.status===422&&i("setup_otp")}finally{o(!1)}},A=async r=>{r.preventDefault(),o(!0);try{const e=await g.post("/customer/verify-otp",{phone:c,code:v,tenant_slug:f,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.valid&&(h(e.data.customer),u(),a.success("Verificação concluída!"))}catch(e){console.error("Error verifying OTP:",e),a.error(e.response?.data?.message||"Código inválido.")}finally{o(!1)}},L=async r=>{r.preventDefault(),o(!0);try{const e=await g.post("/customer/complete-registration",{phone:c,name:C,tenant_slug:f,referral_code:localStorage.getItem("referral_code"),device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});if(e.data.requires_setup){const p=e.data.otp_enabled!==!1,b=e.data.phone_digits_required??4;_(p),S(b),k("Cadastro realizado!"),p?(i("setup_otp"),await j()):(i("phone_digits"),a.info(`Confirme os últimos ${b} dígitos do seu telefone para entrar.`))}else h(e.data.customer),u(),a.success("Cadastro realizado com sucesso!")}catch(e){console.error("Error completing registration:",e);const p=e.response?.data?.message||"Erro ao completar cadastro.";a.error(p)}finally{o(!1)}};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:u}),t.jsxs("div",{className:"bg-white dark:bg-premium-dark rounded-2xl p-6 max-w-md w-full relative z-10 shadow-xl animate-in fade-in zoom-in duration-300 transition-colors duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:s==="phone"?"Entrar ou Cadastrar":s==="name"?"Seus Dados":s==="password"?"Digite sua Senha":s==="phone_digits"?"Verificação de Identidade":s==="setup_otp"||s==="login_otp"?"Verificação de Segurança":"Criar Senha"}),t.jsx("button",{onClick:u,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors",children:t.jsx(R,{className:"h-6 w-6"})})]}),s==="phone"&&t.jsxs("form",{onSubmit:V,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Número de Telefone"}),t.jsx("input",{type:"tel",value:c,onChange:r=>N(r.target.value),placeholder:"(00) 00000-0000",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Verificando...":"Continuar"})]}),s==="password"&&t.jsxs("form",{onSubmit:z,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Senha"}),t.jsx("input",{type:"password",value:x,onChange:r=>y(r.target.value),placeholder:"******",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Entrar...":"Entrar"}),t.jsx("button",{type:"button",onClick:()=>{i("setup_otp"),j()},className:"w-full text-sm text-gray-500 hover:text-[#ff3d03] transition-colors",children:"Esqueci minha senha (Criar nova)"})]}),(s==="setup_otp"||s==="login_otp")&&t.jsxs("form",{onSubmit:s==="setup_otp"?$:A,className:"space-y-4",children:[w&&t.jsx("div",{className:"p-3 bg-blue-50 text-blue-700 text-sm rounded-lg mb-4",children:w}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código enviado via WhatsApp do CartZapp"}),t.jsx("input",{type:"text",value:v,onChange:r=>E(r.target.value),placeholder:"000000",maxLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none text-center tracking-widest text-lg bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Verificando...":s==="setup_otp"?"Validar e Criar Senha":"Entrar"})]}),s==="setup_password"&&t.jsxs("form",{onSubmit:T,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"p-3 bg-green-50 text-green-700 text-sm rounded-lg mb-4",children:"Número verificado! Crie sua senha de acesso."}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Nova Senha"}),t.jsx("input",{type:"password",value:x,onChange:r=>y(r.target.value),placeholder:"Mínimo 6 caracteres",minLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Salvando...":"Definir Senha e Entrar"})]}),s==="phone_digits"&&t.jsxs("form",{onSubmit:M,className:"space-y-4",children:[t.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 text-sm rounded-lg",children:w||`Confirme os últimos ${l} dígitos do seu telefone para entrar.`}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Últimos ",l," dígitos do telefone"]}),t.jsx("input",{type:"tel",value:m,onChange:r=>q(r.target.value.replace(/\D/g,"").slice(0,l)),placeholder:"0".repeat(l),maxLength:l,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none text-center tracking-widest text-2xl font-bold bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n||m.length!==l,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Verificando...":"Entrar"})]}),s==="name"&&t.jsxs("form",{onSubmit:L,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Seu Nome"}),t.jsx("input",{placeholder:"Digite seu nome",value:C,onChange:r=>D(r.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:n?"Cadastrando...":"Continuar"})]})]})]})}export{F as default};
