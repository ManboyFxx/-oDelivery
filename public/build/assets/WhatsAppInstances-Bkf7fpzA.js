import{r,j as e,a as u,X as _}from"./app-D2VljvTw.js";import{A as E}from"./AuthenticatedLayout-Cx4f4-fS.js";import{S as y}from"./smartphone-D0jiere8.js";import{Q as A}from"./qr-code-Y2NLAUwa.js";import{T as Q}from"./trash-2-D5qGatoK.js";import{a as R,W}from"./wifi-B1Ug7Sdp.js";import{R as D}from"./refresh-cw-BF6ZDTX2.js";import"./shopping-bag-DeV0Q4uc.js";import"./package-DITWTL1u.js";import"./menu-D_M5zKdZ.js";import"./use-resolve-button-type-hvyh8Ega.js";import"./keyboard-D3GHKAuh.js";import"./use-sync-refs-DLhS85IC.js";import"./portal-KUhlGsT1.js";import"./with-selector-D8O5el8K.js";import"./transition-D2MB-Bkq.js";import"./credit-card-CJ_Fv3xf.js";import"./trophy-CGi22m5G.js";import"./chart-column-BI1AR2fd.js";import"./ticket-Btog9CtY.js";import"./store-DuxhVZGb.js";import"./dollar-sign-u-pr0hpI.js";import"./shield-check-BwRQitPR.js";import"./log-out-BGloaton.js";import"./Modal-CPkuO39I.js";import"./hidden-DG7gvhwG.js";import"./truck-2VxR7Zq1.js";import"./switch-DTazzpId.js";import"./chevron-down-DopCl3ie.js";import"./clock-DhsNYQvR.js";import"./search-DgyBcvPy.js";import"./bell-CJEF_sGF.js";import"./sparkles-CJH1Xak9.js";import"./arrow-right-D3E33b_Z.js";import"./eye-Lo_UvX06.js";import"./arrow-left-BOEQvvf9.js";function be({instances:w}){const[s,m]=r.useState(w),[c,p]=r.useState(""),[g,j]=r.useState(null),[h,i]=r.useState(null),[l,d]=r.useState(!1),[b,n]=r.useState(null),f=async()=>{if(c.trim()){d(!0),n(null);try{u.post(route("whatsapp.instances.store"),{instance_name:c},{onSuccess:()=>{p(""),setTimeout(()=>window.location.reload(),500)},onError:t=>{n(t.error||"Erro ao criar instância")}})}finally{d(!1)}}},N=async t=>{d(!0),n(null);try{const a=await fetch(route("whatsapp.instances.qrcode",t.id)),o=await a.json();a.ok?(i(o.qr_code),j(t)):n(o.error||"QR Code não disponível")}catch(a){n("Erro ao carregar QR Code"),console.error("Erro:",a)}finally{d(!1)}},k=async t=>{try{const a=await fetch(route("whatsapp.instances.status",t.id)),o=await a.json();a.ok&&m(s.map(x=>x.id===t.id?{...x,status:o.status,phone_number:o.phone_number}:x))}catch(a){console.error("Erro ao verificar status:",a)}},v=t=>{confirm(`Deseja realmente remover a instância "${t.instance_name}"?`)&&u.delete(route("whatsapp.instances.destroy",t.id),{onSuccess:()=>{m(s.filter(a=>a.id!==t.id))}})};r.useEffect(()=>{const t=setInterval(()=>{s.filter(a=>a.status==="connecting").forEach(k)},5e3);return()=>clearInterval(t)},[s]);const C=t=>{switch(t){case"connected":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";case"connecting":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400";default:return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400"}},I=t=>{switch(t){case"connected":return e.jsx(W,{className:"h-4 w-4"});case"connecting":return e.jsx(D,{className:"h-4 w-4 animate-spin"});default:return e.jsx(R,{className:"h-4 w-4"})}},S=t=>{switch(t){case"connected":return"Conectado";case"connecting":return"Conectando";default:return"Desconectado"}};return e.jsx(E,{children:e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Gerenciar Instâncias WhatsApp"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Configure e gerencie suas conexões WhatsApp Business via Evolution API"})]}),b&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 rounded-lg",children:b}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Nova Instância"}),e.jsxs("div",{className:"flex gap-4 flex-col sm:flex-row",children:[e.jsx("input",{type:"text",value:c,onChange:t=>p(t.target.value),placeholder:"Nome da instância (ex: loja-centro)",className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500",onKeyPress:t=>t.key==="Enter"&&f(),disabled:l}),e.jsx("button",{onClick:f,disabled:!c.trim()||l,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"Criando...":"Criar Instância"})]})]}),s.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(y,{className:"h-16 w-16 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhuma instância criada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Crie sua primeira instância WhatsApp para começar a enviar mensagens"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(y,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white truncate",children:t.instance_name}),t.phone_number&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.phone_number})]})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold whitespace-nowrap ${C(t.status)}`,children:[I(t.status),S(t.status)]})]}),t.last_connected_at&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mb-4",children:["Última conexão: ",new Date(t.last_connected_at).toLocaleDateString("pt-BR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex gap-2",children:[t.status!=="connected"&&e.jsxs("button",{onClick:()=>N(t),disabled:l,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(A,{className:"h-4 w-4"}),"Ver QR Code"]}),t.status==="connected"&&e.jsx("button",{onClick:()=>{confirm("Desconectar esta instância?")&&u.post(route("whatsapp.instances.disconnect",t.id),{},{onSuccess:()=>{m(s.map(a=>a.id===t.id?{...a,status:"disconnected",qr_code:null}:a))}})},className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"Desconectar"}),e.jsx("button",{onClick:()=>v(t),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})})]})]},t.id))}),g&&h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>i(null),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Conectar via QR Code"}),e.jsx("button",{onClick:()=>i(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(_,{className:"h-6 w-6"})})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Instância: ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:g.instance_name})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:"Abra o WhatsApp no seu celular e escaneie este código para conectar a instância."}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4 flex items-center justify-center",children:e.jsx("img",{src:h,alt:"QR Code",className:"w-full h-auto"})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"ℹ️ O status será atualizado automaticamente assim que você escanear o código. Isso pode levar alguns segundos."})}),e.jsx("button",{onClick:()=>i(null),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Fechar"})]})})]})})}export{be as default};
