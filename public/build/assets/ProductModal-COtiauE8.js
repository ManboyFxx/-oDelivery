import{r as h,j as e,X as I,e as C}from"./app-CCgVoYEQ.js";import{t as k}from"./index-CEu0ySQD.js";import{S as Q}from"./shopping-bag-BXjODdx7.js";import{M}from"./minus-BGXpFceM.js";import{P as w}from"./plus-BdAvLtDu.js";function G({product:r,isOpen:b,onClose:f,onAddToCart:$,initialValues:d}){const[c,m]=h.useState(1),[N,u]=h.useState(""),[x,g]=h.useState({});if(h.useEffect(()=>{if(!(!r||!b))if(d){m(d.quantity),u(d.notes);const t={};d.selectedComplements.forEach(s=>{t[s.groupId]||(t[s.groupId]={}),t[s.groupId][s.optionId]=s.quantity||1}),g(t)}else m(1),u(""),g({})},[r,d,b]),!r||!b)return null;const p=(t,s,l,a,n)=>{g(i=>{const o=i[t]||{},S=o[s]||0,j=Math.max(0,Math.min(S+l,a));if(Object.values(o).reduce((q,z)=>q+z,0)-S+j>n)return k.error(`Máximo de ${n} opções permitidas.`),i;const y={...o};return j===0?delete y[s]:y[s]=j,{...i,[t]:y}})},v=t=>{const s=x[t]||{};return Object.values(s).reduce((l,a)=>l+a,0)},_=()=>{let t=Number(r.promotional_price&&Number(r.promotional_price)>0?r.promotional_price:r.price);return r.complement_groups?.forEach(s=>{const l=x[s.id]||{};Object.entries(l).forEach(([a,n])=>{const i=s.options.find(o=>o.id===a);i&&(t+=i.price*n)})}),t*c},E=()=>{if(r.complement_groups)for(const s of r.complement_groups){const l=v(s.id);if(s.is_required&&l===0){k.error(`"${s.name}" é obrigatório.`);return}if(l>0&&l<s.min_selections){k.error(`Selecione pelo menos ${s.min_selections} em "${s.name}".`);return}}const t=[];r.complement_groups?.forEach(s=>{const l=x[s.id]||{};Object.entries(l).forEach(([a,n])=>{const i=s.options.find(o=>o.id===a);if(i&&n>0)for(let o=0;o<n;o++)t.push({groupId:s.id,optionId:i.id,name:i.name,price:i.price,quantity:1})})}),$({product:r,quantity:c,notes:N,selectedComplements:t,subtotal:_()}),f()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:f}),e.jsxs("div",{className:"bg-white dark:bg-premium-dark w-full md:max-w-2xl max-h-[90vh] md:rounded-3xl rounded-t-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto animate-in slide-in-from-bottom md:slide-in-from-bottom-10 duration-300 transition-colors duration-300",children:[e.jsxs("div",{className:"h-48 md:h-64 relative shrink-0",children:[r.image_url?e.jsx("img",{src:r.image_url,className:"w-full h-full object-cover",alt:r.name}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-300",children:e.jsx(Q,{className:"h-16 w-16"})}),e.jsx("button",{onClick:f,className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 p-2 rounded-full backdrop-blur-md transition-all group",children:e.jsx(I,{className:"h-5 w-5 text-white group-hover:scale-110 transition-transform"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/10 to-transparent"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 relative bg-white dark:bg-premium-dark transition-colors duration-300",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-black text-gray-900 dark:text-white leading-tight mb-2 transition-colors duration-300",children:r.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 leading-relaxed transition-colors duration-300",children:r.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-2xl font-black text-[#ff3d03]",children:["R$ ",Number(r.promotional_price||r.price).toFixed(2).replace(".",",")]}),r.promotional_price&&e.jsxs("span",{className:"ml-3 text-sm text-gray-400 line-through",children:["R$ ",Number(r.price).toFixed(2).replace(".",",")]})]})]}),r.complement_groups?.map(t=>{const s=v(t.id),l=(!t.is_required||s>=t.min_selections)&&s<=t.max_selections;return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-white dark:bg-premium-dark py-2 z-10 border-b border-gray-100 dark:border-white/5 transition-colors duration-300",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white text-lg flex items-center gap-2 transition-colors duration-300",children:[t.name,t.is_required&&e.jsx("span",{className:"text-[#ff3d03] text-xs font-black uppercase bg-[#ff3d03]/10 px-2 py-0.5 rounded-full",children:"Obrigatório"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 transition-colors duration-300",children:[t.min_selections>0?`Mín: ${t.min_selections}`:"",t.max_selections<100?` • Máx: ${t.max_selections}`:""]})]}),e.jsxs("div",{className:C("text-xs font-bold px-2 py-1 rounded-full transition-colors duration-300",l?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-gray-100 dark:bg-white/5 text-gray-500 dark:text-gray-400"),children:[s,"/",t.max_selections]})]}),e.jsx("div",{className:"space-y-3",children:t.options.map(a=>{const n=x[t.id]?.[a.id]||0,i=a.max_quantity||1,o=n<i&&s<t.max_selections;return e.jsxs("div",{className:C("flex items-center justify-between p-3 rounded-xl border transition-all cursor-pointer duration-300",n>0?"border-[#ff3d03] bg-[#ff3d03]/5":"border-gray-100 dark:border-white/5 hover:border-gray-200 dark:hover:border-white/10"),children:[e.jsxs("div",{className:"flex-1",onClick:()=>o&&p(t.id,a.id,1,i,t.max_selections),children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white transition-colors duration-300",children:a.name}),a.price>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300",children:["+ R$ ",a.price.toFixed(2).replace(".",",")]})]}),n>0||o?e.jsxs("div",{className:"flex items-center gap-3 bg-white dark:bg-premium-card rounded-lg p-1 shadow-sm border border-gray-100 dark:border-white/5 transition-colors duration-300",children:[n>0&&e.jsx("button",{onClick:()=>p(t.id,a.id,-1,i,t.max_selections),className:"p-1 hover:bg-gray-100 dark:hover:bg-white/10 rounded text-gray-600 dark:text-gray-400 transition-colors",children:e.jsx(M,{className:"h-4 w-4"})}),n>0&&e.jsx("span",{className:"font-bold text-sm min-w-[1rem] text-center text-gray-900 dark:text-white transition-colors duration-300",children:n}),e.jsx("button",{onClick:()=>p(t.id,a.id,1,i,t.max_selections),disabled:!o,className:"p-1 hover:bg-gray-100 dark:hover:bg-white/10 rounded text-[#ff3d03] disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(w,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"h-8 w-8 rounded-full border border-gray-200 dark:border-white/10 flex items-center justify-center text-gray-400 dark:text-gray-500 transition-colors duration-300",children:e.jsx(w,{className:"h-4 w-4"})})]},a.id)})})]},t.id)}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-bold text-gray-900 dark:text-white mb-2 transition-colors duration-300",children:"Observações"}),e.jsx("textarea",{value:N,onChange:t=>u(t.target.value),placeholder:"Ex: Sem cebola, capricha no molho...",className:"w-full p-4 bg-gray-50 dark:bg-white/5 border-none rounded-xl focus:ring-2 focus:ring-[#ff3d03] resize-none text-sm text-gray-900 dark:text-white placeholder:text-gray-400 transition-colors duration-300",rows:3})]})]}),e.jsx("div",{className:"p-4 md:p-6 border-t border-gray-100 dark:border-white/5 bg-white dark:bg-premium-dark md:rounded-b-3xl shrink-0 relative z-20 pb-safe transition-colors duration-300",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-100 dark:bg-white/5 rounded-xl px-2 transition-colors duration-300",children:[e.jsx("button",{onClick:()=>m(Math.max(1,c-1)),className:"h-10 w-10 flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-black text-xl w-8 text-center text-gray-900 dark:text-white transition-colors duration-300",children:c}),e.jsx("button",{onClick:()=>m(c+1),className:"h-10 w-10 flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors",children:e.jsx(w,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:E,className:"flex-1 bg-[#ff3d03] text-white font-bold py-4 rounded-xl shadow-lg shadow-[#ff3d03]/30 hover:bg-[#e63700] hover:shadow-[#ff3d03]/50 transition-all active:scale-[0.98] flex items-center justify-between px-6",children:[e.jsx("span",{children:d?"Atualizar Pedido":"Adicionar"}),e.jsxs("span",{children:["R$ ",_().toFixed(2).replace(".",",")]})]})]})})]})]})}export{G as default};
