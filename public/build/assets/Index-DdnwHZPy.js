import{d as x,j as e,a1 as R,t as T,bD as G,T as H,u as z,H as V,_ as W,V as X,bE as Y,bi as J,bg as K,m as Q}from"./vendor-react-BYm2vN5O.js";import{A as U}from"./AuthenticatedLayout-CC45zQvs.js";import{M as C}from"./Modal-BU8I6Kmo.js";import{I as D}from"./InputLabel-BmqANJC9.js";import{T as E}from"./TextInput-D00-Dvyn.js";import{P as y}from"./PrimaryButton-C8-r8q-u.js";import{S as M}from"./SecondaryButton-CCdDDmH-.js";import{b$ as Z,c0 as ee,b0 as S,c1 as se,ce as re,c4 as te,cf as ae}from"./vendor-others-BqROYnIz.js";import{D as ie}from"./DangerButton--kXdy33f.js";import"./vendor-utils-DuuP9eDp.js";import"./app-Dqn1zKfB.js";import"./vendor-animation-DqfYcVFE.js";function ne({table:r,isSelected:o}){const{attributes:a,listeners:d,setNodeRef:l,transform:c,isDragging:u}=ae({id:r.id,data:{table:r}}),m=()=>o?"ring-2 ring-blue-500 border-blue-500":r.status==="occupied"?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":r.status==="reserved"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",h={left:`${r.position_x}px`,top:`${r.position_y}px`,width:`${r.width}px`,height:`${r.height}px`,position:"absolute",transform:c?`translate3d(${c.x}px, ${c.y}px, 0)`:void 0,zIndex:u?100:1};return e.jsxs("div",{ref:l,style:h,...d,...a,className:S("border-2 shadow-sm flex flex-col items-center justify-center cursor-move transition-colors select-none",m(),u&&"shadow-xl opacity-80 z-50",r.shape==="round"?"rounded-full":"rounded-lg"),children:[e.jsx(G,{className:"w-4 h-4 text-gray-300 absolute top-2 opacity-0 hover:opacity-100 transition-opacity"}),e.jsx("span",{className:S("font-bold dark:text-white",r.width<60?"text-sm":"text-xl"),children:r.number}),r.width>=60&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:[r.capacity,"L"]}),r.status==="occupied"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white dark:border-gray-900"})]})}function oe({tables:r}){const[o,a]=x.useState(r),[d,l]=x.useState(!1);x.useEffect(()=>{a(r)},[r]);const c=Z(ee(te,{activationConstraint:{distance:5}})),u=t=>{const{active:n,delta:f}=t,i=n.id;a(g=>g.map(p=>{if(p.id===i){const v=Math.max(0,p.position_x+f.x),w=Math.max(0,p.position_y+f.y),j=N=>Math.round(N/20)*20;return{...p,position_x:j(v),position_y:j(w)}}return p})),l(!0)},m=()=>{const t=o.map(n=>({id:n.id,x:n.position_x,y:n.position_y,width:n.width,height:n.height,shape:n.shape,rotation:n.rotation}));T.post(route("tables.update-positions"),{positions:t},{preserveScroll:!0,onSuccess:()=>l(!1)})},h=(t,n,f)=>{a(i=>i.map(g=>g.id===t?{...g,[n]:f}:g)),l(!0)};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:e.jsx("p",{children:"Arraste as mesas para posicionÃ¡-las. Clique em uma mesa para editar formato."})}),e.jsxs("div",{className:"flex gap-2",children:[d&&e.jsx("span",{className:"text-amber-500 text-sm flex items-center px-2",children:"AlteraÃ§Ãµes nÃ£o salvas"}),e.jsxs(y,{onClick:m,disabled:!d,className:S("gap-2",!d&&"opacity-50 cursor-not-allowed"),children:[e.jsx(R,{className:"w-4 h-4"}),"Salvar Layout"]})]})]}),e.jsxs("div",{className:"relative w-full h-[600px] bg-gray-100 dark:bg-gray-900 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 overflow-hidden shadow-inner font-sans",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.1] pointer-events-none",style:{backgroundImage:"linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsx(se,{sensors:c,modifiers:[re],onDragEnd:u,children:o.map(t=>e.jsxs("div",{children:[e.jsx(ne,{table:t,isSelected:!1}),e.jsxs("div",{style:{left:t.position_x,top:t.position_y-25,position:"absolute",zIndex:50},className:"flex gap-1 opacity-0 hover:opacity-100 transition-opacity bg-white/80 rounded p-1 shadow-sm",children:[e.jsx("button",{onClick:()=>h(t.id,"shape",t.shape==="round"?"square":"round"),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:t.shape==="round"?"â¬›":"ðŸ”µ"}),e.jsx("button",{onClick:()=>h(t.id,"width",t.width+10),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"+"}),e.jsx("button",{onClick:()=>h(t.id,"width",Math.max(40,t.width-10)),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"-"})]})]},t.id))})]})]})}function de({show:r,onClose:o,onConfirm:a,title:d,message:l,confirmLabel:c="Confirmar",cancelLabel:u="Cancelar",processing:m=!1}){return e.jsx(C,{show:r,onClose:o,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full dark:bg-red-900/20 mb-4",children:e.jsx(H,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-lg font-medium text-center text-gray-900 dark:text-gray-100 mb-2",children:d}),e.jsx("p",{className:"text-sm text-center text-gray-500 dark:text-gray-400 mb-6",children:l}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(M,{onClick:o,disabled:m,children:u}),e.jsx(ie,{onClick:a,disabled:m,children:c})]})]})})}function le({show:r,onClose:o,sourceTable:a,tables:d}){const{data:l,setData:c,post:u,processing:m,reset:h,errors:t}=z({target_table_id:""});x.useEffect(()=>{r||h()},[r]);const n=i=>{i.preventDefault(),a&&u(route("tables.transfer",a.id),{onSuccess:()=>o()})},f=d.filter(i=>i.status==="free"&&i.id!==a?.id).sort((i,g)=>i.number-g.number);return e.jsx(C,{show:r,onClose:o,maxWidth:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["Transferir Mesa ",a?.number]}),e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Para Mesa:"}),e.jsxs("select",{value:l.target_table_id,onChange:i=>c("target_table_id",i.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma mesa livre..."}),f.map(i=>e.jsxs("option",{value:i.id,children:["Mesa ",i.number]},i.id))]}),t.target_table_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.target_table_id})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(M,{onClick:o,children:"Cancelar"}),e.jsx(y,{disabled:m||!l.target_table_id,children:"Transferir"})]})]})]})})}function Ne({tables:r}){const[o,a]=x.useState(!1),[d,l]=x.useState(null),[c,u]=x.useState({show:!1,id:null}),[m,h]=x.useState({show:!1,table:null}),[t,n]=x.useState("grid"),[f,i]=x.useState(new Date);x.useEffect(()=>{const s=setInterval(()=>i(new Date),6e4);return()=>clearInterval(s)},[]),x.useEffect(()=>{const s=setInterval(()=>{t==="grid"&&T.visit(window.location.pathname,{only:["tables"],preserveScroll:!0,preserveState:!0,replace:!0})},3e4);return()=>clearInterval(s)},[t]);const{data:g,setData:p,post:v,put:w,delete:j,processing:N,reset:I,errors:ce,clearErrors:$}=z({number:"",capacity:"4"});x.useEffect(()=>{o||(I(),$(),l(null))},[o]);const L=s=>{s.preventDefault(),d?w(route("tables.update",d.id),{onSuccess:()=>a(!1)}):v(route("tables.store"),{onSuccess:()=>a(!1)})},P=s=>{l(s),p({number:s.number.toString(),capacity:s.capacity.toString()}),a(!0)},q=s=>{u({show:!0,id:s.id})},A=()=>{c.id&&j(route("tables.destroy",c.id),{onFinish:()=>u({show:!1,id:null})})},B=s=>{s.status==="occupied"&&h({show:!0,table:{id:s.id,number:s.number}})},_=s=>{if(!s)return 0;const b=new Date(s).getTime(),k=f.getTime();return Math.floor((k-b)/(1e3*60))},F=s=>{if(s.status==="free")return"bg-green-100 text-green-800 border-green-200";if(s.status==="reserved")return"bg-blue-100 text-blue-800 border-blue-200";const b=_(s.occupied_since||s.occupied_at);return b>120?"bg-red-100 text-red-800 border-red-200 animate-pulse-slow":b>60?"bg-orange-100 text-orange-800 border-orange-200":"bg-yellow-100 text-yellow-800 border-yellow-200"},O=s=>{const b=Math.floor(s/60),k=s%60;return`${b}h ${k}m`};return e.jsxs(U,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"GestÃ£o de Mesas"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-1 flex border border-gray-200 dark:border-gray-700 mr-2",children:[e.jsx("button",{onClick:()=>n("grid"),className:`p-2 rounded-md transition-colors ${t==="grid"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o em Grid",children:e.jsx(J,{size:20})}),e.jsx("button",{onClick:()=>n("map"),className:`p-2 rounded-md transition-colors ${t==="map"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o de Mapa",children:e.jsx(K,{size:20})})]}),e.jsxs(y,{onClick:()=>a(!0),className:"flex items-center gap-2",children:[e.jsx(Q,{size:16})," Nova Mesa"]})]})]}),children:[e.jsx(V,{title:"Mesas"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})," Livre"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"})," Ocupada"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})," ",">"," 1h"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})," ",">"," 2h"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:t==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:r.map(s=>{const b=_(s.occupied_since||s.occupied_at);return e.jsxs("div",{className:`relative rounded-xl border-2 p-4 transition-all hover:shadow-md ${F(s)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Mesa ",s.number]}),e.jsx("button",{onClick:()=>P(s),className:"text-xs opacity-50 hover:opacity-100",children:"Editar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("span",{children:[s.capacity," Lugares"]})}),s.status==="occupied"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono mb-1",children:[e.jsx(W,{size:12}),O(b)]}),e.jsxs("div",{className:"flex items-center gap-1 font-bold text-lg",children:[e.jsx(X,{size:16}),new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.current_order?.total||0)]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsxs("button",{onClick:()=>B(s),className:"flex-1 bg-white/50 hover:bg-white/80 py-1 rounded text-xs font-semibold transition-colors flex items-center justify-center gap-1",children:[e.jsx(Y,{size:12})," Transferir"]})})]}),s.status==="free"&&e.jsx("div",{className:"mt-8 text-center opacity-50 text-xs",children:"DisponÃ­vel"})]})]},s.id)})}):e.jsx(oe,{tables:r,onSave:()=>{},readOnly:!1})})]})}),e.jsx(C,{show:o,onClose:()=>a(!1),children:e.jsxs("form",{onSubmit:L,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:d?"Editar Mesa":"Nova Mesa"}),e.jsxs("div",{className:"mt-6",children:[e.jsx(D,{htmlFor:"number",value:"NÃºmero da Mesa"}),e.jsx(E,{id:"number",type:"number",className:"mt-1 block w-full",value:g.number,onChange:s=>p("number",s.target.value),required:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(D,{htmlFor:"capacity",value:"Capacidade"}),e.jsx(E,{id:"capacity",type:"number",className:"mt-1 block w-full",value:g.capacity,onChange:s=>p("capacity",s.target.value),required:!0})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[d&&e.jsx("button",{type:"button",onClick:()=>q(d),className:"text-red-600 hover:text-red-800",children:"Excluir"}),e.jsx(M,{onClick:()=>a(!1),children:"Cancelar"}),e.jsx(y,{disabled:N,children:"Salvar"})]})]})}),e.jsx(de,{show:c.show,onClose:()=>u({show:!1,id:null}),onConfirm:A,title:"Excluir Mesa",content:"Tem certeza que deseja excluir esta mesa? Esta aÃ§Ã£o nÃ£o pode ser desfeita."}),e.jsx(le,{show:m.show,onClose:()=>h({show:!1,table:null}),sourceTable:m.table,tables:r})]})}export{Ne as default};
