import{r as a,j as e,h as K,X as B,d as p,b as V}from"./app-Y5Ta3CeG.js";import{M as Q}from"./Modal-K9vPyGuv.js";import{S as U}from"./sparkles-M__sCfOv.js";import{G as I}from"./gift-BGpvoDSI.js";import{M as Z}from"./map-pin-CuSUxZDA.js";import{C as ee}from"./circle-check-big-BskQE719.js";import{T as te}from"./ticket-78J4UJd6.js";import{D as ae}from"./dollar-sign-Zg9Q7Wen.js";import{C as Y}from"./credit-card-NqdS9wLC.js";import{B as se}from"./banknote-BELYDqyc.js";import{W as re}from"./wallet-ZWRYG9VC.js";import{L as oe}from"./loader-circle-BxWkxV_j.js";import"./transition-DsDBJgYc.js";function ne({points:m,show:o,onComplete:f}){return a.useEffect(()=>{if(o){const s=setTimeout(f,3500);return()=>clearTimeout(s)}},[o,f]),o?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 animate-fade-in pointer-events-auto"}),e.jsx("style",{children:`
                @keyframes celebrationBounce {
                    0% {
                        transform: scale(0.5) translateY(20px);
                        opacity: 0;
                    }
                    50% {
                        transform: scale(1.05) rotate(5deg);
                    }
                    100% {
                        transform: scale(1) translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes spin-slowly {
                    0%, 100% { transform: rotate(0deg); }
                    50% { transform: rotate(10deg) scaleY(1.1); }
                }

                @keyframes pulse-glow {
                    0%, 100% { box-shadow: 0 0 20px rgba(255, 61, 3, 0.5); }
                    50% { box-shadow: 0 0 40px rgba(255, 61, 3, 0.8); }
                }

                @keyframes float-up {
                    0% {
                        opacity: 1;
                        transform: translateY(0);
                    }
                    100% {
                        opacity: 0;
                        transform: translateY(-100px);
                    }
                }

                .celebration-card {
                    animation: celebrationBounce 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
                }

                .celebration-icon {
                    animation: spin-slowly 2s ease-in-out infinite;
                }

                .celebration-glow {
                    animation: pulse-glow 1.5s ease-in-out infinite;
                }

                .floating-points {
                    animation: float-up 2s ease-out forwards;
                }
            `}),e.jsx("div",{className:"celebration-card relative z-10",children:e.jsxs("div",{className:"bg-gradient-to-br from-orange-400 via-orange-500 to-pink-500 rounded-3xl p-8 shadow-2xl celebration-glow text-center max-w-sm w-full",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[...Array(6)].map((s,n)=>e.jsx(U,{className:"absolute h-6 w-6 text-white/40",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float-up ${2+Math.random()*1}s ease-out forwards`,animationDelay:`${n*.2}s`}},n))}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"celebration-icon mb-4",children:e.jsx(I,{className:"h-16 w-16 mx-auto text-white drop-shadow-lg"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-black text-white mb-2 drop-shadow-lg",children:"Parab√©ns!"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("p",{className:"text-5xl font-black mb-2 drop-shadow-lg",children:["+",m]}),e.jsx("p",{className:"text-lg font-bold drop-shadow-lg",children:"pontos!"})]}),e.jsx("p",{className:"text-white/90 text-sm mt-3 drop-shadow-lg",children:"Voc√™ est√° acumulando pr√™mios üéâ"})]})]})}),[...Array(8)].map((s,n)=>e.jsx("div",{className:"absolute floating-points pointer-events-none",style:{left:`calc(50% + ${(n-4)*30}px)`,top:"50%",animationDelay:`${n*.1}s`},children:e.jsxs("span",{className:"text-2xl font-black text-orange-500",children:["+",Math.floor(m/4)]})},n))]}):null}function we({show:m,onClose:o,cart:f,store:s,customer:n,total:d,addresses:x,onSuccess:C}){const[ie,le]=a.useState("delivery"),[i,k]=a.useState("delivery"),[h,N]=a.useState(""),[c,W]=a.useState("credit_card"),[g,L]=a.useState(""),[S,P]=a.useState(!1),[A,b]=a.useState(""),[G,E]=a.useState(!1),[X,O]=a.useState(0),[w,M]=a.useState(""),[r,D]=a.useState(null),[$,u]=a.useState(""),[T,F]=a.useState(!1),{success:R}=K();a.useEffect(()=>{if(m&&x.length>0){const t=x.find(l=>l.is_default);N(t?t.id:x[0].id)}},[m,x]);const _=a.useMemo(()=>{if(!s?.loyalty_enabled||!s?.settings?.points_per_currency)return 0;const t=d-(i==="delivery"?5:0),l=s.settings.points_per_currency||1;return Math.ceil(t*l)},[d,s?.loyalty_enabled,s?.settings?.points_per_currency,i]),H=async()=>{if(i==="delivery"&&!h){b("Selecione um endere√ßo para entrega.");return}if(c==="cash"&&g&&parseFloat(g.replace(",","."))<d){b("O valor do troco deve ser maior que o total do pedido.");return}P(!0),b("");try{const t={tenant_id:s.settings.tenant_id,customer_id:n.id,mode:i,address_id:i==="delivery"?h:null,payment_method:c,change_for:c==="cash"?parseFloat(g.replace(",",".")):null,coupon_id:r?.id||null,items:f.map(v=>({product_id:v.product.id,quantity:v.quantity,notes:v.notes,complements:v.selectedComplements.map(z=>({id:z.optionId||z.id,quantity:1}))}))},l=await V.post("/customer/checkout",t);l.data.loyalty_points_earned>0?(O(l.data.loyalty_points_earned),E(!0),setTimeout(()=>{R("Pedido Realizado!","Seu pedido foi enviado com sucesso. Acompanhe o status pelo WhatsApp."),C(l.data.order_id),o()},3500)):(R("Pedido Realizado!","Seu pedido foi enviado com sucesso. Acompanhe o status pelo WhatsApp."),C(l.data.order_id),o())}catch(t){console.error(t),b(t.response?.data?.message||"Erro ao processar pedido. Tente novamente.")}finally{P(!1)}},J=async()=>{if(!w.trim()){u("Digite um c√≥digo de cupom");return}F(!0),u("");try{const t=await V.post("/customer/validate-coupon",{code:w,order_total:d,tenant_id:s.settings.tenant_id});t.data.valid?(D(t.data.coupon),M("")):u(t.data.message||"Cupom inv√°lido")}catch(t){u(t.response?.data?.message||"Erro ao validar cupom")}finally{F(!1)}},y=r?r.discount_type==="fixed"?r.discount_value:d*r.discount_value/100:0,q=Math.max(0,d-y),j=t=>`R$ ${t.toFixed(2).replace(".",",")}`;return e.jsxs(Q,{show:m,onClose:o,children:[e.jsx(ne,{points:X,show:G,onComplete:()=>E(!1)}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Finalizar Pedido"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"h-6 w-6"})})]}),A&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm font-medium",children:A}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-[#ff3d03]"}),"Entrega"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx("button",{onClick:()=>k("delivery"),className:p("p-3 rounded-xl border-2 font-bold transition-all",i==="delivery"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:"Entrega"}),e.jsx("button",{onClick:()=>k("pickup"),className:p("p-3 rounded-xl border-2 font-bold transition-all",i==="pickup"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:"Retirada"})]}),i==="delivery"&&e.jsx("div",{className:"space-y-3",children:x.length===0?e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"Nenhum endere√ßo cadastrado"}),e.jsx("button",{className:"text-[#ff3d03] font-bold text-sm hover:underline",children:"Adicionar endere√ßo"})]}):x.map(t=>e.jsxs("div",{onClick:()=>N(t.id),className:p("p-3 rounded-xl border-2 cursor-pointer transition-all flex items-start justify-between",h===t.id?"border-[#ff3d03] bg-orange-50":"border-gray-100 hover:border-gray-200"),children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-900",children:[t.street,", ",t.number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.neighborhood," - ",t.city]})]}),h===t.id&&e.jsx(ee,{className:"h-5 w-5 text-[#ff3d03]"})]},t.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-[#ff3d03]"}),"Cupom de Desconto"]}),r?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-700",children:"‚úì Cupom aplicado!"}),e.jsx("p",{className:"text-sm text-green-600",children:r.code}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Desconto: ",r.discount_type==="fixed"?`R$ ${r.discount_value.toFixed(2)}`:`${r.discount_value}%`]})]}),e.jsx("button",{onClick:()=>D(null),className:"text-green-600 hover:text-green-700",children:e.jsx(B,{className:"h-5 w-5"})})]})}):e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:w,onChange:t=>{M(t.target.value),u("")},placeholder:"Cole seu cupom aqui...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent"}),e.jsx("button",{onClick:J,disabled:T,className:"bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold px-4 py-3 rounded-xl transition-colors disabled:opacity-50",children:T?"...":"Aplicar"})]}),$&&e.jsx("p",{className:"text-sm text-red-600 mb-2",children:$})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-[#ff3d03]"}),"Pagamento (na entrega)"]}),e.jsx("div",{className:"space-y-3",children:[{id:"credit_card",label:"Cart√£o de Cr√©dito",icon:Y},{id:"debit_card",label:"Cart√£o de D√©bito",icon:Y},{id:"cash",label:"Dinheiro",icon:se},{id:"pix",label:"PIX (na entrega)",icon:re}].map(t=>e.jsxs("div",{onClick:()=>W(t.id),className:p("p-3 rounded-xl border-2 cursor-pointer transition-all flex items-center gap-3",c===t.id?"border-[#ff3d03] bg-orange-50":"border-gray-100 hover:border-gray-200"),children:[e.jsx("div",{className:p("p-2 rounded-lg",c===t.id?"bg-white text-[#ff3d03]":"bg-gray-100 text-gray-500"),children:e.jsx(t.icon,{className:"h-5 w-5"})}),e.jsx("span",{className:p("font-bold",c===t.id?"text-[#ff3d03]":"text-gray-700"),children:t.label})]},t.id))}),c==="cash"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precisa de troco para quanto?"}),e.jsx("input",{type:"text",value:g,onChange:t=>L(t.target.value),placeholder:"Ex: 50,00",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent"})]})]})]}),_>0&&e.jsx("div",{className:"mt-6 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl p-4 border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-6 w-6 text-orange-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-orange-900 dark:text-orange-100",children:["Voc√™ vai ganhar ",_," pontos!"]}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:["Equivalente a R$ ",(_*(s?.settings?.currency_per_point||.1)).toFixed(2)]})]})]})}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[y>0&&e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:j(d)})]}),e.jsxs("div",{className:"flex justify-between text-red-600 font-bold",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-",j(y)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar"}),e.jsx("span",{className:"text-2xl font-black text-[#ff3d03]",children:j(q)})]})]}),y===0&&e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar"}),e.jsx("span",{className:"text-2xl font-black text-[#ff3d03]",children:j(q)})]}),e.jsx("button",{onClick:H,disabled:S,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-4 rounded-xl transition-colors flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-5 animate-spin"}),"Processando..."]}):"Confirmar Pedido"})]})]})]})}export{we as default};
