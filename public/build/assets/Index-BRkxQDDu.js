import{c as $,r as d,j as e,e as C,a as L,T as K,u as P,H as Q}from"./app-C1W35bN8.js";import{A as U}from"./AuthenticatedLayout-AmEUQ5jv.js";import{M}from"./Modal-DWxZAUTx.js";import{I as T}from"./InputLabel-_3zYNCf1.js";import{T as E}from"./TextInput-B3MC5Hqn.js";import{P as w}from"./PrimaryButton-Dfu03V_D.js";import{S}from"./SecondaryButton-CnAAWwcA.js";import{k as Z,l as ee,D as se,P as re,d as te}from"./core.esm-CMII82Bj.js";import{S as ae}from"./save-BsqghLZX.js";import{D as oe}from"./DangerButton-DV5iX2wp.js";import{I as z}from"./InputError-Bm9VYQQD.js";import{C as ie}from"./clock-BLHrFU4D.js";import{D as ne}from"./dollar-sign-DrddpAFv.js";import{R as le}from"./refresh-cw-bGkuavwt.js";import{L as de}from"./layout-grid-C-dV3FxQ.js";import{M as ce}from"./map-CghJNx08.js";import{P as me}from"./plus-qlv4qXvR.js";import"./monitor-UGwz1F8Z.js";import"./shopping-bag-XFNCjWS1.js";import"./package-DXwJ4FBX.js";import"./image-DfOI6yXC.js";import"./layout-dashboard-HzB_uDvB.js";import"./credit-card-CXDrhBli.js";import"./trophy-CHLTVOeI.js";import"./ticket-c-9-bVna.js";import"./store-DNOXz79u.js";import"./key-XzPheUBL.js";import"./shield-check-CyqICHme.js";import"./log-out-fRNXPPjn.js";import"./transition-BCMx7zz8.js";import"./use-sync-refs-Bxzx7kHd.js";import"./truck-C5093Z4g.js";import"./switch-psfwI8yE.js";import"./use-resolve-button-type-R6zPIUWg.js";import"./keyboard-BK6vGCbM.js";import"./hidden-DHpd9LWD.js";import"./menu-B3pffHkI.js";import"./portal-oEj3dqf0.js";import"./with-selector-Qxn-_NZa.js";import"./chevron-down-Cm3x0ZdA.js";import"./menu-DKL8AiCC.js";import"./search-69N2sBlT.js";import"./useAudio-B8J1p6s-.js";import"./bell-CO-5OhK2.js";import"./eye-C4xThLUX.js";import"./arrow-left-DePXraiJ.js";const xe=[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]],ue=$("grip-horizontal",xe);const pe=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],he=$("rotate-cw",pe);function ge(r,a,t){const o={...r};return a.top+r.y<=t.top?o.y=t.top-a.top:a.bottom+r.y>=t.top+t.height&&(o.y=t.top+t.height-a.bottom),a.left+r.x<=t.left?o.x=t.left-a.left:a.right+r.x>=t.left+t.width&&(o.x=t.left+t.width-a.right),o}const fe=r=>{let{containerNodeRect:a,draggingNodeRect:t,transform:o}=r;return!t||!a?o:ge(o,t,a)};function be({table:r,isSelected:a}){const{attributes:t,listeners:o,setNodeRef:c,transform:m,isDragging:u}=te({id:r.id,data:{table:r}}),x=()=>a?"ring-2 ring-blue-500 border-blue-500":r.status==="occupied"?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":r.status==="reserved"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",p={left:`${r.position_x}px`,top:`${r.position_y}px`,width:`${r.width}px`,height:`${r.height}px`,position:"absolute",transform:m?`translate3d(${m.x}px, ${m.y}px, 0)`:void 0,zIndex:u?100:1};return e.jsxs("div",{ref:c,style:p,...o,...t,className:C("border-2 shadow-sm flex flex-col items-center justify-center cursor-move transition-colors select-none",x(),u&&"shadow-xl opacity-80 z-50",r.shape==="round"?"rounded-full":"rounded-lg"),children:[e.jsx(ue,{className:"w-4 h-4 text-gray-300 absolute top-2 opacity-0 hover:opacity-100 transition-opacity"}),e.jsx("span",{className:C("font-bold dark:text-white",r.width<60?"text-sm":"text-xl"),children:r.number}),r.width>=60&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:[r.capacity,"L"]}),r.status==="occupied"&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white dark:border-gray-900"})]})}function ye({tables:r}){const[a,t]=d.useState(r),[o,c]=d.useState(!1);d.useEffect(()=>{t(r)},[r]);const m=Z(ee(re,{activationConstraint:{distance:5}})),u=i=>{const{active:l,delta:h}=i,n=l.id;t(g=>g.map(b=>{if(b.id===n){const v=Math.max(0,b.position_x+h.x),y=Math.max(0,b.position_y+h.y),j=N=>Math.round(N/20)*20;return{...b,position_x:j(v),position_y:j(y)}}return b})),c(!0)},x=()=>{const i=a.map(l=>({id:l.id,x:l.position_x,y:l.position_y,width:l.width,height:l.height,shape:l.shape,rotation:l.rotation}));L.post(route("tables.update-positions"),{positions:i},{preserveScroll:!0,onSuccess:()=>c(!1)})},p=(i,l,h)=>{t(n=>n.map(g=>g.id===i?{...g,[l]:h}:g)),c(!0)};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-sm text-gray-500",children:e.jsx("p",{children:"Arraste as mesas para posicionÃ¡-las. Clique em uma mesa para editar formato."})}),e.jsxs("div",{className:"flex gap-2",children:[o&&e.jsx("span",{className:"text-amber-500 text-sm flex items-center px-2",children:"AlteraÃ§Ãµes nÃ£o salvas"}),e.jsxs(w,{onClick:x,disabled:!o,className:C("gap-2",!o&&"opacity-50 cursor-not-allowed"),children:[e.jsx(ae,{className:"w-4 h-4"}),"Salvar Layout"]})]})]}),e.jsxs("div",{className:"relative w-full h-[600px] bg-gray-100 dark:bg-gray-900 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 overflow-hidden shadow-inner font-sans",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.1] pointer-events-none",style:{backgroundImage:"linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsx(se,{sensors:m,modifiers:[fe],onDragEnd:u,children:a.map(i=>e.jsxs("div",{children:[e.jsx(be,{table:i,isSelected:!1}),e.jsxs("div",{style:{left:i.position_x,top:i.position_y-25,position:"absolute",zIndex:50},className:"flex gap-1 opacity-0 hover:opacity-100 transition-opacity bg-white/80 rounded p-1 shadow-sm",children:[e.jsx("button",{onClick:()=>p(i.id,"shape",i.shape==="round"?"square":"round"),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:i.shape==="round"?"â¬›":"ðŸ”µ"}),e.jsx("button",{onClick:()=>p(i.id,"width",i.width+10),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"+"}),e.jsx("button",{onClick:()=>p(i.id,"width",Math.max(40,i.width-10)),className:"p-0.5 hover:bg-gray-200 rounded text-[10px]",children:"-"})]})]},i.id))})]})]})}function I({show:r,onClose:a,onConfirm:t,title:o,message:c,confirmLabel:m="Confirmar",cancelLabel:u="Cancelar",processing:x=!1}){return e.jsx(M,{show:r,onClose:a,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full dark:bg-red-900/20 mb-4",children:e.jsx(K,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-lg font-medium text-center text-gray-900 dark:text-gray-100 mb-2",children:o}),e.jsx("p",{className:"text-sm text-center text-gray-500 dark:text-gray-400 mb-6",children:c}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(S,{onClick:a,disabled:x,children:u}),e.jsx(oe,{onClick:t,disabled:x,children:m})]})]})})}function je({show:r,onClose:a,sourceTable:t,tables:o}){const{data:c,setData:m,post:u,processing:x,reset:p,errors:i}=P({target_table_id:""});d.useEffect(()=>{r||p()},[r]);const l=n=>{n.preventDefault(),t&&u(route("tables.transfer",t.id),{onSuccess:()=>a()})},h=o.filter(n=>n.status==="free"&&n.id!==t?.id).sort((n,g)=>n.number-g.number);return e.jsx(M,{show:r,onClose:a,maxWidth:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["Transferir Mesa ",t?.number]}),e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Para Mesa:"}),e.jsxs("select",{value:c.target_table_id,onChange:n=>m("target_table_id",n.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma mesa livre..."}),h.map(n=>e.jsxs("option",{value:n.id,children:["Mesa ",n.number]},n.id))]}),i.target_table_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.target_table_id})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(S,{onClick:a,children:"Cancelar"}),e.jsx(w,{disabled:x||!c.target_table_id,children:"Transferir"})]})]})]})})}function us({tables:r}){const[a,t]=d.useState(!1),[o,c]=d.useState(null),[m,u]=d.useState({show:!1,id:null}),[x,p]=d.useState({show:!1,id:null,number:null}),[i,l]=d.useState({show:!1,table:null}),[h,n]=d.useState("grid"),[g,b]=d.useState(new Date);d.useEffect(()=>{const s=setInterval(()=>b(new Date),6e4);return()=>clearInterval(s)},[]),d.useEffect(()=>{const s=setInterval(()=>{h==="grid"&&L.visit(window.location.pathname,{only:["tables"],preserveScroll:!0,preserveState:!0,replace:!0})},3e4);return()=>clearInterval(s)},[h]);const{data:v,setData:y,post:j,put:N,delete:q,processing:B,reset:F,errors:_,clearErrors:R}=P({number:"",capacity:"4"});d.useEffect(()=>{a||(F(),R(),c(null))},[a]);const A=s=>{s.preventDefault(),o?N(route("tables.update",o.id),{onSuccess:()=>t(!1)}):j(route("tables.store"),{onSuccess:()=>t(!1)})},G=s=>{c(s),y({number:s.number.toString(),capacity:s.capacity.toString()}),t(!0)},H=s=>{u({show:!0,id:s.id})},O=()=>{m.id&&q(route("tables.destroy",m.id),{onFinish:()=>u({show:!1,id:null})})},V=s=>{s.status==="occupied"&&l({show:!0,table:{id:s.id,number:s.number}})},W=s=>{p({show:!0,id:s.id,number:s.number})},X=()=>{x.id&&j(route("tables.reopen",x.id),{onSuccess:()=>p({show:!1,id:null,number:null}),onFinish:()=>p({show:!1,id:null,number:null})})},D=s=>{if(!s)return 0;const f=new Date(s).getTime(),k=g.getTime();return Math.floor((k-f)/(1e3*60))},Y=s=>{if(s.status==="free")return"bg-green-100 text-green-800 border-green-200";if(s.status==="reserved")return"bg-blue-100 text-blue-800 border-blue-200";const f=D(s.occupied_since||s.occupied_at);return f>120?"bg-red-100 text-red-800 border-red-200 animate-pulse-slow":f>60?"bg-orange-100 text-orange-800 border-orange-200":"bg-yellow-100 text-yellow-800 border-yellow-200"},J=s=>{const f=Math.floor(s/60),k=s%60;return`${f}h ${k}m`};return e.jsxs(U,{header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"GestÃ£o de Mesas"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-1 flex border border-gray-200 dark:border-gray-700 mr-2",children:[e.jsx("button",{onClick:()=>n("grid"),className:`p-2 rounded-md transition-colors ${h==="grid"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o em Grid",children:e.jsx(de,{size:20})}),e.jsx("button",{onClick:()=>n("map"),className:`p-2 rounded-md transition-colors ${h==="map"?"bg-orange-100 text-orange-600":"text-gray-500 hover:bg-gray-100"}`,title:"VisualizaÃ§Ã£o de Mapa",children:e.jsx(ce,{size:20})})]}),e.jsxs(w,{onClick:()=>t(!0),className:"flex items-center gap-2",children:[e.jsx(me,{size:16})," Nova Mesa"]})]})]}),children:[e.jsx(Q,{title:"Mesas"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})," Livre"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"})," Ocupada"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})," ",">"," 1h"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})," ",">"," 2h"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:h==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:r.map(s=>{const f=D(s.occupied_since||s.occupied_at);return e.jsxs("div",{className:`relative rounded-xl border-2 p-4 transition-all hover:shadow-md ${Y(s)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Mesa ",s.number]}),e.jsx("button",{onClick:()=>G(s),className:"text-xs opacity-50 hover:opacity-100",children:"Editar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("span",{children:[s.capacity," Lugares"]})}),s.status==="occupied"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono mb-1",children:[e.jsx(ie,{size:12}),J(f)]}),e.jsxs("div",{className:"flex items-center gap-1 font-bold text-lg",children:[e.jsx(ne,{size:16}),new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.current_order?.total||0)]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsxs("button",{onClick:()=>V(s),className:"flex-1 bg-white/50 hover:bg-white/80 py-1 rounded text-xs font-semibold transition-colors flex items-center justify-center gap-1",children:[e.jsx(he,{size:12})," Transferir"]})})]}),s.status==="free"&&e.jsxs("div",{className:"mt-8 text-center opacity-50 text-xs",children:["DisponÃ­vel",s.can_reopen&&e.jsx("div",{className:"mt-2",children:e.jsxs("button",{onClick:()=>W(s),className:"text-orange-600 hover:text-orange-800 flex items-center justify-center gap-1 mx-auto bg-orange-50 px-2 py-1 rounded transition-colors",title:"Reabrir Ãºltima conta (estornar pagamento)",children:[e.jsx(le,{size:12})," Reabrir"]})})]})]})]},s.id)})}):e.jsx(ye,{tables:r})})]})}),e.jsx(M,{show:a,onClose:()=>t(!1),children:e.jsxs("form",{onSubmit:A,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:o?"Editar Mesa":"Nova Mesa"}),e.jsxs("div",{className:"mt-6",children:[e.jsx(T,{htmlFor:"number",value:"NÃºmero da Mesa"}),e.jsx(E,{id:"number",type:"number",className:"mt-1 block w-full",value:v.number,onChange:s=>y("number",s.target.value),required:!0}),e.jsx(z,{message:_.number,className:"mt-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(T,{htmlFor:"capacity",value:"Capacidade"}),e.jsx(E,{id:"capacity",type:"number",className:"mt-1 block w-full",value:v.capacity,onChange:s=>y("capacity",s.target.value),required:!0}),e.jsx(z,{message:_.capacity,className:"mt-2"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[o&&e.jsx("button",{type:"button",onClick:()=>H(o),className:"text-red-600 hover:text-red-800",children:"Excluir"}),e.jsx(S,{onClick:()=>t(!1),children:"Cancelar"}),e.jsx(w,{disabled:B,children:"Salvar"})]})]})}),e.jsx(I,{show:m.show,onClose:()=>u({show:!1,id:null}),onConfirm:O,title:"Excluir Mesa",message:"Tem certeza que deseja excluir esta mesa? Esta aÃ§Ã£o nÃ£o pode ser desfeita."}),e.jsx(I,{show:x.show,onClose:()=>p({show:!1,id:null,number:null}),onConfirm:X,title:"Reabrir Mesa",message:`Deseja reabrir a Mesa ${x.number}? Isso irÃ¡ estornar o pagamento e deixar a mesa ocupada novamente com o Ãºltimo pedido.`,confirmLabel:"Sim, Reabrir",cancelLabel:"Cancelar"}),e.jsx(je,{show:i.show,onClose:()=>l({show:!1,table:null}),sourceTable:i.table,tables:r})]})}export{us as default};
