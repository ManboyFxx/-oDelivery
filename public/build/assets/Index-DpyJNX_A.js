import{r as o,g as V,f as X,j as r,H as q,X as J,a as E}from"./app-D2VljvTw.js";import{A as W}from"./AuthenticatedLayout-Cx4f4-fS.js";import Y from"./OrderCard-D-af2r6Z.js";import Z from"./DraggableOrderCard-BVy6WoJD.js";import ee from"./OrderDrawer-BGuUuxe2.js";import{CancelOrderModal as re,ChangePaymentModal as te,EditOrderModal as oe,ChangeModeModal as se}from"./ActionModals-DlyWrMme.js";import{k as ae,l as ne,D as ie,f as de,m as le,P as ce}from"./core.esm-ozc3h8l7.js";import{S as ge,v as me}from"./sortable.esm-D4Ik1ilg.js";import{C as ue}from"./circle-DpCxaWrR.js";import{C as pe}from"./clock-DhsNYQvR.js";import{C as be}from"./circle-check-big-jFZJVZKS.js";import{T as xe}from"./truck-2VxR7Zq1.js";import{P as he}from"./package-DITWTL1u.js";import{F as fe}from"./funnel-DhLA-nVu.js";import{M as ye}from"./map-pin-CycHX-FG.js";import{B as we}from"./bike-BQTJuiF2.js";import{C as ve}from"./credit-card-CJ_Fv3xf.js";import"./shopping-bag-DeV0Q4uc.js";import"./menu-D_M5zKdZ.js";import"./use-resolve-button-type-hvyh8Ega.js";import"./keyboard-D3GHKAuh.js";import"./use-sync-refs-DLhS85IC.js";import"./portal-KUhlGsT1.js";import"./with-selector-D8O5el8K.js";import"./transition-D2MB-Bkq.js";import"./trophy-CGi22m5G.js";import"./chart-column-BI1AR2fd.js";import"./ticket-Btog9CtY.js";import"./store-DuxhVZGb.js";import"./dollar-sign-u-pr0hpI.js";import"./shield-check-BwRQitPR.js";import"./log-out-BGloaton.js";import"./Modal-CPkuO39I.js";import"./hidden-DG7gvhwG.js";import"./switch-DTazzpId.js";import"./chevron-down-DopCl3ie.js";import"./search-DgyBcvPy.js";import"./bell-CJEF_sGF.js";import"./sparkles-CJH1Xak9.js";import"./arrow-right-D3E33b_Z.js";import"./eye-Lo_UvX06.js";import"./arrow-left-BOEQvvf9.js";import"./circle-alert-XKeeM4ji.js";import"./user-Bxz_gykG.js";import"./message-circle-Cj5I8UU2.js";import"./square-pen-BCgsOZ4v.js";import"./printer-C1KKSPQY.js";import"./check-S0IfOmyK.js";import"./timer-Cxn2AkRw.js";import"./phone-Dt7T46Lm.js";import"./InputLabel-DKb6P6rq.js";import"./TextInput-DLKzFZ7C.js";function vr({orders:n,motoboys:y=[],products:D=[]}){const M=o.useMemo(()=>[{id:"new",title:"Novos",statuses:["new"],icon:ue,iconColor:"text-blue-500",headerBg:"bg-white",borderColor:"border-blue-100",containerBg:"bg-gray-50/50",badgeColor:"bg-blue-50 text-blue-700 ring-1 ring-blue-700/10"},{id:"preparing",title:"Preparando",statuses:["preparing"],icon:pe,iconColor:"text-orange-500",headerBg:"bg-white",borderColor:"border-orange-100",containerBg:"bg-orange-50/30",badgeColor:"bg-orange-50 text-orange-700 ring-1 ring-orange-700/10"},{id:"ready",title:"Pronto / Aguardando",statuses:["ready","waiting_motoboy"],icon:be,iconColor:"text-green-500",headerBg:"bg-white",borderColor:"border-green-100",containerBg:"bg-green-50/30",badgeColor:"bg-green-50 text-green-700 ring-1 ring-green-700/10"},{id:"out_for_delivery",title:"Em Entrega",statuses:["motoboy_accepted","out_for_delivery"],icon:xe,iconColor:"text-indigo-500",headerBg:"bg-white",borderColor:"border-indigo-100",containerBg:"bg-indigo-50/30",badgeColor:"bg-indigo-50 text-indigo-700 ring-1 ring-indigo-700/10"}],[]),[s,c]=o.useState({neighborhood:"",motoboy:"",paymentStatus:""}),[p,A]=o.useState(!1),[B,w]=o.useState(null),[$,v]=o.useState(!1),T=o.useCallback(e=>{w(e),v(!0)},[]),F=o.useCallback(()=>{v(!1),setTimeout(()=>w(null),300)},[]),I=o.useMemo(()=>Array.from(new Set(n.filter(e=>e.address?.neighborhood).map(e=>e.address.neighborhood))),[n]),R=o.useMemo(()=>Array.from(new Set(n.filter(e=>e.motoboy).map(e=>e.motoboy.id))).map(e=>n.find(a=>a.motoboy?.id===e)?.motoboy).filter(Boolean),[n]),b=o.useMemo(()=>n.filter(e=>!(s.neighborhood&&e.address?.neighborhood!==s.neighborhood||s.motoboy&&e.motoboy?.id!==s.motoboy||s.paymentStatus&&e.payment_status!==s.paymentStatus)),[n,s]),L=o.useCallback((e,t)=>{const a=t||[e];return b.filter(i=>a.includes(i.status))},[b]),{play:z,initializeAudio:j}=V(),{success:k,info:G}=X(),[C,H]=o.useState(!1),x=o.useRef({});o.useEffect(()=>{x.current=n.reduce((e,t)=>({...e,[t.id]:t.status}),{})},[]),o.useEffect(()=>{const e=()=>{H(!0),j()};return window.addEventListener("click",e,{once:!0}),()=>window.removeEventListener("click",e)},[j]),o.useEffect(()=>{const e=window.page?.props?.auth?.user?.tenant_id||window.page?.props?.tenant?.id;let t=0;const i=setInterval(async()=>{if(e)try{const d=await fetch(`/api/poll/${e}`);if(!d.ok)return;const{timestamp:l}=await d.json();if(t===0){t=l;return}l>t&&(console.log("[OrdersPolling] Change detected via Poll File. Reloading..."),t=l,E.reload({only:["orders"],preserveScroll:!0}))}catch{}},15e3);return()=>clearInterval(i)},[]),o.useEffect(()=>{const e=x.current,t=n.reduce((d,l)=>({...d,[l.id]:l.status}),{});console.log("[OrdersPolling] Update received",{count:n.length,audioEnabled:C});const a=n.some(d=>!e[d.id]&&d.status==="new"),i=n.some(d=>{const l=e[d.id];return l&&l!=="ready"&&d.status==="ready"});a&&console.log("[OrdersPolling] New order detected!"),i&&console.log("[OrdersPolling] Ready order detected!"),x.current=t},[n,C,z,k,G]);const[g,N]=o.useState(null),[m,S]=o.useState(null),O=o.useCallback((e,t)=>{if(N(t),e==="print")window.open(`/orders/${t.id}/print`,"_blank","width=400,height=600");else if(e==="whatsapp")if(t.customer_phone){const a=`Olá ${t.customer_name}, sobre seu pedido ${t.order_number}...`;window.open(`https://wa.me/55${t.customer_phone.replace(/\D/g,"")}?text=${encodeURIComponent(a)}`,"_blank")}else alert("Cliente sem telefone cadastrado.");else S(e)},[]),u=()=>{S(null),N(null)},[P,_]=o.useState(null),U=ae(ne(ce,{activationConstraint:{distance:8}})),K=e=>{const{active:t}=e,a=n.find(i=>i.id===t.id);_(a||null)},Q=e=>{const{active:t,over:a}=e;if(_(null),!a)return;const i=t.id,d=a.id,l=n.find(f=>f.id===i);if(!l||l.status===d)return;const h={new:"new",preparing:"preparing",ready:"ready",out_for_delivery:"out_for_delivery"}[d];h&&E.post(route("orders.status",l.id),{status:h},{preserveScroll:!0,onSuccess:()=>{const f={new:"Novo",preparing:"Em Preparo",ready:"Pronto",out_for_delivery:"Em Entrega"};k("Status Atualizado",`Pedido #${l.order_number} → ${f[h]}`)}})};return r.jsxs(W,{children:[r.jsx(q,{title:"Gerenciador de Pedidos"}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-500/20 rounded-xl",children:r.jsx(he,{className:"w-6 h-6 text-orange-600 dark:text-orange-500"})}),r.jsx("h2",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tight leading-none",children:"Kanban de Pedidos"})]}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 font-medium ml-1",children:"Gerencie o fluxo da sua cozinha e entregas em tempo real"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("button",{onClick:()=>A(!p),className:`flex items-center gap-2 px-4 py-2.5 rounded-2xl text-sm font-bold transition-colors shadow-sm ${p||Object.values(s).some(e=>e)?"bg-[#ff3d03] text-white":"bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 text-gray-700 dark:text-gray-300 hover:border-[#ff3d03]"}`,children:[r.jsx(fe,{className:"w-4 h-4"}),"Filtros",Object.values(s).filter(e=>e).length>0&&r.jsx("span",{className:"bg-white text-[#ff3d03] px-1.5 py-0.5 rounded-full text-xs font-black",children:Object.values(s).filter(e=>e).length})]}),r.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-[#1a1b1e] border border-gray-100 dark:border-white/5 px-4 py-2.5 rounded-2xl text-sm font-bold text-gray-700 dark:text-gray-300 shadow-sm",children:[r.jsxs("span",{className:"relative flex h-2.5 w-2.5 mr-1",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]}),b.length," pedidos ",Object.values(s).some(e=>e)?"filtrados":"ativos"]})]})]}),p&&r.jsxs("div",{className:"bg-white dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/10 rounded-2xl p-4 mb-4 shadow-sm",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(ye,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),r.jsxs("select",{value:s.neighborhood,onChange:e=>c({...s,neighborhood:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os bairros"}),I.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(we,{className:"w-4 h-4 inline mr-1"}),"Entregador"]}),r.jsxs("select",{value:s.motoboy,onChange:e=>c({...s,motoboy:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os entregadores"}),R.map(e=>e&&r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(ve,{className:"w-4 h-4 inline mr-1"}),"Pagamento"]}),r.jsxs("select",{value:s.paymentStatus,onChange:e=>c({...s,paymentStatus:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:border-[#ff3d03] focus:ring-0",children:[r.jsx("option",{value:"",children:"Todos os status"}),r.jsx("option",{value:"paid",children:"Pago"}),r.jsx("option",{value:"pending",children:"Pendente"})]})]})]}),Object.values(s).some(e=>e)&&r.jsxs("button",{onClick:()=>c({neighborhood:"",motoboy:"",paymentStatus:""}),className:"mt-3 flex items-center gap-2 text-sm font-bold text-gray-600 dark:text-gray-400 hover:text-[#ff3d03] transition-colors",children:[r.jsx(J,{className:"w-4 h-4"}),"Limpar filtros"]})]}),r.jsxs(ie,{sensors:U,collisionDetection:de,onDragStart:K,onDragEnd:Q,children:[r.jsx("div",{className:"flex lg:grid lg:grid-cols-4 gap-4 flex-1 h-[calc(100vh-14rem)] overflow-x-auto lg:overflow-x-visible px-1 pb-2",children:M.map(e=>{const t=L(e.id,e.statuses),a=e.icon;return r.jsx(ge,{id:e.id,items:t.map(i=>i.id),strategy:me,children:r.jsxs("div",{className:"flex h-full flex-col rounded-[24px] bg-gray-50 dark:bg-[#1a1b1e] border border-gray-200 dark:border-white/5 shadow-xl shadow-gray-200/50 dark:shadow-none min-w-[280px] lg:min-w-0",children:[r.jsx("div",{className:"p-3 bg-gray-50 dark:bg-[#1a1b1e] z-10 rounded-t-[24px]",children:r.jsxs("div",{className:"flex items-center justify-between rounded-xl p-3 bg-white dark:bg-black/20 border border-gray-100 dark:border-white/5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r.jsx("div",{className:`p-2 rounded-lg bg-gray-50 dark:bg-white/5 flex-shrink-0 ${e.iconColor}`,children:r.jsx(a,{className:"h-4 w-4"})}),r.jsx("span",{className:"font-extrabold text-gray-900 dark:text-white text-sm tracking-tight truncate",children:e.title})]}),r.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black flex-shrink-0 ${e.badgeColor}`,children:t.length})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto px-3 pb-3 space-y-3",children:[t.map(i=>r.jsx(Z,{order:i,motoboys:y,onAction:O,onQuickView:T},i.id)),t.length===0&&r.jsxs("div",{className:"flex flex-col items-center justify-center h-full max-h-48 rounded-[20px] border-2 border-dashed border-gray-200 dark:border-gray-800 text-gray-400 dark:text-gray-600 gap-2 mt-2 bg-gray-50/50 dark:bg-white/5 opacity-60",children:[r.jsx("div",{className:"p-3 bg-white dark:bg-black/20 rounded-full",children:r.jsx(a,{className:"h-6 w-6 opacity-40"})}),r.jsxs("span",{className:"text-[10px] font-bold opacity-60 uppercase tracking-widest text-center leading-tight",children:["Sem",r.jsx("br",{}),"pedidos"]})]})]})]})},e.id)})}),r.jsx(le,{children:P?r.jsx("div",{className:"rotate-3 scale-105 opacity-90",children:r.jsx(Y,{order:P,motoboys:y,onAction:()=>{}})}):null})]}),r.jsx(re,{show:m==="cancel",onClose:u,order:g}),r.jsx(te,{show:m==="payment",onClose:u,order:g}),r.jsx(oe,{show:m==="edit",onClose:u,order:g,products:D}),r.jsx(se,{show:m==="mode",onClose:u,order:g}),r.jsx(ee,{order:B,isOpen:$,onClose:F,onAction:O})]})}export{vr as default};
