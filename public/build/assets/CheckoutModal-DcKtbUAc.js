import{r as t,j as e,f as me,X as $,e as i,d as J}from"./app-Bh9R34ZO.js";import{M as xe}from"./Modal-BHnUrnJl.js";import{S as pe}from"./sparkles-8cRFo6sA.js";import{G as Q}from"./gift-CsUF-c-z.js";import fe from"./AddressForm-1FfLEWCT.js";import{A as ue}from"./arrow-left-BDrpKwaE.js";import{M as S}from"./map-pin-ChFKG0_V.js";import{W as F}from"./wallet-CBklug6H.js";import{T as he}from"./ticket-CtW85ApK.js";import{C as K}from"./credit-card-D2VfEDVY.js";import{B as ge}from"./banknote-CekNfqNE.js";import{L as be}from"./loader-circle-pSTIGnyc.js";import{C as ye}from"./chevron-right-BsugoGCR.js";import{C as je}from"./circle-check-big-D6qJM-gZ.js";import"./keyboard-BiCSg4Of.js";import"./use-sync-refs-B_p-Iyz4.js";import"./portal-BHWBglhE.js";import"./with-selector-CmbsVBJE.js";import"./hidden-DThcXkGa.js";import"./transition-DzHQOXHN.js";import"./TextInput-C8i9m1oY.js";import"./InputLabel-DRWE2UgA.js";import"./PrimaryButton-BVRCw3Yl.js";import"./SecondaryButton-DLCKdfQL.js";import"./search-CcoCB8bW.js";function ve({points:u,show:x,onComplete:h}){return t.useEffect(()=>{if(x){const r=setTimeout(h,3500);return()=>clearTimeout(r)}},[x,h]),x?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 animate-fade-in pointer-events-auto"}),e.jsx("style",{children:`
                @keyframes celebrationBounce {
                    0% {
                        transform: scale(0.5) translateY(20px);
                        opacity: 0;
                    }
                    50% {
                        transform: scale(1.05) rotate(5deg);
                    }
                    100% {
                        transform: scale(1) translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes spin-slowly {
                    0%, 100% { transform: rotate(0deg); }
                    50% { transform: rotate(10deg) scaleY(1.1); }
                }

                @keyframes pulse-glow {
                    0%, 100% { box-shadow: 0 0 20px rgba(255, 61, 3, 0.5); }
                    50% { box-shadow: 0 0 40px rgba(255, 61, 3, 0.8); }
                }

                @keyframes float-up {
                    0% {
                        opacity: 1;
                        transform: translateY(0);
                    }
                    100% {
                        opacity: 0;
                        transform: translateY(-100px);
                    }
                }

                .celebration-card {
                    animation: celebrationBounce 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
                }

                .celebration-icon {
                    animation: spin-slowly 2s ease-in-out infinite;
                }

                .celebration-glow {
                    animation: pulse-glow 1.5s ease-in-out infinite;
                }

                .floating-points {
                    animation: float-up 2s ease-out forwards;
                }
            `}),e.jsx("div",{className:"celebration-card relative z-10",children:e.jsxs("div",{className:"bg-gradient-to-br from-orange-400 via-orange-500 to-pink-500 rounded-3xl p-8 shadow-2xl celebration-glow text-center max-w-sm w-full",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[...Array(6)].map((r,d)=>e.jsx(pe,{className:"absolute h-6 w-6 text-white/40",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float-up ${2+Math.random()*1}s ease-out forwards`,animationDelay:`${d*.2}s`}},d))}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"celebration-icon mb-4",children:e.jsx(Q,{className:"h-16 w-16 mx-auto text-white drop-shadow-lg"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-black text-white mb-2 drop-shadow-lg",children:"Parab√©ns!"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("p",{className:"text-5xl font-black mb-2 drop-shadow-lg",children:["+",u]}),e.jsx("p",{className:"text-lg font-bold drop-shadow-lg",children:"pontos!"})]}),e.jsx("p",{className:"text-white/90 text-sm mt-3 drop-shadow-lg",children:"Voc√™ est√° acumulando pr√™mios üéâ"})]})]})}),[...Array(8)].map((r,d)=>e.jsx("div",{className:"absolute floating-points pointer-events-none",style:{left:`calc(50% + ${(d-4)*30}px)`,top:"50%",animationDelay:`${d*.1}s`},children:e.jsxs("span",{className:"text-2xl font-black text-orange-500",children:["+",Math.floor(u/4)]})},d))]}):null}function He({show:u,onClose:x,cart:h,store:r,customer:d,total:Z,addresses:A,onSuccess:Ne}){const[a,j]=t.useState("delivery"),[n,z]=t.useState("delivery"),[c,D]=t.useState(A),[l,v]=t.useState(""),[E,N]=t.useState(!1),[p,ee]=t.useState("credit_card"),[w,se]=t.useState(""),[q,I]=t.useState(!1),[B,g]=t.useState(""),[te,V]=t.useState(!1),[ae,re]=t.useState(0),[C,L]=t.useState(""),[m,Y]=t.useState(null),[W,k]=t.useState(""),[oe,G]=t.useState(!1),{success:P}=me();t.useEffect(()=>{D(A)},[A]),t.useEffect(()=>{if(u&&c.length>0&&!l){const s=c.find(o=>o.is_default);v(s?s.id:c[0].id)}},[u,c,l]);const X=n==="delivery"?r.settings?.delivery_fee||5:0,M=m&&m.discount_amount||0,b=Z,R=Math.max(0,b+X-M),O=t.useMemo(()=>!r?.loyalty_enabled||!r?.settings?.points_per_currency?0:Math.ceil(b*r.settings.points_per_currency),[b,r]),f=s=>`R$ ${s.toFixed(2).replace(".",",")}`,ne=()=>{if(a==="delivery"){if(n==="delivery"&&!l){g("Selecione um endere√ßo para entrega.");return}g(""),j("payment")}else if(a==="payment"){if(p==="cash"&&w&&parseFloat(w.replace(",","."))<R){g("O valor do troco deve ser maior que o total.");return}g(""),j("review")}},U=()=>{a==="review"?j("payment"):a==="payment"&&j("delivery")},le=async()=>{I(!0),g("");try{const s={tenant_id:r.settings.tenant_id,customer_id:d.id,mode:n,address_id:n==="delivery"?l:null,payment_method:p,change_for:p==="cash"?parseFloat(w.replace(",",".")):null,coupon_id:m?.id||null,items:h.map(_=>({product_id:_.product.id,quantity:_.quantity,notes:_.notes,complements:_.selectedComplements.map(H=>({id:H.optionId||H.id,quantity:1}))}))},o=await J.post("/customer/checkout",s),y=`/${window.location.pathname.split("/")[1]}/orders/${o.data.order_id}`;o.data.loyalty_points_earned>0?(re(o.data.loyalty_points_earned),V(!0),setTimeout(()=>{P("Pedido Realizado!","Redirecionando para acompanhamento..."),window.location.href=y},3500)):(P("Pedido Realizado!","Redirecionando para acompanhamento..."),setTimeout(()=>{window.location.href=y},1500))}catch(s){console.error(s),g(s.response?.data?.message||"Erro ao processar pedido.")}finally{I(!1)}},ie=async()=>{if(C.trim()){G(!0),k("");try{const s=await J.post("/api/validate-coupon",{code:C,cart_total:b,tenant_id:r.tenant_id||window.location.pathname.split("/")[1]});s.data.valid?(Y({...s.data.coupon,discount_amount:s.data.discount}),P("Cupom Aplicado!",s.data.message),L("")):k(s.data.message||"Cupom inv√°lido")}catch(s){k(s.response?.data?.message||"Erro ao validar cupom")}finally{G(!1)}}},de=s=>{D(o=>[...o,s]),v(s.id),N(!1)},ce=()=>e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2",children:[[{id:"delivery",label:"Entrega",icon:S},{id:"payment",label:"Pagamento",icon:F},{id:"review",label:"Confirma√ß√£o",icon:je}].map((s,o)=>{const T=s.id===a,y=a==="payment"&&o===0||a==="review"&&o<=1;return e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx("div",{className:i("w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 border-2",T?"bg-[#ff3d03] border-[#ff3d03] text-white shadow-lg scale-110":y?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-400"),children:e.jsx(s.icon,{className:"w-5 h-5"})}),e.jsx("span",{className:i("text-xs font-semibold mt-2",T?"text-[#ff3d03]":y?"text-green-600":"text-gray-400"),children:s.label})]},s.id)}),e.jsx("div",{className:"absolute top-[4.5rem] left-10 right-10 h-0.5 bg-gray-200 -z-0"}),e.jsx("div",{className:i("absolute top-[4.5rem] left-10 h-0.5 bg-green-500 transition-all duration-300 -z-0",a==="delivery"?"w-0":a==="payment"?"w-1/2":"w-[calc(100%-5rem)]")})]});return e.jsxs(xe,{show:u,onClose:x,maxWidth:"md",children:[e.jsx(ve,{points:ae,show:te,onComplete:()=>V(!1)}),e.jsxs("div",{className:"p-6 min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a!=="delivery"?e.jsx("button",{onClick:U,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(ue,{className:"h-6 w-6 text-gray-600"})}):e.jsx("div",{}),e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[a==="delivery"&&"Entrega ou Retirada",a==="payment"&&"Pagamento",a==="review"&&"Resumo do Pedido"]}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600",children:e.jsx($,{className:"h-6 w-6"})})]}),!E&&ce(),e.jsxs("div",{className:"flex-1 overflow-y-auto max-h-[60vh] px-1 py-1",children:[B&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm font-medium flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"})," ",B]}),E?e.jsx(fe,{onCancel:()=>N(!1),onSuccess:de,tenantId:r.settings.tenant_id,customerId:d.id}):e.jsxs(e.Fragment,{children:[a==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>z("delivery"),className:i("p-4 rounded-xl border-2 font-bold transition-all flex flex-col items-center gap-2",n==="delivery"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:[e.jsx(S,{className:"w-6 h-6"}),"Entrega"]}),e.jsxs("button",{onClick:()=>z("pickup"),className:i("p-4 rounded-xl border-2 font-bold transition-all flex flex-col items-center gap-2",n==="pickup"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"w-6 h-6 relative",children:e.jsx(F,{className:"absolute w-full h-full"})}),"Retirada"]})]}),n==="delivery"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Selecione o Endere√ßo"}),e.jsx("button",{onClick:()=>N(!0),className:"text-sm font-bold text-[#ff3d03] hover:underline",children:"+ Novo Endere√ßo"})]}),c.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:[e.jsx(S,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"Nenhum endere√ßo cadastrado"}),e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50",children:"Cadastrar Agora"})]}):c.map(s=>e.jsx("div",{onClick:()=>v(s.id),className:i("p-4 rounded-xl border-2 cursor-pointer transition-all flex items-start justify-between group",l===s.id?"border-[#ff3d03] bg-orange-50/50":"border-gray-100 hover:border-gray-200 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:i("mt-1 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0",l===s.id?"border-[#ff3d03] bg-[#ff3d03]":"border-gray-300"),children:l===s.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-900",children:[s.street,", ",s.number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.neighborhood," - ",s.city]}),s.complement&&e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:s.complement})]})]})},s.id))]})]}),a==="payment"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-[#ff3d03]"}),"Cupom de Desconto"]}),m?e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-3 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-green-700 text-sm",children:["‚úì ",m.code]}),e.jsxs("p",{className:"text-xs text-green-600",children:["Desconto de ",m.discount_type==="fixed"?f(m.discount_value):`${m.discount_value}%`]})]}),e.jsx("button",{onClick:()=>Y(null),className:"text-gray-400 hover:text-red-500",children:e.jsx($,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:s=>{L(s.target.value),k("")},placeholder:"C√≥digo do cupom",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-[#ff3d03] focus:border-[#ff3d03]"}),e.jsx("button",{onClick:ie,disabled:oe||!C,className:"bg-gray-900 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50",children:"Aplicar"})]}),W&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:W})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"Forma de Pagamento"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"credit_card",label:"Cr√©dito",sub:"Maquininha",icon:K},{id:"debit_card",label:"D√©bito",sub:"Maquininha",icon:K},{id:"pix",label:"PIX",sub:"Na entrega",icon:F},{id:"cash",label:"Dinheiro",sub:"Esp√©cie",icon:ge}].map(s=>e.jsxs("div",{onClick:()=>ee(s.id),className:i("p-3 rounded-xl border-2 cursor-pointer transition-all flex flex-col items-center text-center gap-2 hover:shadow-md",p===s.id?"border-[#ff3d03] bg-orange-50 shadow-sm":"border-gray-100 hover:border-gray-200"),children:[e.jsx(s.icon,{className:i("w-6 h-6",p===s.id?"text-[#ff3d03]":"text-gray-400")}),e.jsxs("div",{children:[e.jsx("p",{className:i("font-bold text-sm",p===s.id?"text-[#ff3d03]":"text-gray-700"),children:s.label}),e.jsx("p",{className:"text-[10px] text-gray-400",children:s.sub})]})]},s.id))})]}),p==="cash"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Troco para quanto?"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:w,onChange:s=>se(s.target.value),placeholder:"0,00",className:"w-full pl-9 px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#ff3d03] focus:border-[#ff3d03]"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total do pedido: ",f(R)]})]})]}),a==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Resumo do Pedido"}),e.jsxs("span",{className:"text-xs font-medium bg-gray-200 px-2 py-1 rounded-full text-gray-600",children:[h.length," itens"]})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-40 overflow-y-auto",children:h.map((s,o)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]}),e.jsx("span",{className:"text-gray-600 line-clamp-1",children:s.product.name})]}),e.jsx("span",{className:"text-gray-900 font-medium",children:f(s.subtotal)})]},o))})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-xl text-sm text-blue-800",children:[e.jsx(S,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:n==="delivery"?"Entrega em:":"Retirada em Loja"}),n==="delivery"&&l?e.jsxs("p",{className:"opacity-90",children:[c.find(s=>s.id===l)?.street,", ",c.find(s=>s.id===l)?.number]}):e.jsx("p",{className:"opacity-90",children:"Retirar no balc√£o."})]})]}),O>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-100",children:[e.jsx("div",{className:"bg-yellow-100 p-1.5 rounded-full text-yellow-600",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-yellow-800",children:["Voc√™ ganhar√° ",O," pontos!"]}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Neste pedido"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between text-gray-500 text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:f(b)})]}),n==="delivery"&&e.jsxs("div",{className:"flex justify-between text-gray-500 text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:f(X)})]}),M>0&&e.jsxs("div",{className:"flex justify-between text-green-600 text-sm font-medium",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["- ",f(M)]})]}),e.jsxs("div",{className:"flex justify-between items-end pt-2 mt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-bold",children:"Total Final"}),e.jsx("span",{className:"text-2xl font-black text-[#ff3d03]",children:f(R)})]})]})]})]})]}),!E&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 flex gap-3",children:[a!=="delivery"?e.jsx("button",{onClick:U,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors",children:"Voltar"}):e.jsx("button",{onClick:x,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors",children:"Cancelar"}),a==="review"?e.jsx("button",{onClick:le,disabled:q,className:"flex-[2] bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg shadow-orange-200 disabled:opacity-70",children:q?e.jsx(be,{className:"animate-spin"}):"Confirmar Pedido"}):e.jsxs("button",{onClick:ne,className:"flex-[2] bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg shadow-orange-200",children:["Continuar ",e.jsx(ye,{className:"w-5 h-5"})]})]})]})]})}export{He as default};
