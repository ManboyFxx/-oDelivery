import{r as d,j as t,X as O,d as p}from"./app-B_J8lkvq.js";import{t as a}from"./index-91nK9nk-.js";function M({isOpen:P,onClose:k,onLogin:g,slug:u}){const[s,i]=d.useState("phone"),[l,y]=d.useState(""),[S,j]=d.useState(""),[m,f]=d.useState(""),[h,w]=d.useState(""),[o,n]=d.useState(!1),[v,b]=d.useState("");d.useEffect(()=>{if(!localStorage.getItem("device_fingerprint")){const r=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"device-"+Math.random().toString(36).substring(2)+Date.now().toString(36);localStorage.setItem("device_fingerprint",r)}},[]);const N=()=>{y(""),j(""),f(""),w(""),i("phone"),b("")},c=()=>{N(),k()},_=async r=>{r.preventDefault(),n(!0);try{const e=await p.post("/customer/check-phone",{phone:l,tenant_slug:u,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.exists?e.data.trusted_device?(g(e.data.customer),c(),a.success(`Bem-vindo de volta, ${e.data.customer.name}!`)):e.data.requires_password?(i("password"),a.info(e.data.message||"Digite sua senha.")):e.data.requires_setup?(i("setup_otp"),b(e.data.message||"Vamos criar uma senha para você."),await x()):e.data.requires_otp&&(i("login_otp"),a.info("Código enviado para seu WhatsApp.")):i("name")}catch(e){console.error("Error checking phone:",e),a.error("Erro ao verificar telefone. Tente novamente.")}finally{n(!1)}},x=async()=>{try{await p.post("/customer/send-setup-otp",{phone:l,tenant_slug:u}),a.success("Código de verificação enviado!")}catch(r){console.error("Error sending setup OTP:",r),a.error("Erro ao enviar código.")}},C=async r=>{r.preventDefault(),n(!0);try{const e=await p.post("/customer/login-password",{phone:l,password:m,tenant_slug:u,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(g(e.data.customer),c(),a.success("Login realizado com sucesso!"))}catch(e){console.error("Error logging in with password:",e),a.error(e.response?.data?.message||"Senha incorreta.")}finally{n(!1)}},E=async r=>{r.preventDefault(),i("setup_password")},D=async r=>{r.preventDefault(),n(!0);try{const e=await p.post("/customer/setup-password",{phone:l,code:h,password:m,tenant_slug:u,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(g(e.data.customer),c(),a.success("Senha definida e Login realizado!"))}catch(e){console.error("Error setting password:",e),a.error(e.response?.data?.message||"Erro ao definir senha."),e.response?.status===422&&i("setup_otp")}finally{n(!1)}},q=async r=>{r.preventDefault(),n(!0);try{const e=await p.post("/customer/verify-otp",{phone:l,code:h,tenant_slug:u,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.valid&&(g(e.data.customer),c(),a.success("Verificação concluída!"))}catch(e){console.error("Error verifying OTP:",e),a.error(e.response?.data?.message||"Código inválido.")}finally{n(!1)}},I=async r=>{r.preventDefault(),n(!0);try{const e=await p.post("/customer/complete-registration",{phone:l,name:S,tenant_slug:u});e.data.requires_setup?(i("setup_otp"),b("Cadastro inicial feito! Agora vamos criar sua senha."),await x()):(g(e.data.customer),c(),a.success("Cadastro realizado com sucesso!"))}catch(e){console.error("Error completing registration:",e);const V=e.response?.data?.message||"Erro ao completar cadastro.";a.error(V)}finally{n(!1)}};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:c}),t.jsxs("div",{className:"bg-white dark:bg-premium-dark rounded-2xl p-6 max-w-md w-full relative z-10 shadow-xl animate-in fade-in zoom-in duration-300 transition-colors duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:s==="phone"?"Entrar ou Cadastrar":s==="name"?"Seus Dados":s==="password"?"Digite sua Senha":s==="setup_otp"||s==="login_otp"?"Verificação de Segurança":"Criar Senha"}),t.jsx("button",{onClick:c,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors",children:t.jsx(O,{className:"h-6 w-6"})})]}),s==="phone"&&t.jsxs("form",{onSubmit:_,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Número de Telefone"}),t.jsx("input",{type:"tel",value:l,onChange:r=>y(r.target.value),placeholder:"(00) 00000-0000",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:o?"Verificando...":"Continuar"})]}),s==="password"&&t.jsxs("form",{onSubmit:C,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Senha"}),t.jsx("input",{type:"password",value:m,onChange:r=>f(r.target.value),placeholder:"******",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:o?"Entrar...":"Entrar"}),t.jsx("button",{type:"button",onClick:()=>{i("setup_otp"),x()},className:"w-full text-sm text-gray-500 hover:text-[#ff3d03] transition-colors",children:"Esqueci minha senha (Criar nova)"})]}),(s==="setup_otp"||s==="login_otp")&&t.jsxs("form",{onSubmit:s==="setup_otp"?E:q,className:"space-y-4",children:[v&&t.jsx("div",{className:"p-3 bg-blue-50 text-blue-700 text-sm rounded-lg mb-4",children:v}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código enviado via WhatsApp do CartZapp"}),t.jsx("input",{type:"text",value:h,onChange:r=>w(r.target.value),placeholder:"000000",maxLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none text-center tracking-widest text-lg bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:o?"Verificando...":s==="setup_otp"?"Validar e Criar Senha":"Entrar"})]}),s==="setup_password"&&t.jsxs("form",{onSubmit:D,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"p-3 bg-green-50 text-green-700 text-sm rounded-lg mb-4",children:"Número verificado! Crie sua senha de acesso."}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Nova Senha"}),t.jsx("input",{type:"password",value:m,onChange:r=>f(r.target.value),placeholder:"Mínimo 6 caracteres",minLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:o?"Salvando...":"Definir Senha e Entrar"})]}),s==="name"&&t.jsxs("form",{onSubmit:I,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Seu Nome"}),t.jsx("input",{placeholder:"Digite seu nome",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0})]}),t.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:o?"Cadastrando...":"Continuar"})]})]})]})}export{M as default};
