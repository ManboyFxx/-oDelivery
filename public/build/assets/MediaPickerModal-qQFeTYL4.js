import{r as t,d as g,j as e,X as U}from"./app-DSzzEaYJ.js";import{I as N}from"./image-CcABhHiT.js";import{S as L}from"./search-DTxNNpwh.js";import{L as w}from"./loader-circle-BYEzrPfJ.js";import{C as P}from"./check-B-TizrH1.js";import{T}from"./trash-2-9XrXU_Mo.js";import{U as k}from"./upload-hSH8mNSS.js";function q(r){return r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`}function K({open:r,onClose:o,onSelect:C,currentUrl:E}){const[d,h]=t.useState([]),[S,u]=t.useState(!1),[D,p]=t.useState(!1),[s,c]=t.useState(null),[f,b]=t.useState(""),[y,i]=t.useState("library"),[B,x]=t.useState(!1),m=t.useCallback(async()=>{u(!0);try{const a=await g.get("/api/media");h(a.data)}finally{u(!1)}},[]);t.useEffect(()=>{r&&(m(),c(null),b(""),i("library"))},[r,m]);const j=async a=>{if(a?.length){p(!0);try{for(const l of Array.from(a)){const n=new FormData;n.append("file",l),await g.post("/media",n,{headers:{"Content-Type":"multipart/form-data"}})}await m(),i("library")}finally{p(!1)}}},$=async(a,l)=>{l.stopPropagation(),confirm("Deletar esta imagem?")&&(await g.delete(`/media/${a}`),h(n=>n.filter(M=>M.id!==a)),s===a&&c(null))},F=()=>{const a=d.find(l=>l.id===s);a&&(C(a),o())},v=d.filter(a=>a.original_name.toLowerCase().includes(f.toLowerCase()));return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-5 w-5 text-orange-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Banco de Imagens"})]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors",children:e.jsx(U,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 dark:border-white/10 px-6",children:["library","upload"].map(a=>e.jsx("button",{onClick:()=>i(a),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${y===a?"border-orange-500 text-orange-600 dark:text-orange-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:a==="library"?`Biblioteca (${d.length})`:"Upload"},a))}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:y==="library"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-3 border-b border-gray-100 dark:border-white/5",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{value:f,onChange:a=>b(a.target.value),placeholder:"Buscar imagens...",className:"w-full pl-9 pr-4 py-2 text-sm bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-gray-900 dark:text-white"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:S?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-orange-500"})}):v.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-400",children:[e.jsx(N,{className:"h-12 w-12 mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Nenhuma imagem encontrada"}),e.jsx("button",{onClick:()=>i("upload"),className:"mt-3 text-sm text-orange-500 hover:underline",children:"Fazer upload"})]}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",children:v.map(a=>e.jsxs("div",{onClick:()=>c(a.id===s?null:a.id),className:`relative group cursor-pointer rounded-xl overflow-hidden aspect-square border-2 transition-all ${s===a.id?"border-orange-500 ring-2 ring-orange-500/30":"border-transparent hover:border-gray-300 dark:hover:border-white/20"}`,children:[e.jsx("img",{src:a.url,alt:a.original_name,className:"w-full h-full object-cover"}),s===a.id&&e.jsx("div",{className:"absolute inset-0 bg-orange-500/20 flex items-center justify-center",children:e.jsx("div",{className:"bg-orange-500 rounded-full p-1",children:e.jsx(P,{className:"h-3 w-3 text-white"})})}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-end pb-2 gap-1",children:[e.jsx("p",{className:"text-white text-xs px-2 text-center leading-tight truncate w-full text-center",children:a.original_name}),e.jsx("p",{className:"text-white/60 text-xs",children:q(a.size)}),e.jsx("button",{onClick:l=>$(a.id,l),className:"absolute top-2 right-2 p-1 bg-red-500 rounded-full text-white hover:bg-red-600 transition-colors",children:e.jsx(T,{className:"h-3 w-3"})})]})]},a.id))})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsx("div",{onDragOver:a=>{a.preventDefault(),x(!0)},onDragLeave:()=>x(!1),onDrop:a=>{a.preventDefault(),x(!1),j(a.dataTransfer.files)},className:`w-full max-w-md border-2 border-dashed rounded-2xl p-12 text-center transition-colors ${B?"border-orange-400 bg-orange-50 dark:bg-orange-900/10":"border-gray-300 dark:border-white/20 hover:border-orange-400"}`,children:D?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(w,{className:"h-12 w-12 animate-spin text-orange-500"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enviando imagens..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Arraste imagens aqui"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"ou clique para selecionar"}),e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-5 py-2.5 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-xl transition-colors",children:[e.jsx(k,{className:"h-4 w-4"}),"Selecionar arquivos",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:a=>j(a.target.files)})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-4",children:"PNG, JPG, GIF, WebP at√© 10MB"})]})})})}),e.jsxs("div",{className:"flex items-center justify-between gap-3 px-6 py-4 border-t border-gray-200 dark:border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?"1 imagem selecionada":"Selecione uma imagem da biblioteca"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:F,disabled:!s,className:"px-5 py-2 bg-orange-500 hover:bg-orange-600 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-xl transition-colors",children:"Usar imagem"})]})]})]})}):null}export{K as M};
