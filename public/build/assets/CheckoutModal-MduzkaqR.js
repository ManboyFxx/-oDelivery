import{r as t,j as e,f as ge,X as D,e as l,d as se}from"./app-D2VljvTw.js";import{M as be}from"./Modal-CPkuO39I.js";import{S as ye}from"./sparkles-CJH1Xak9.js";import{G as z}from"./gift-vj-Eal1v.js";import je from"./AddressForm-B9DzIsMe.js";import{A as ve}from"./arrow-left-BOEQvvf9.js";import{M as A}from"./map-pin-CycHX-FG.js";import{W as F}from"./wallet-Dj4m-397.js";import{T as Ne}from"./ticket-Btog9CtY.js";import{C as te}from"./credit-card-CJ_Fv3xf.js";import{B as we}from"./banknote-Bc7LJn9d.js";import{L as Ce}from"./loader-circle-BhHVA8cD.js";import{C as _e}from"./chevron-right-d3u1QDd_.js";import{C as ke}from"./circle-check-big-jFZJVZKS.js";import{t as Se}from"./switch-DTazzpId.js";import"./keyboard-D3GHKAuh.js";import"./use-sync-refs-DLhS85IC.js";import"./portal-KUhlGsT1.js";import"./with-selector-D8O5el8K.js";import"./hidden-DG7gvhwG.js";import"./transition-D2MB-Bkq.js";import"./TextInput-DLKzFZ7C.js";import"./InputLabel-DKb6P6rq.js";import"./PrimaryButton-Cx2oxEBi.js";import"./SecondaryButton-BR6-z2BJ.js";import"./search-DgyBcvPy.js";import"./use-resolve-button-type-hvyh8Ega.js";function Pe({points:u,show:p,onComplete:h}){return t.useEffect(()=>{if(p){const r=setTimeout(h,3500);return()=>clearTimeout(r)}},[p,h]),p?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 animate-fade-in pointer-events-auto"}),e.jsx("style",{children:`
                @keyframes celebrationBounce {
                    0% {
                        transform: scale(0.5) translateY(20px);
                        opacity: 0;
                    }
                    50% {
                        transform: scale(1.05) rotate(5deg);
                    }
                    100% {
                        transform: scale(1) translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes spin-slowly {
                    0%, 100% { transform: rotate(0deg); }
                    50% { transform: rotate(10deg) scaleY(1.1); }
                }

                @keyframes pulse-glow {
                    0%, 100% { box-shadow: 0 0 20px rgba(255, 61, 3, 0.5); }
                    50% { box-shadow: 0 0 40px rgba(255, 61, 3, 0.8); }
                }

                @keyframes float-up {
                    0% {
                        opacity: 1;
                        transform: translateY(0);
                    }
                    100% {
                        opacity: 0;
                        transform: translateY(-100px);
                    }
                }

                .celebration-card {
                    animation: celebrationBounce 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
                }

                .celebration-icon {
                    animation: spin-slowly 2s ease-in-out infinite;
                }

                .celebration-glow {
                    animation: pulse-glow 1.5s ease-in-out infinite;
                }

                .floating-points {
                    animation: float-up 2s ease-out forwards;
                }
            `}),e.jsx("div",{className:"celebration-card relative z-10",children:e.jsxs("div",{className:"bg-gradient-to-br from-orange-400 via-orange-500 to-pink-500 rounded-3xl p-8 shadow-2xl celebration-glow text-center max-w-sm w-full",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl overflow-hidden",children:[...Array(6)].map((r,n)=>e.jsx(ye,{className:"absolute h-6 w-6 text-white/40",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animation:`float-up ${2+Math.random()*1}s ease-out forwards`,animationDelay:`${n*.2}s`}},n))}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"celebration-icon mb-4",children:e.jsx(z,{className:"h-16 w-16 mx-auto text-white drop-shadow-lg"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-black text-white mb-2 drop-shadow-lg",children:"Parab√©ns!"}),e.jsxs("div",{className:"text-white",children:[e.jsxs("p",{className:"text-5xl font-black mb-2 drop-shadow-lg",children:["+",u]}),e.jsx("p",{className:"text-lg font-bold drop-shadow-lg",children:"pontos!"})]}),e.jsx("p",{className:"text-white/90 text-sm mt-3 drop-shadow-lg",children:"Voc√™ est√° acumulando pr√™mios üéâ"})]})]})}),[...Array(8)].map((r,n)=>e.jsx("div",{className:"absolute floating-points pointer-events-none",style:{left:`calc(50% + ${(n-4)*30}px)`,top:"50%",animationDelay:`${n*.1}s`},children:e.jsxs("span",{className:"text-2xl font-black text-orange-500",children:["+",Math.floor(u/4)]})},n))]}):null}function rs({show:u,onClose:p,cart:h,store:r,customer:n,total:ae,addresses:E,onSuccess:Ae}){const[a,v]=t.useState("delivery"),[i,q]=t.useState("delivery"),[x,I]=t.useState(E),[d,N]=t.useState(""),[M,w]=t.useState(!1),[f,re]=t.useState("credit_card"),[C,oe]=t.useState(""),[B,V]=t.useState(!1),[L,g]=t.useState(""),[ne,Y]=t.useState(!1),[le,ie]=t.useState(0),[_,U]=t.useState(""),[m,W]=t.useState(null),[G,k]=t.useState(""),[de,X]=t.useState(!1),[b,ce]=t.useState(!1),[xe,O]=t.useState(0),[H,J]=t.useState(0),{success:S}=ge();t.useEffect(()=>{I(E)},[E]),t.useEffect(()=>{if(u&&x.length>0&&!d){const s=x.find(o=>o.is_default);N(s?s.id:x[0].id)}},[u,x,d]);const K=i==="delivery"?r.settings?.delivery_fee||5:0,R=(m&&m.discount_amount||0)+H,y=ae,T=Math.max(0,y+K-R),Q=t.useMemo(()=>!r?.loyalty_enabled||!r?.settings?.points_per_currency?0:Math.ceil(y*r.settings.points_per_currency),[y,r]),c=s=>`R$ ${s.toFixed(2).replace(".",",")}`,me=()=>{if(a==="delivery"){if(i==="delivery"&&!d){g("Selecione um endere√ßo para entrega.");return}g(""),v("payment")}else if(a==="payment"){if(f==="cash"&&C&&parseFloat(C.replace(",","."))<T){g("O valor do troco deve ser maior que o total.");return}g(""),v("review")}},Z=()=>{a==="review"?v("payment"):a==="payment"&&v("delivery")},pe=async()=>{V(!0),g("");try{const s={tenant_id:r.settings.tenant_id,customer_id:n.id,mode:i,address_id:i==="delivery"?d:null,payment_method:f,change_for:f==="cash"?parseFloat(C.replace(",",".")):null,coupon_id:m?.id||null,loyalty_points_used:b?xe:0,items:h.map(P=>({product_id:P.product.id,quantity:P.quantity,notes:P.notes,complements:P.selectedComplements.map(ee=>({id:ee.optionId||ee.id,quantity:1}))}))},o=await se.post("/customer/checkout",s),j=`/${window.location.pathname.split("/")[1]}/orders/${o.data.order_id}`;o.data.loyalty_points_earned>0?(ie(o.data.loyalty_points_earned),Y(!0),setTimeout(()=>{S("Pedido Realizado!","Redirecionando para acompanhamento..."),window.location.href=j},3500)):(S("Pedido Realizado!","Redirecionando para acompanhamento..."),setTimeout(()=>{window.location.href=j},1500))}catch(s){console.error(s),g(s.response?.data?.message||"Erro ao processar pedido.")}finally{V(!1)}},fe=async()=>{if(_.trim()){X(!0),k("");try{const s=await se.post("/api/validate-coupon",{code:_,cart_total:y,tenant_id:r.tenant_id||window.location.pathname.split("/")[1]});s.data.valid?(W({...s.data.coupon,discount_amount:s.data.discount}),S("Cupom Aplicado!",s.data.message),U("")):k(s.data.message||"Cupom inv√°lido")}catch(s){k(s.response?.data?.message||"Erro ao validar cupom")}finally{X(!1)}}},ue=s=>{I(o=>[...o,s]),N(s.id),w(!1)},he=()=>e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2",children:[[{id:"delivery",label:"Entrega",icon:A},{id:"payment",label:"Pagamento",icon:F},{id:"review",label:"Confirma√ß√£o",icon:ke}].map((s,o)=>{const $=s.id===a,j=a==="payment"&&o===0||a==="review"&&o<=1;return e.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[e.jsx("div",{className:l("w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 border-2",$?"bg-[#ff3d03] border-[#ff3d03] text-white shadow-lg scale-110":j?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-400"),children:e.jsx(s.icon,{className:"w-5 h-5"})}),e.jsx("span",{className:l("text-xs font-semibold mt-2",$?"text-[#ff3d03]":j?"text-green-600":"text-gray-400"),children:s.label})]},s.id)}),e.jsx("div",{className:"absolute top-[4.5rem] left-10 right-10 h-0.5 bg-gray-200 -z-0"}),e.jsx("div",{className:l("absolute top-[4.5rem] left-10 h-0.5 bg-green-500 transition-all duration-300 -z-0",a==="delivery"?"w-0":a==="payment"?"w-1/2":"w-[calc(100%-5rem)]")})]});return e.jsxs(be,{show:u,onClose:p,maxWidth:"md",children:[e.jsx(Pe,{points:le,show:ne,onComplete:()=>Y(!1)}),e.jsxs("div",{className:"p-6 min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a!=="delivery"?e.jsx("button",{onClick:Z,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(ve,{className:"h-6 w-6 text-gray-600"})}):e.jsx("div",{}),e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[a==="delivery"&&"Entrega ou Retirada",a==="payment"&&"Pagamento",a==="review"&&"Resumo do Pedido"]}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600",children:e.jsx(D,{className:"h-6 w-6"})})]}),!M&&he(),e.jsxs("div",{className:"flex-1 overflow-y-auto max-h-[60vh] px-1 py-1",children:[L&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm font-medium flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"})," ",L]}),M?e.jsx(je,{onCancel:()=>w(!1),onSuccess:ue,tenantId:r.settings.tenant_id,customerId:n.id}):e.jsxs(e.Fragment,{children:[a==="delivery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>q("delivery"),className:l("p-4 rounded-xl border-2 font-bold transition-all flex flex-col items-center gap-2",i==="delivery"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:[e.jsx(A,{className:"w-6 h-6"}),"Entrega"]}),e.jsxs("button",{onClick:()=>q("pickup"),className:l("p-4 rounded-xl border-2 font-bold transition-all flex flex-col items-center gap-2",i==="pickup"?"border-[#ff3d03] bg-orange-50 text-[#ff3d03]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"w-6 h-6 relative",children:e.jsx(F,{className:"absolute w-full h-full"})}),"Retirada"]})]}),i==="delivery"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Selecione o Endere√ßo"}),e.jsx("button",{onClick:()=>w(!0),className:"text-sm font-bold text-[#ff3d03] hover:underline",children:"+ Novo Endere√ßo"})]}),x.length===0?e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:[e.jsx(A,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"Nenhum endere√ßo cadastrado"}),e.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50",children:"Cadastrar Agora"})]}):x.map(s=>e.jsx("div",{onClick:()=>N(s.id),className:l("p-4 rounded-xl border-2 cursor-pointer transition-all flex items-start justify-between group",d===s.id?"border-[#ff3d03] bg-orange-50/50":"border-gray-100 hover:border-gray-200 hover:bg-gray-50"),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:l("mt-1 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0",d===s.id?"border-[#ff3d03] bg-[#ff3d03]":"border-gray-300"),children:d===s.id&&e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-900",children:[s.street,", ",s.number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.neighborhood," - ",s.city]}),s.complement&&e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:s.complement})]})]})},s.id))]})]}),a==="payment"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(Ne,{className:"h-4 w-4 text-[#ff3d03]"}),"Cupom de Desconto"]}),m?e.jsxs("div",{className:"bg-white border border-green-200 rounded-lg p-3 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-green-700 text-sm",children:["‚úì ",m.code]}),e.jsxs("p",{className:"text-xs text-green-600",children:["Desconto de ",m.discount_type==="fixed"?c(m.discount_value):`${m.discount_value}%`]})]}),e.jsx("button",{onClick:()=>W(null),className:"text-gray-400 hover:text-red-500",children:e.jsx(D,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:_,onChange:s=>{U(s.target.value),k("")},placeholder:"C√≥digo do cupom",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-[#ff3d03] focus:border-[#ff3d03]"}),e.jsx("button",{onClick:fe,disabled:de||!_,className:"bg-gray-900 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50",children:"Aplicar"})]}),G&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:G})]}),r?.loyalty_enabled&&n?.loyalty_points>0&&e.jsxs("div",{className:l("p-4 rounded-xl border transition-all",b?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-100"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 text-orange-500"}),"Abater com Pontos"]}),e.jsx(Se,{checked:b,onChange:s=>{if(ce(s),s){const o=n.loyalty_points*(r.settings?.currency_per_point||.1);O(n.loyalty_points),J(o),S("Pontos Aplicados!",`Desconto de ${c(o)} adicionado.`)}else O(0),J(0)},className:l("relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none",b?"bg-[#ff3d03]":"bg-gray-200"),children:e.jsx("span",{className:l("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",b?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Saldo: ",e.jsxs("span",{className:"font-bold",children:[n.loyalty_points," pontos"]})]}),e.jsxs("p",{className:"text-[10px] text-gray-400",children:["1 ponto = ",c(r.settings?.currency_per_point||.1)]})]}),b&&e.jsxs("p",{className:"text-sm font-bold text-orange-600",children:["-",c(H)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"Forma de Pagamento"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"credit_card",label:"Cr√©dito",sub:"Maquininha",icon:te},{id:"debit_card",label:"D√©bito",sub:"Maquininha",icon:te},{id:"pix",label:"PIX",sub:"Na entrega",icon:F},{id:"cash",label:"Dinheiro",sub:"Esp√©cie",icon:we}].map(s=>e.jsxs("div",{onClick:()=>re(s.id),className:l("p-3 rounded-xl border-2 cursor-pointer transition-all flex flex-col items-center text-center gap-2 hover:shadow-md",f===s.id?"border-[#ff3d03] bg-orange-50 shadow-sm":"border-gray-100 hover:border-gray-200"),children:[e.jsx(s.icon,{className:l("w-6 h-6",f===s.id?"text-[#ff3d03]":"text-gray-400")}),e.jsxs("div",{children:[e.jsx("p",{className:l("font-bold text-sm",f===s.id?"text-[#ff3d03]":"text-gray-700"),children:s.label}),e.jsx("p",{className:"text-[10px] text-gray-400",children:s.sub})]})]},s.id))})]}),f==="cash"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Troco para quanto?"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:C,onChange:s=>oe(s.target.value),placeholder:"0,00",className:"w-full pl-9 px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#ff3d03] focus:border-[#ff3d03]"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total do pedido: ",c(T)]})]})]}),a==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:"Resumo do Pedido"}),e.jsxs("span",{className:"text-xs font-medium bg-gray-200 px-2 py-1 rounded-full text-gray-600",children:[h.length," itens"]})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-40 overflow-y-auto",children:h.map((s,o)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]}),e.jsx("span",{className:"text-gray-600 line-clamp-1",children:s.product.name})]}),e.jsx("span",{className:"text-gray-900 font-medium",children:c(s.subtotal)})]},o))})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-xl text-sm text-blue-800",children:[e.jsx(A,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:i==="delivery"?"Entrega em:":"Retirada em Loja"}),i==="delivery"&&d?e.jsxs("p",{className:"opacity-90",children:[x.find(s=>s.id===d)?.street,", ",x.find(s=>s.id===d)?.number]}):e.jsx("p",{className:"opacity-90",children:"Retirar no balc√£o."})]})]}),Q>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-100",children:[e.jsx("div",{className:"bg-yellow-100 p-1.5 rounded-full text-yellow-600",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-yellow-800",children:["Voc√™ ganhar√° ",Q," pontos!"]}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Neste pedido"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between text-gray-500 text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:c(y)})]}),i==="delivery"&&e.jsxs("div",{className:"flex justify-between text-gray-500 text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:c(K)})]}),R>0&&e.jsxs("div",{className:"flex justify-between text-green-600 text-sm font-medium",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["- ",c(R)]})]}),e.jsxs("div",{className:"flex justify-between items-end pt-2 mt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-gray-900 font-bold",children:"Total Final"}),e.jsx("span",{className:"text-2xl font-black text-[#ff3d03]",children:c(T)})]})]})]})]})]}),!M&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 flex gap-3",children:[a!=="delivery"?e.jsx("button",{onClick:Z,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors",children:"Voltar"}):e.jsx("button",{onClick:p,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors",children:"Cancelar"}),a==="review"?e.jsx("button",{onClick:pe,disabled:B,className:"flex-[2] bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg shadow-orange-200 disabled:opacity-70",children:B?e.jsx(Ce,{className:"animate-spin"}):"Confirmar Pedido"}):e.jsxs("button",{onClick:me,className:"flex-[2] bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg shadow-orange-200",children:["Continuar ",e.jsx(_e,{className:"w-5 h-5"})]})]})]})]})}export{rs as default};
