import{r as h,j as e,X as I,e as C}from"./app-BdORke9e.js";import{t as N}from"./index-DQcsEE3M.js";import{S as Q}from"./shopping-bag-Bkq9HZGo.js";import{M}from"./minus-BNVZGM0E.js";import{P as v}from"./plus-CCxwXr4F.js";function G({product:a,isOpen:f,onClose:b,onAddToCart:$,initialValues:o}){const[d,m]=h.useState(1),[w,u]=h.useState(""),[x,g]=h.useState({});if(h.useEffect(()=>{if(!(!a||!f))if(o){m(o.quantity),u(o.notes);const s={};o.selectedComplements.forEach(t=>{s[t.groupId]||(s[t.groupId]={}),s[t.groupId][t.optionId]=t.quantity||1}),g(s)}else m(1),u(""),g({})},[a,o,f]),!a||!f)return null;const j=(s,t,c,l,r)=>{g(n=>{const i=n[s]||{},S=i[t]||0,p=Math.max(0,Math.min(S+c,l));if(Object.values(i).reduce((q,z)=>q+z,0)-S+p>r)return N.error(`Máximo de ${r} opções permitidas.`),n;const y={...i};return p===0?delete y[t]:y[t]=p,{...n,[s]:y}})},_=s=>{const t=x[s]||{};return Object.values(t).reduce((c,l)=>c+l,0)},k=()=>{let s=Number(a.promotional_price&&Number(a.promotional_price)>0?a.promotional_price:a.price);return a.complement_groups?.forEach(t=>{const c=x[t.id]||{};Object.entries(c).forEach(([l,r])=>{const n=t.options.find(i=>i.id===l);n&&(s+=n.price*r)})}),s*d},E=()=>{if(a.complement_groups)for(const t of a.complement_groups){const c=_(t.id);if(t.is_required&&c===0){N.error(`"${t.name}" é obrigatório.`);return}if(c>0&&c<t.min_selections){N.error(`Selecione pelo menos ${t.min_selections} em "${t.name}".`);return}}const s=[];a.complement_groups?.forEach(t=>{const c=x[t.id]||{};Object.entries(c).forEach(([l,r])=>{const n=t.options.find(i=>i.id===l);if(n&&r>0)for(let i=0;i<r;i++)s.push({groupId:t.id,optionId:n.id,name:n.name,price:n.price,quantity:1})})}),$({product:a,quantity:d,notes:w,selectedComplements:s,subtotal:k()}),b()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:b}),e.jsxs("div",{className:"bg-white w-full md:max-w-2xl max-h-[90vh] md:rounded-3xl rounded-t-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto animate-in slide-in-from-bottom md:slide-in-from-bottom-10 duration-300",children:[e.jsxs("div",{className:"h-48 md:h-64 relative shrink-0",children:[a.image_url?e.jsx("img",{src:a.image_url,className:"w-full h-full object-cover",alt:a.name}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-300",children:e.jsx(Q,{className:"h-16 w-16"})}),e.jsx("button",{onClick:b,className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 p-2 rounded-full backdrop-blur-md transition-all group",children:e.jsx(I,{className:"h-5 w-5 text-white group-hover:scale-110 transition-transform"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/10 to-transparent"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 relative bg-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-black text-gray-900 leading-tight mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:a.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-2xl font-black text-[#ff3d03]",children:["R$ ",Number(a.promotional_price||a.price).toFixed(2).replace(".",",")]}),a.promotional_price&&e.jsxs("span",{className:"ml-3 text-sm text-gray-400 line-through",children:["R$ ",Number(a.price).toFixed(2).replace(".",",")]})]})]}),a.complement_groups?.map(s=>{const t=_(s.id),c=(!s.is_required||t>=s.min_selections)&&t<=s.max_selections;return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-white py-2 z-10 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-900 text-lg flex items-center gap-2",children:[s.name,s.is_required&&e.jsx("span",{className:"text-[#ff3d03] text-xs font-black uppercase bg-orange-50 px-2 py-0.5 rounded-full",children:"Obrigatório"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.min_selections>0?`Mín: ${s.min_selections}`:"",s.max_selections<100?` • Máx: ${s.max_selections}`:""]})]}),e.jsxs("div",{className:C("text-xs font-bold px-2 py-1 rounded-full",c?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"),children:[t,"/",s.max_selections]})]}),e.jsx("div",{className:"space-y-3",children:s.options.map(l=>{const r=x[s.id]?.[l.id]||0,n=l.max_quantity||1,i=r<n&&t<s.max_selections;return e.jsxs("div",{className:C("flex items-center justify-between p-3 rounded-xl border transition-all cursor-pointer",r>0?"border-[#ff3d03] bg-orange-50":"border-gray-100 hover:border-gray-200"),children:[e.jsxs("div",{className:"flex-1",onClick:()=>i&&j(s.id,l.id,1,n,s.max_selections),children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.name}),l.price>0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["+ R$ ",l.price.toFixed(2).replace(".",",")]})]}),r>0||i?e.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-lg p-1 shadow-sm border border-gray-100",children:[r>0&&e.jsx("button",{onClick:()=>j(s.id,l.id,-1,n,s.max_selections),className:"p-1 hover:bg-gray-100 rounded text-gray-600",children:e.jsx(M,{className:"h-4 w-4"})}),r>0&&e.jsx("span",{className:"font-bold text-sm min-w-[1rem] text-center",children:r}),e.jsx("button",{onClick:()=>j(s.id,l.id,1,n,s.max_selections),disabled:!i,className:"p-1 hover:bg-gray-100 rounded text-[#ff3d03] disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(v,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"h-8 w-8 rounded-full border border-gray-200 flex items-center justify-center text-gray-400",children:e.jsx(v,{className:"h-4 w-4"})})]},l.id)})})]},s.id)}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-bold text-gray-900 mb-2",children:"Observações"}),e.jsx("textarea",{value:w,onChange:s=>u(s.target.value),placeholder:"Ex: Sem cebola, capricha no molho...",className:"w-full p-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-[#ff3d03] resize-none text-sm",rows:3})]})]}),e.jsx("div",{className:"p-4 md:p-6 border-t border-gray-100 bg-white md:rounded-b-3xl shrink-0 relative z-20 pb-safe",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-100 rounded-xl px-2",children:[e.jsx("button",{onClick:()=>m(Math.max(1,d-1)),className:"h-10 w-10 flex items-center justify-center text-gray-600 hover:text-black",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-black text-xl w-8 text-center",children:d}),e.jsx("button",{onClick:()=>m(d+1),className:"h-10 w-10 flex items-center justify-center text-gray-600 hover:text-black",children:e.jsx(v,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:E,className:"flex-1 bg-[#ff3d03] text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-500/30 hover:bg-[#e63700] hover:shadow-orange-500/50 transition-all active:scale-[0.98] flex items-center justify-between px-6",children:[e.jsx("span",{children:o?"Atualizar Pedido":"Adicionar"}),e.jsxs("span",{children:["R$ ",k().toFixed(2).replace(".",",")]})]})]})})]})]})}export{G as default};
