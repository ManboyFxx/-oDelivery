import{r as l,j as s,X as L,e as h}from"./app-B5qJFbdJ.js";import{t as r}from"./index-JIMt6jk-.js";function F({isOpen:R,onClose:O,onLogin:f,slug:p}){const[o,i]=l.useState("phone"),[d,w]=l.useState(""),[M,j]=l.useState(""),[v,D]=l.useState(""),[y,E]=l.useState(""),[g,k]=l.useState(""),[a,n]=l.useState(!1),[x,N]=l.useState(""),[_,C]=l.useState(!0),[u,S]=l.useState(4);l.useEffect(()=>{if(!localStorage.getItem("device_fingerprint")){const t=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"device-"+Math.random().toString(36).substring(2)+Date.now().toString(36);localStorage.setItem("device_fingerprint",t)}},[]);const P=()=>{w(""),j(""),D(""),E(""),k(""),i("phone"),N(""),C(!0),S(4)},m=()=>{P(),O()},T=async t=>{t.preventDefault(),n(!0);try{const e=await h.post("/customer/check-phone",{phone:d,tenant_slug:p,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});if(e.data.exists)if(e.data.trusted_device)f(e.data.customer),m(),r.success(`Bem-vindo de volta, ${e.data.customer.name}!`);else if(e.data.requires_password)i("password"),r.info(e.data.message||"Digite sua senha.");else if(e.data.requires_setup){const c=e.data.otp_enabled!==!1,b=e.data.phone_digits_required??4;C(c),S(b),N(e.data.message||""),c?(i("setup_otp"),await V()):(i("phone_digits"),r.info(e.data.message||`Confirme os últimos ${b} dígitos do seu telefone.`))}else e.data.requires_otp&&(i("login_otp"),r.info("Código enviado para seu WhatsApp."));else i("name")}catch(e){console.error("Error checking phone:",e),r.error("Erro ao verificar telefone. Tente novamente.")}finally{n(!1)}},V=async()=>{try{await h.post("/customer/send-setup-otp",{phone:d,tenant_slug:p}),r.success("Código de verificação enviado!")}catch(t){console.error("Error sending setup OTP:",t),r.error("Erro ao enviar código.")}},A=async t=>{t.preventDefault(),n(!0);try{const e=await h.post("/customer/login-password",{phone:d,password:v,tenant_slug:p,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(f(e.data.customer),m(),r.success("Login realizado com sucesso!"))}catch(e){console.error("Error logging in with password:",e),r.error(e.response?.data?.message||"Senha incorreta.")}finally{n(!1)}},U=async t=>{t.preventDefault(),i("setup_password")},q=async t=>{if(t.preventDefault(),g.length!==u){r.error(`Digite os ${u} últimos dígitos do seu telefone.`);return}n(!0);try{const e=await h.post("/customer/quick-login",{phone:d,tenant_slug:p,phone_last_digits:g,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.success&&(f(e.data.customer),m(),r.success(`Bem-vindo, ${e.data.customer.name}!`))}catch(e){r.error(e.response?.data?.message||"Dígitos incorretos. Tente novamente.")}finally{n(!1)}},I=async t=>{t.preventDefault(),n(!0);try{if(!_){if(g.length!==u){r.error(`Digite os ${u} últimos dígitos do seu telefone.`),n(!1);return}const c=await h.post("/customer/quick-login",{phone_last_digits:g,customer_id:"",device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"})}const e=await h.post("/customer/setup-password",{phone:d,code:y,password:v,tenant_slug:p,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device",phone_last_digits:_?void 0:g});e.data.success&&(f(e.data.customer),m(),r.success("Senha definida e Login realizado!"))}catch(e){console.error("Error setting password:",e),r.error(e.response?.data?.message||"Erro ao definir senha."),e.response?.status===422&&i("setup_otp")}finally{n(!1)}},z=async t=>{t.preventDefault(),n(!0);try{const e=await h.post("/customer/verify-otp",{phone:d,code:y,tenant_slug:p,device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});e.data.valid&&(f(e.data.customer),m(),r.success("Verificação concluída!"))}catch(e){console.error("Error verifying OTP:",e),r.error(e.response?.data?.message||"Código inválido.")}finally{n(!1)}},$=async t=>{t.preventDefault(),n(!0);try{const e=await h.post("/customer/complete-registration",{phone:d,name:M,tenant_slug:p,referral_code:localStorage.getItem("referral_code"),device_fingerprint:localStorage.getItem("device_fingerprint")||"unknown-device"});if(e.data.requires_setup){const c=e.data.otp_enabled!==!1,b=e.data.phone_digits_required??4;C(c),S(b),N("Cadastro realizado!"),c?(i("setup_otp"),await V()):(i("phone_digits"),r.info(`Confirme os últimos ${b} dígitos do seu telefone para entrar.`))}else f(e.data.customer),m(),r.success("Cadastro realizado com sucesso!")}catch(e){console.error("Error completing registration:",e);const c=e.response?.data?.message||"Erro ao completar cadastro.";r.error(c)}finally{n(!1)}};return s.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[s.jsxDEV("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:m},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:290,columnNumber:13},this),s.jsxDEV("div",{className:"bg-white dark:bg-premium-dark rounded-2xl p-6 max-w-md w-full relative z-10 shadow-xl animate-in fade-in zoom-in duration-300 transition-colors duration-300",children:[s.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[s.jsxDEV("h3",{className:"text-xl font-bold text-gray-900 dark:text-white transition-colors duration-300",children:o==="phone"?"Entrar ou Cadastrar":o==="name"?"Seus Dados":o==="password"?"Digite sua Senha":o==="phone_digits"?"Verificação de Identidade":o==="setup_otp"||o==="login_otp"?"Verificação de Segurança":"Criar Senha"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:297,columnNumber:21},this),s.jsxDEV("button",{onClick:m,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors",children:s.jsxDEV(L,{className:"h-6 w-6"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:307,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:306,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:296,columnNumber:17},this),o==="phone"&&s.jsxDEV("form",{onSubmit:T,className:"space-y-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Número de Telefone"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:314,columnNumber:29},this),s.jsxDEV("input",{type:"tel",value:d,onChange:t=>w(t.target.value),placeholder:"(00) 00000-0000",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:317,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:313,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Verificando...":"Continuar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:326,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:312,columnNumber:21},this),o==="password"&&s.jsxDEV("form",{onSubmit:A,className:"space-y-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Senha"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:339,columnNumber:29},this),s.jsxDEV("input",{type:"password",value:v,onChange:t=>D(t.target.value),placeholder:"******",className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:342,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:338,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Entrar...":"Entrar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:351,columnNumber:25},this),s.jsxDEV("button",{type:"button",onClick:()=>{i("setup_otp"),V()},className:"w-full text-sm text-gray-500 hover:text-[#ff3d03] transition-colors",children:"Esqueci minha senha (Criar nova)"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:358,columnNumber:26},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:337,columnNumber:22},this),(o==="setup_otp"||o==="login_otp")&&s.jsxDEV("form",{onSubmit:o==="setup_otp"?U:z,className:"space-y-4",children:[x&&s.jsxDEV("div",{className:"p-3 bg-blue-50 text-blue-700 text-sm rounded-lg mb-4",children:x},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:374,columnNumber:31},this),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código enviado via WhatsApp do CartZapp"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:379,columnNumber:29},this),s.jsxDEV("input",{type:"text",value:y,onChange:t=>E(t.target.value),placeholder:"000000",maxLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none text-center tracking-widest text-lg bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:382,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:378,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Verificando...":o==="setup_otp"?"Validar e Criar Senha":"Entrar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:392,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:372,columnNumber:22},this),o==="setup_password"&&s.jsxDEV("form",{onSubmit:I,className:"space-y-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("div",{className:"p-3 bg-green-50 text-green-700 text-sm rounded-lg mb-4",children:"Número verificado! Crie sua senha de acesso."},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:405,columnNumber:29},this),s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Nova Senha"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:408,columnNumber:29},this),s.jsxDEV("input",{type:"password",value:v,onChange:t=>D(t.target.value),placeholder:"Mínimo 6 caracteres",minLength:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:411,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:404,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Salvando...":"Definir Senha e Entrar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:421,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:403,columnNumber:22},this),o==="phone_digits"&&s.jsxDEV("form",{onSubmit:q,className:"space-y-4",children:[s.jsxDEV("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 text-sm rounded-lg",children:x||`Confirme os últimos ${u} dígitos do seu telefone para entrar.`},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:433,columnNumber:25},this),s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Últimos ",u," dígitos do telefone"]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:437,columnNumber:29},this),s.jsxDEV("input",{type:"tel",value:g,onChange:t=>k(t.target.value.replace(/\D/g,"").slice(0,u)),placeholder:"0".repeat(u),maxLength:u,autoFocus:!0,className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none text-center tracking-widest text-2xl font-bold bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:440,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:436,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a||g.length!==u,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Verificando...":"Entrar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:451,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:432,columnNumber:21},this),o==="name"&&s.jsxDEV("form",{onSubmit:$,className:"space-y-4",children:[s.jsxDEV("div",{children:[s.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300",children:"Seu Nome"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:464,columnNumber:29},this),s.jsxDEV("input",{placeholder:"Digite seu nome",value:M,onChange:t=>j(t.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#ff3d03] focus:border-transparent transition-all outline-none bg-white dark:bg-white/5 text-gray-900 dark:text-white dark:placeholder-gray-500",required:!0},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:467,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:463,columnNumber:25},this),s.jsxDEV("button",{type:"submit",disabled:a,className:"w-full bg-[#ff3d03] hover:bg-[#e63700] text-white font-bold py-3 rounded-xl transition-colors disabled:opacity-50",children:a?"Cadastrando...":"Continuar"},void 0,!1,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:475,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:462,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:295,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/Vertinho/Documents/Sistemas/OoDelivery/-oDelivery/resources/js/Pages/Tenant/Menu/Components/AuthModal.tsx",lineNumber:289,columnNumber:9},this)}export{F as default};
